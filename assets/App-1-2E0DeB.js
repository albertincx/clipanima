import{r as e,j as t,e as i}from"./index-CQFn9bkK.js";function a(){const e=["appVersion","createElement","iPhone","1912WHAVuq","black","reset","changedTouches","push","getDrawingCanvasData","count","font","brushSize","identifier","strokeStyle","fill","height","drawingCanvas","down","drawImage","arc","cos","type","preventDefault","getElementById","white","pageX","width","points","1345317cSzTFv","3927225ozLUgK","update","apply","forEach","26346132SOrOeD","Android","addEventListener","atan2","toWorld","toDataURL","onload","touchend","resetZoom","fillStyle","source-over","globalAlpha","fillRect","pageY","setPinch","selectedColor","touchmove","invScale","lineWidth","8pLDqQv","isMoveMode","pCount","movePinch","length","clearRect","stroke","touchstart","getContext","rgba(255, 255, 255, 1)","setTransform","584940iitfHI","7774236ylWLsN","maxTouchPoints","indexOf","1612555JcDpXk","694QhVMYk","src","sin"];return(a=function(){return e})()}!function(){const e=r,t=a();for(;;)try{if(985186===parseInt(e(445))/1*(-parseInt(e(510))/2)+-parseInt(e(470))/3+-parseInt(e(506))/4+parseInt(e(471))/5+parseInt(e(505))/6+parseInt(e(509))/7*(parseInt(e(494))/8)+parseInt(e(475))/9)break;t.push(t.shift())}catch(i){t.push(t.shift())}}();const n=(e="canvas")=>{const t=r;let i=document[t(465)](e);if(!i)return;const a={x:0,y:0},n={x:0,y:0},s=document[t(514)]("canvas");s.width=512,s[t(457)]=512;const o=s[t(502)]("2d"),h=i[t(502)]("2d");var l=!1,c=!1,d=!1,u=!0;const m=document.createElement("canvas"),p=m.width=512,f=m[t(457)]=512,g=m[t(502)]("2d");if(g.fillStyle=t(466),g[t(487)](0,0,p,f),window[t(458)]=m,window[t(450)]=()=>m[t(480)](),window.setDrawingCanvasData=e=>{const i=t,a=new Image;a[i(481)]=()=>{const e=i;g[e(499)](0,0,m[e(468)],m[e(457)]),g[e(460)](a,0,0)},a[i(511)]=e},"canvas"===e){const e=document[t(465)]("canvas2")[t(502)]("2d");e[t(499)](0,0,b,y),e[t(487)](5,f,p-5,5),e[t(487)](p,5,5,f)}const w=function(e){const i=t;if(void 0===navigator[i(507)]&&(navigator[i(513)][i(508)](i(476))>-1||navigator[i(513)][i(508)](i(444))>-1||navigator[i(513)].indexOf("iPad")>-1)&&(navigator[i(507)]=5),navigator[i(507)]>0)return function(e){const i=t,a={points:[],x:0,y:0,count:0,w:0,rx:0,ry:0};var n=a,r=a[i(469)];function s(){for(var e=0;e<n.pCount;e++)if(-1===r[e].id)return r[e]}function o(e){const t=i;for(var a=0;a<n[t(496)];a++)if(r[a].id===e)return r[a]}function h(e,t,a,n){const r=i;void 0!==e&&(a?(e.oy=t[r(467)],e.ox=t[r(488)],e.id=t[r(454)]):(e.ox=e.x,e.oy=e.y),e.x=t[r(467)],e.y=t[r(488)],e[r(459)]=n,!n&&(e.id=-1))}function l(){const e=i;for(var t=0,a=0;a<n[e(496)];a++)-1!==r[a].id&&(0===t&&(n.x=r[a].x,n.y=r[a].y),t+=1);n[e(451)]=t}function c(e){const t=i;var a,n;if(n=e[t(448)],e[t(463)]===t(501))for(a=0;a<n.length;a++)h(s(),n[a],!0,!0);else if(e[t(463)]===t(491))for(a=0;a<n[t(498)];a++)h(o(n[a][t(454)]),n[a],!1,!0);else if(e[t(463)]===t(482))for(a=0;a<n[t(498)];a++)h(o(n[a].identifier),n[a],!1,!1);return l(),e[t(464)](),!1}return a[i(496)]=navigator[i(507)],e=void 0===e?document:e,((e,t)=>{for(var i=0;i<e&&!0!==t(i++););})(navigator[i(507)],()=>a.points[i(449)]({x:0,y:0,dx:0,dy:0,down:!1,id:-1})),["touchstart",i(491),"touchend"][i(474)](t=>e[i(477)](t,c)),a}(e)}(i);if(h[t(452)]="16px arial.",void 0===w)return;const v=[];function x(){const e=t,i=window[e(490)]||e(446),a=window[e(453)]||8,n=window.isEraser||!1;for(g.globalCompositeOperation=e(485),n?(g.fillStyle=e(503),g[e(455)]=e(503)):(g[e(484)]=i,g[e(455)]=i),g[e(493)]=a;v[e(498)]>0;){const t=v.shift();g.beginPath(),g[e(461)](t.x,t.y,a/2,0,2*Math.PI),g[e(456)](),g[e(500)]()}}var b=i.width,y=i[t(457)];requestAnimationFrame(function e(r){const k=t;u&&(u=!1,C.setContext(h)),h[k(504)](1,0,0,1,0,0),h[k(486)]=1,h.globalCompositeOperation="source-over",(b!==innerWidth||y!==innerHeight)&&(b=i[k(468)]=innerWidth,y=i[k(457)]=innerHeight),300===canvas2[k(468)]&&(canvas2.width=innerWidth,canvas2.height=innerHeight),h[k(499)](0,0,b,y),C[k(473)](),h.fillStyle=k(446),h[k(486)]=.4,h[k(487)](5,f,p-5,5),h[k(487)](p,5,5,f),h[k(486)]=1,h[k(460)](m,0,0),h[k(504)](1,0,0,1,0,0);const j=window[k(495)];if(1!==w[k(451)]&&!l||c||j)if(1!==w[k(451)]&&!d||!j||c)2===w[k(451)]||c?(v[k(498)]=0,0===w[k(451)]?c=!1:c||2!==w[k(451)]?C[k(497)](w[k(469)][0],w[k(469)][1]):(c=!0,C[k(489)](w[k(469)][0],w[k(469)][1]))):(c=!1,l=!1,d=!1);else if(v.length=0,0===w[k(451)])d=!1,o[k(499)](0,0,s.width,s[k(457)]);else if(d||1!==w[k(451)]){C.toWorld(w[k(469)][0],a);const e=a.x-n.x,t=a.y-n.y;g[k(499)](0,0,m[k(468)],m[k(457)]),g[k(460)](s,e,t)}else d=!0,C[k(479)](w[k(469)][0],n),o[k(499)](0,0,s.width,s[k(457)]),o[k(460)](m,0,0);else 0===w.count?(l=!1,x()):(C[k(479)](w,a),v[k(449)]({x:a.x,y:a.y}),l?x():v.length>8&&(l=!0));requestAnimationFrame(e)});const C=(()=>{const e=t,i=[1,0,0,1,0,0],a=[1,0,0,1,0,0];var n=i,s=a,o=1,h=0;const l={x:0,y:0},c={x:0,y:0};var d,u=0,m=1,p=0,f=0;const g={x:0,y:0};var w=!0;const v={canvasDefault(){d[r(504)](1,0,0,1,0,0)},apply(){w&&this[r(472)](),d.setTransform(n[0],n[1],n[2],n[3],n[4],n[5])},reset(){o=1,h=0,g.x=0,g.y=0,w=!0},matrix:i,invMatrix:a,update(){const e=r;w=!1,n[3]=n[0]=Math[e(462)](h)*o,n[2]=-(n[1]=Math[e(512)](h)*o),n[4]=g.x,n[5]=g.y,this[e(492)]=1/o;var t=n[0]*n[3]-n[1]*n[2];s[0]=n[3]/t,s[1]=-n[1]/t,s[2]=-n[2]/t,s[3]=n[0]/t},toWorld(e,t={}){var i,a;return w&&this.update(),i=e.x-n[4],a=e.y-n[5],t.x=i*s[0]+a*s[2],t.y=i*s[1]+a*s[3],t},toScreen(e,t={}){return w&&this[r(472)](),t.x=e.x*n[0]+e.y*n[2]+n[4],t.y=e.x*n[1]+e.y*n[3]+n[5],t},setPinch(e,t){const i=r;w&&this[i(472)](),l.x=e.x,l.y=e.y;var a=t.x-l.x,n=t.y-l.y;u=Math.sqrt(a*a+n*n),f=Math[i(478)](n,a),m=o,p=h,this.toWorld(l,c)},movePinch(e,t,i){const a=r;w&&this[a(472)]();var s=t.x-e.x,l=t.y-e.y,d=Math.sqrt(s*s+l*l);if(o=m*(d/u),!i){var v=Math.atan2(l,s);h=p+(v-f)}this[a(472)](),g.x=e.x-c.x*n[0]-c.y*n[2],g.y=e.y-c.x*n[1]-c.y*n[3],w=!0},setContext(e){d=e,w=!0}};return window[e(483)]=v[e(447)],v})()};function r(e,t){e-=444;return a()[e]}var s,o,h,l,c,d,u,m,p=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},f=(e,t,i)=>(p(e,t,"read from private field"),i?i.call(e):t.get(e)),g=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},w=(e,t,i,a)=>(p(e,t,"write to private field"),t.set(e,i),i),v=(e,t,i)=>(p(e,t,"access private method"),i),x=new Uint8Array(8),b=new DataView(x.buffer),y=e=>[(e%256+256)%256],C=e=>(b.setUint16(0,e,!1),[x[0],x[1]]),k=e=>(b.setUint32(0,e,!1),[x[1],x[2],x[3]]),j=e=>(b.setUint32(0,e,!1),[x[0],x[1],x[2],x[3]]),M=e=>(b.setUint32(0,Math.floor(e/2**32),!1),b.setUint32(4,e,!1),[x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7]]),T=e=>(b.setInt16(0,256*e,!1),[x[0],x[1]]),N=e=>(b.setInt32(0,65536*e,!1),[x[0],x[1],x[2],x[3]]),S=e=>(b.setInt32(0,2**30*e,!1),[x[0],x[1],x[2],x[3]]),D=(e,t=!1)=>{let i=Array(e.length).fill(null).map((t,i)=>e.charCodeAt(i));return t&&i.push(0),i},z=e=>e&&e[e.length-1],L=e=>{let t;for(let i of e)(!t||i.presentationTimestamp>t.presentationTimestamp)&&(t=i);return t},E=(e,t,i=!0)=>{let a=e*t;return i?Math.round(a):a},B=e=>{let t=e*(Math.PI/180),i=Math.cos(t),a=Math.sin(t);return[i,a,0,-a,i,0,0,0,1]},W=B(0),O=e=>[N(e[0]),N(e[1]),S(e[2]),N(e[3]),N(e[4]),S(e[5]),N(e[6]),N(e[7]),S(e[8])],R=e=>e?"object"!=typeof e?e:Array.isArray(e)?e.map(R):Object.fromEntries(Object.entries(e).map(([e,t])=>[e,R(t)])):e,A=e=>e>=0&&e<2**32,I=(e,t,i)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:i}),P=(e,t,i,a,n)=>I(e,[y(t),k(i),a??[]],n),F=e=>({type:"mdat",largeSize:e}),U=(e,t,i=!1)=>I("moov",null,[H(t,e),...e.map(e=>V(e,t)),i?pe(e):null]),H=(e,t)=>{let i=E(Math.max(0,...t.filter(e=>e.samples.length>0).map(e=>{const t=L(e.samples);return t.presentationTimestamp+t.duration})),Et),a=Math.max(...t.map(e=>e.id))+1,n=!A(e)||!A(i),r=n?M:j;return P("mvhd",+n,0,[r(e),r(e),j(Et),r(i),N(1),T(1),Array(10).fill(0),O(W),Array(24).fill(0),j(a)])},V=(e,t)=>I("trak",null,[Y(e,t),X(e,t)]),Y=(e,t)=>{let i,a=L(e.samples),n=E(a?a.presentationTimestamp+a.duration:0,Et),r=!A(t)||!A(n),s=r?M:j;return i="video"===e.info.type?"number"==typeof e.info.rotation?B(e.info.rotation):e.info.rotation:W,P("tkhd",+r,3,[s(t),s(t),j(e.id),j(0),s(n),Array(8).fill(0),C(0),C(0),T("audio"===e.info.type?1:0),C(0),O(i),N("video"===e.info.type?e.info.width:0),N("video"===e.info.type?e.info.height:0)])},X=(e,t)=>I("mdia",null,[$(e,t),q("video"===e.info.type?"vide":"soun"),G(e)]),$=(e,t)=>{let i=L(e.samples),a=E(i?i.presentationTimestamp+i.duration:0,e.timescale),n=!A(t)||!A(a),r=n?M:j;return P("mdhd",+n,0,[r(t),r(t),j(e.timescale),r(a),C(21956),C(0)])},q=e=>P("hdlr",0,0,[D("mhlr"),D(e),j(0),j(0),j(0),D("mp4-muxer-hdlr",!0)]),G=e=>I("minf",null,["video"===e.info.type?Q():Z(),J(),ee(e)]),Q=()=>P("vmhd",0,1,[C(0),C(0),C(0),C(0)]),Z=()=>P("smhd",0,0,[C(0),C(0)]),J=()=>I("dinf",null,[K()]),K=()=>P("dref",0,0,[j(1)],[_()]),_=()=>P("url ",0,1),ee=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(e=>0!==e.sampleCompositionTimeOffset);return I("stbl",null,[te(e),he(e),le(e),ce(e),de(e),ue(e),t?me(e):null])},te=e=>P("stsd",0,0,[j(1)],["video"===e.info.type?ie(Me[e.info.codec],e):oe(Ne[e.info.codec],e)]),ie=(e,t)=>{return I(e,[Array(6).fill(0),C(1),C(0),C(0),Array(12).fill(0),C(t.info.width),C(t.info.height),j(4718592),j(4718592),j(0),C(1),Array(32).fill(0),C(24),(i=65535,b.setInt16(0,i,!1),[x[0],x[1]])],[Te[t.info.codec](t),t.info.decoderConfig.colorSpace?se(t):null]);var i},ae={bt709:1,bt470bg:5,smpte170m:6},ne={bt709:1,smpte170m:6,"iec61966-2-1":13},re={rgb:0,bt709:1,bt470bg:5,smpte170m:6},se=e=>I("colr",[D("nclx"),C(ae[e.info.decoderConfig.colorSpace.primaries]),C(ne[e.info.decoderConfig.colorSpace.transfer]),C(re[e.info.decoderConfig.colorSpace.matrix]),y((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),oe=(e,t)=>I(e,[Array(6).fill(0),C(1),C(0),C(0),j(0),C(t.info.numberOfChannels),C(16),C(0),C(0),N(t.info.sampleRate)],[Se[t.info.codec](t)]),he=e=>P("stts",0,0,[j(e.timeToSampleTable.length),e.timeToSampleTable.map(e=>[j(e.sampleCount),j(e.sampleDelta)])]),le=e=>{if(e.samples.every(e=>"key"===e.type))return null;let t=[...e.samples.entries()].filter(([,e])=>"key"===e.type);return P("stss",0,0,[j(t.length),t.map(([e])=>j(e+1))])},ce=e=>P("stsc",0,0,[j(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(e=>[j(e.firstChunk),j(e.samplesPerChunk),j(1)])]),de=e=>P("stsz",0,0,[j(0),j(e.samples.length),e.samples.map(e=>j(e.size))]),ue=e=>e.finalizedChunks.length>0&&z(e.finalizedChunks).offset>=2**32?P("co64",0,0,[j(e.finalizedChunks.length),e.finalizedChunks.map(e=>M(e.offset))]):P("stco",0,0,[j(e.finalizedChunks.length),e.finalizedChunks.map(e=>j(e.offset))]),me=e=>P("ctts",0,0,[j(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(e=>[j(e.sampleCount),j(e.sampleCompositionTimeOffset)])]),pe=e=>I("mvex",null,e.map(fe)),fe=e=>P("trex",0,0,[j(e.id),j(1),j(0),j(0),j(0)]),ge=(e,t)=>I("moof",null,[we(e),...t.map(xe)]),we=e=>P("mfhd",0,0,[j(e)]),ve=e=>{let t=0,i=0,a="delta"===e.type;return i|=+a,t|=a?1:2,t<<24|i<<16},xe=e=>I("traf",null,[be(e),ye(e),Ce(e)]),be=e=>{let t=0;t|=8,t|=16,t|=32,t|=131072;let i=e.currentChunk.samples[1]??e.currentChunk.samples[0],a={duration:i.timescaleUnitsToNextSample,size:i.size,flags:ve(i)};return P("tfhd",0,131128,[j(e.id),j(a.duration),j(a.size),j(a.flags)])},ye=e=>P("tfdt",1,0,[M(E(e.currentChunk.startTimestamp,e.timescale))]),Ce=e=>{let t=e.currentChunk.samples.map(e=>e.timescaleUnitsToNextSample),i=e.currentChunk.samples.map(e=>e.size),a=e.currentChunk.samples.map(ve),n=e.currentChunk.samples.map(t=>E(t.presentationTimestamp-t.decodeTimestamp,e.timescale)),r=new Set(t),s=new Set(i),o=new Set(a),h=new Set(n),l=2===o.size&&a[0]!==a[1],c=r.size>1,d=s.size>1,u=!l&&o.size>1,m=h.size>1||[...h].some(e=>0!==e),p=0;return p|=1,p|=4*+l,p|=256*+c,p|=512*+d,p|=1024*+u,p|=2048*+m,P("trun",1,p,[j(e.currentChunk.samples.length),j(e.currentChunk.offset-e.currentChunk.moofOffset||0),l?j(a[0]):[],e.currentChunk.samples.map((e,r)=>{return[c?j(t[r]):[],d?j(i[r]):[],u?j(a[r]):[],m?(s=n[r],b.setInt32(0,s,!1),[x[0],x[1],x[2],x[3]]):[]];var s})])},ke=(e,t)=>P("tfra",1,0,[j(e.id),j(63),j(e.finalizedChunks.length),e.finalizedChunks.map(i=>[M(E(i.startTimestamp,e.timescale)),M(i.moofOffset),j(t+1),j(1),j(1)])]),je=()=>P("mfro",0,0,[j(0)]),Me={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Te={avc:e=>e.info.decoderConfig&&I("avcC",[...new Uint8Array(e.info.decoderConfig.description)]),hevc:e=>e.info.decoderConfig&&I("hvcC",[...new Uint8Array(e.info.decoderConfig.description)]),vp9:e=>{if(!e.info.decoderConfig)return null;let t=e.info.decoderConfig;if(!t.colorSpace)throw new Error("'colorSpace' is required in the decoder config for VP9.");let i=t.codec.split("."),a=Number(i[1]),n=Number(i[2]),r=0+(Number(i[3])<<4)+Number(t.colorSpace.fullRange);return P("vpcC",1,0,[y(a),y(n),y(r),y(2),y(2),y(2),C(0)])},av1:()=>I("av1C",[129,0,0,0])},Ne={aac:"mp4a",opus:"Opus"},Se={aac:e=>{let t=new Uint8Array(e.info.decoderConfig.description);return P("esds",0,0,[j(58753152),y(32+t.byteLength),C(1),y(0),j(75530368),y(18+t.byteLength),y(64),y(21),k(0),j(130071),j(130071),j(92307584),y(t.byteLength),...t,j(109084800),y(1),y(2)])},opus:e=>{let t=3840,i=0;const a=e.info.decoderConfig?.description;if(a){if(a.byteLength<18)throw new TypeError("Invalid decoder description provided for Opus; must be at least 18 bytes long.");const e=ArrayBuffer.isView(a)?new DataView(a.buffer,a.byteOffset,a.byteLength):new DataView(a);t=e.getUint16(10,!0),i=e.getInt16(14,!0)}return I("dOps",[y(0),y(e.info.numberOfChannels),C(t),j(e.info.sampleRate),T(i),y(0)])}},De=class{},ze=class extends De{constructor(){super(...arguments),this.buffer=null}},Le=class extends De{constructor(e){if(super(),this.options=e,"object"!=typeof e)throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(e.onData){if("function"!=typeof e.onData)throw new TypeError("options.onData, when provided, must be a function.");if(e.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(void 0!==e.chunked&&"boolean"!=typeof e.chunked)throw new TypeError("options.chunked, when provided, must be a boolean.");if(void 0!==e.chunkSize&&(!Number.isInteger(e.chunkSize)||e.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},Ee=class extends De{constructor(e,t){if(super(),this.stream=e,this.options=t,!(e instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(void 0!==t&&"object"!=typeof t)throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(t&&void 0!==t.chunkSize&&(!Number.isInteger(t.chunkSize)||t.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Be=class{constructor(){this.pos=0,g(this,s,new Uint8Array(8)),g(this,o,new DataView(f(this,s).buffer)),this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){f(this,o).setUint32(0,e,!1),this.write(f(this,s).subarray(0,4))}writeU64(e){f(this,o).setUint32(0,Math.floor(e/2**32),!1),f(this,o).setUint32(4,e,!1),this.write(f(this,s).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)f(this,o).setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.write(f(this,s));e.length%8!=0&&this.write(f(this,s).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let t=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let n of e.children)n&&this.writeBox(n);let i=this.pos,a=e.size??i-t;this.seek(t),this.writeBoxHeader(e,a),this.seek(i)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let t=this.pos;this.seek(this.offsets.get(e)),this.writeBox(e),this.seek(t)}measureBox(e){if(e.contents&&!e.children){return this.measureBoxHeader(e)+e.contents.byteLength}{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(let i of e.children)i&&(t+=this.measureBox(i));return t}}};s=new WeakMap,o=new WeakMap;var We=class extends Be{constructor(e){super(),g(this,u),g(this,h,void 0),g(this,l,new ArrayBuffer(65536)),g(this,c,new Uint8Array(f(this,l))),g(this,d,0),w(this,h,e)}write(e){v(this,u,m).call(this,this.pos+e.byteLength),f(this,c).set(e,this.pos),this.pos+=e.byteLength,w(this,d,Math.max(f(this,d),this.pos))}finalize(){v(this,u,m).call(this,this.pos),f(this,h).buffer=f(this,l).slice(0,Math.max(f(this,d),this.pos))}};h=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakSet,m=function(e){let t=f(this,l).byteLength;for(;t<e;)t*=2;if(t===f(this,l).byteLength)return;let i=new ArrayBuffer(t),a=new Uint8Array(i);a.set(f(this,c),0),w(this,l,i),w(this,c,a)};var Oe,Re,Ae,Ie,Pe,Fe,Ue,He,Ve,Ye,Xe,$e,qe,Ge=class extends Be{constructor(e){super(),g(this,Fe),g(this,He),g(this,Ye),g(this,$e),g(this,Oe,void 0),g(this,Re,[]),g(this,Ae,void 0),g(this,Ie,void 0),g(this,Pe,[]),w(this,Oe,e),w(this,Ae,e.options?.chunked??!1),w(this,Ie,e.options?.chunkSize??16777216)}write(e){f(this,Re).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){if(0===f(this,Re).length)return;let e=[],t=[...f(this,Re)].sort((e,t)=>e.start-t.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let a=e[e.length-1],n=t[i];n.start<=a.start+a.size?a.size=Math.max(a.size,n.start+n.data.byteLength-a.start):e.push({start:n.start,size:n.data.byteLength})}for(let i of e){i.data=new Uint8Array(i.size);for(let e of f(this,Re))i.start<=e.start&&e.start<i.start+i.size&&i.data.set(e.data,e.start-i.start);f(this,Ae)?(v(this,Fe,Ue).call(this,i.data,i.start),v(this,$e,qe).call(this)):f(this,Oe).options.onData?.(i.data,i.start)}f(this,Re).length=0}finalize(){f(this,Ae)&&v(this,$e,qe).call(this,!0)}};Oe=new WeakMap,Re=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,Pe=new WeakMap,Fe=new WeakSet,Ue=function(e,t){let i=f(this,Pe).findIndex(e=>e.start<=t&&t<e.start+f(this,Ie));-1===i&&(i=v(this,Ye,Xe).call(this,t));let a=f(this,Pe)[i],n=t-a.start,r=e.subarray(0,Math.min(f(this,Ie)-n,e.byteLength));a.data.set(r,n);let s={start:n,end:n+r.byteLength};if(v(this,He,Ve).call(this,a,s),0===a.written[0].start&&a.written[0].end===f(this,Ie)&&(a.shouldFlush=!0),f(this,Pe).length>2){for(let e=0;e<f(this,Pe).length-1;e++)f(this,Pe)[e].shouldFlush=!0;v(this,$e,qe).call(this)}r.byteLength<e.byteLength&&v(this,Fe,Ue).call(this,e.subarray(r.byteLength),t+r.byteLength)},He=new WeakSet,Ve=function(e,t){let i=0,a=e.written.length-1,n=-1;for(;i<=a;){let r=Math.floor(i+(a-i+1)/2);e.written[r].start<=t.start?(i=r+1,n=r):a=r-1}for(e.written.splice(n+1,0,t),(-1===n||e.written[n].end<t.start)&&n++;n<e.written.length-1&&e.written[n].end>=e.written[n+1].start;)e.written[n].end=Math.max(e.written[n].end,e.written[n+1].end),e.written.splice(n+1,1)},Ye=new WeakSet,Xe=function(e){let t={start:Math.floor(e/f(this,Ie))*f(this,Ie),data:new Uint8Array(f(this,Ie)),written:[],shouldFlush:!1};return f(this,Pe).push(t),f(this,Pe).sort((e,t)=>e.start-t.start),f(this,Pe).indexOf(t)},$e=new WeakSet,qe=function(e=!1){for(let t=0;t<f(this,Pe).length;t++){let i=f(this,Pe)[t];if(i.shouldFlush||e){for(let e of i.written)f(this,Oe).options.onData?.(i.data.subarray(e.start,e.end),i.start+e.start);f(this,Pe).splice(t--,1)}}};var Qe,Ze,Je,Ke,_e,et,tt,it,at,nt,rt,st,ot,ht,lt,ct,dt,ut,mt,pt,ft,gt,wt,vt,xt,bt,yt,Ct,kt,jt,Mt,Tt,Nt,St,Dt,zt,Lt=class extends Ge{constructor(e){super(new Le({onData:(t,i)=>e.stream.write({type:"write",data:t,position:i}),chunked:!0,chunkSize:e.options?.chunkSize}))}},Et=1e3,Bt=["avc","hevc","vp9","av1"],Wt=["aac","opus"],Ot=["strict","offset","cross-track-offset"],Rt=class{constructor(e){if(g(this,ot),g(this,lt),g(this,dt),g(this,mt),g(this,ft),g(this,wt),g(this,xt),g(this,yt),g(this,kt),g(this,Mt),g(this,Nt),g(this,Dt),g(this,Qe,void 0),g(this,Ze,void 0),g(this,Je,void 0),g(this,Ke,void 0),g(this,_e,null),g(this,et,null),g(this,tt,Math.floor(Date.now()/1e3)+2082844800),g(this,it,[]),g(this,at,1),g(this,nt,[]),g(this,rt,[]),g(this,st,!1),v(this,ot,ht).call(this,e),e.video=R(e.video),e.audio=R(e.audio),e.fastStart=R(e.fastStart),this.target=e.target,w(this,Qe,{firstTimestampBehavior:"strict",...e}),e.target instanceof ze)w(this,Ze,new We(e.target));else if(e.target instanceof Le)w(this,Ze,new Ge(e.target));else{if(!(e.target instanceof Ee))throw new Error(`Invalid target: ${e.target}`);w(this,Ze,new Lt(e.target))}v(this,mt,pt).call(this),v(this,lt,ct).call(this)}addVideoChunk(e,t,i,a){if(!(e instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.");if(t&&"object"!=typeof t)throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");if(void 0!==a&&!Number.isFinite(a))throw new TypeError("addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.");let n=new Uint8Array(e.byteLength);e.copyTo(n),this.addVideoChunkRaw(n,e.type,i??e.timestamp,e.duration,t,a)}addVideoChunkRaw(e,t,i,a,n,r){if(!(e instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(a)||a<0)throw new TypeError("addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.");if(n&&"object"!=typeof n)throw new TypeError("addVideoChunkRaw's fifth argument (meta), when provided, must be an object.");if(void 0!==r&&!Number.isFinite(r))throw new TypeError("addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.");if(v(this,Dt,zt).call(this),!f(this,Qe).video)throw new Error("No video track declared.");if("object"==typeof f(this,Qe).fastStart&&f(this,_e).samples.length===f(this,Qe).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${f(this,Qe).fastStart.expectedVideoChunks}).`);let s=v(this,wt,vt).call(this,f(this,_e),e,t,i,a,n,r);if("fragmented"===f(this,Qe).fastStart&&f(this,et)){for(;f(this,rt).length>0&&f(this,rt)[0].decodeTimestamp<=s.decodeTimestamp;){let e=f(this,rt).shift();v(this,xt,bt).call(this,f(this,et),e)}s.decodeTimestamp<=f(this,et).lastDecodeTimestamp?v(this,xt,bt).call(this,f(this,_e),s):f(this,nt).push(s)}else v(this,xt,bt).call(this,f(this,_e),s)}addAudioChunk(e,t,i){if(!(e instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.");if(t&&"object"!=typeof t)throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addAudioChunkRaw(a,e.type,i??e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,i,a,n){if(!(e instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(a)||a<0)throw new TypeError("addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.");if(n&&"object"!=typeof n)throw new TypeError("addAudioChunkRaw's fifth argument (meta), when provided, must be an object.");if(v(this,Dt,zt).call(this),!f(this,Qe).audio)throw new Error("No audio track declared.");if("object"==typeof f(this,Qe).fastStart&&f(this,et).samples.length===f(this,Qe).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${f(this,Qe).fastStart.expectedAudioChunks}).`);let r=v(this,wt,vt).call(this,f(this,et),e,t,i,a,n);if("fragmented"===f(this,Qe).fastStart&&f(this,_e)){for(;f(this,nt).length>0&&f(this,nt)[0].decodeTimestamp<=r.decodeTimestamp;){let e=f(this,nt).shift();v(this,xt,bt).call(this,f(this,_e),e)}r.decodeTimestamp<=f(this,_e).lastDecodeTimestamp?v(this,xt,bt).call(this,f(this,et),r):f(this,rt).push(r)}else v(this,xt,bt).call(this,f(this,et),r)}finalize(){if(f(this,st))throw new Error("Cannot finalize a muxer more than once.");if("fragmented"===f(this,Qe).fastStart){for(let e of f(this,nt))v(this,xt,bt).call(this,f(this,_e),e);for(let e of f(this,rt))v(this,xt,bt).call(this,f(this,et),e);v(this,Mt,Tt).call(this,!1)}else f(this,_e)&&v(this,kt,jt).call(this,f(this,_e)),f(this,et)&&v(this,kt,jt).call(this,f(this,et));let e=[f(this,_e),f(this,et)].filter(Boolean);if("in-memory"===f(this,Qe).fastStart){let t;for(let a=0;a<2;a++){let i=U(e,f(this,tt)),a=f(this,Ze).measureBox(i);t=f(this,Ze).measureBox(f(this,Ke));let n=f(this,Ze).pos+a+t;for(let e of f(this,it)){e.offset=n;for(let{data:i}of e.samples)n+=i.byteLength,t+=i.byteLength}if(n<2**32)break;t>=2**32&&(f(this,Ke).largeSize=!0)}let i=U(e,f(this,tt));f(this,Ze).writeBox(i),f(this,Ke).size=t,f(this,Ze).writeBox(f(this,Ke));for(let e of f(this,it))for(let t of e.samples)f(this,Ze).write(t.data),t.data=null}else if("fragmented"===f(this,Qe).fastStart){let t=f(this,Ze).pos,i=(e=>I("mfra",null,[...e.map(ke),je()]))(e);f(this,Ze).writeBox(i);let a=f(this,Ze).pos-t;f(this,Ze).seek(f(this,Ze).pos-4),f(this,Ze).writeU32(a)}else{let t=f(this,Ze).offsets.get(f(this,Ke)),i=f(this,Ze).pos-t;f(this,Ke).size=i,f(this,Ke).largeSize=i>=2**32,f(this,Ze).patchBox(f(this,Ke));let a=U(e,f(this,tt));if("object"==typeof f(this,Qe).fastStart){f(this,Ze).seek(f(this,Je)),f(this,Ze).writeBox(a);let e=t-f(this,Ze).pos;f(this,Ze).writeBox({type:"free",size:e})}else f(this,Ze).writeBox(a)}v(this,Nt,St).call(this),f(this,Ze).finalize(),w(this,st,!0)}};function At(e,t){e-=495;return It()[e]}function It(){const e=["fillStyle","19972IcAOTG","width","17302070LePsnH","drawImage","image/png","1327760MVuLcA","map","createElement","8UqCyao","all","crossOrigin","fillRect","1EPTVas","height","1410864SaraUx","src","anonymous","309QmgmhC","getContext","1143418rxKEWE","3526145ZWwLKV","canvas","white","4318623sTSQSp"];return(It=function(){return e})()}Qe=new WeakMap,Ze=new WeakMap,Je=new WeakMap,Ke=new WeakMap,_e=new WeakMap,et=new WeakMap,tt=new WeakMap,it=new WeakMap,at=new WeakMap,nt=new WeakMap,rt=new WeakMap,st=new WeakMap,ot=new WeakSet,ht=function(e){if("object"!=typeof e)throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(e.target instanceof De))throw new TypeError("The target must be provided and an instance of Target.");if(e.video){if(!Bt.includes(e.video.codec))throw new TypeError(`Unsupported video codec: ${e.video.codec}`);if(!Number.isInteger(e.video.width)||e.video.width<=0)throw new TypeError(`Invalid video width: ${e.video.width}. Must be a positive integer.`);if(!Number.isInteger(e.video.height)||e.video.height<=0)throw new TypeError(`Invalid video height: ${e.video.height}. Must be a positive integer.`);const t=e.video.rotation;if("number"==typeof t&&![0,90,180,270].includes(t))throw new TypeError(`Invalid video rotation: ${t}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(t)&&(9!==t.length||t.some(e=>"number"!=typeof e)))throw new TypeError(`Invalid video transformation matrix: ${t.join()}`);if(void 0!==e.video.frameRate&&(!Number.isInteger(e.video.frameRate)||e.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${e.video.frameRate}. Must be a positive integer.`)}if(e.audio){if(!Wt.includes(e.audio.codec))throw new TypeError(`Unsupported audio codec: ${e.audio.codec}`);if(!Number.isInteger(e.audio.numberOfChannels)||e.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${e.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(e.audio.sampleRate)||e.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${e.audio.sampleRate}. Must be a positive integer.`)}if(e.firstTimestampBehavior&&!Ot.includes(e.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if("object"==typeof e.fastStart){if(e.video){if(void 0===e.fastStart.expectedVideoChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(!Number.isInteger(e.fastStart.expectedVideoChunks)||e.fastStart.expectedVideoChunks<0)throw new TypeError("'expectedVideoChunks' must be a non-negative integer.")}if(e.audio){if(void 0===e.fastStart.expectedAudioChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedAudioChunks'.");if(!Number.isInteger(e.fastStart.expectedAudioChunks)||e.fastStart.expectedAudioChunks<0)throw new TypeError("'expectedAudioChunks' must be a non-negative integer.")}}else if(![!1,"in-memory","fragmented"].includes(e.fastStart))throw new TypeError("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.");if(void 0!==e.minFragmentDuration&&(!Number.isFinite(e.minFragmentDuration)||e.minFragmentDuration<0))throw new TypeError("'minFragmentDuration' must be a non-negative number.")},lt=new WeakSet,ct=function(){var e;if(f(this,Ze).writeBox((e={holdsAvc:"avc"===f(this,Qe).video?.codec,fragmented:"fragmented"===f(this,Qe).fastStart}).fragmented?I("ftyp",[D("iso5"),j(512),D("iso5"),D("iso6"),D("mp41")]):I("ftyp",[D("isom"),j(512),D("isom"),e.holdsAvc?D("avc1"):[],D("mp41")])),w(this,Je,f(this,Ze).pos),"in-memory"===f(this,Qe).fastStart)w(this,Ke,F(!1));else if("fragmented"===f(this,Qe).fastStart);else{if("object"==typeof f(this,Qe).fastStart){let e=v(this,dt,ut).call(this);f(this,Ze).seek(f(this,Ze).pos+e)}w(this,Ke,F(!0)),f(this,Ze).writeBox(f(this,Ke))}v(this,Nt,St).call(this)},dt=new WeakSet,ut=function(){if("object"!=typeof f(this,Qe).fastStart)return;let e=0,t=[f(this,Qe).fastStart.expectedVideoChunks,f(this,Qe).fastStart.expectedAudioChunks];for(let i of t)i&&(e+=8*Math.ceil(2/3*i),e+=4*i,e+=12*Math.ceil(2/3*i),e+=4*i,e+=8*i);return e+=4096,e},mt=new WeakSet,pt=function(){if(f(this,Qe).video&&w(this,_e,{id:1,info:{type:"video",codec:f(this,Qe).video.codec,width:f(this,Qe).video.width,height:f(this,Qe).video.height,rotation:f(this,Qe).video.rotation??0,decoderConfig:null},timescale:f(this,Qe).video.frameRate??57600,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),f(this,Qe).audio&&(w(this,et,{id:f(this,Qe).video?2:1,info:{type:"audio",codec:f(this,Qe).audio.codec,numberOfChannels:f(this,Qe).audio.numberOfChannels,sampleRate:f(this,Qe).audio.sampleRate,decoderConfig:null},timescale:f(this,Qe).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),"aac"===f(this,Qe).audio.codec)){let e=v(this,ft,gt).call(this,2,f(this,Qe).audio.sampleRate,f(this,Qe).audio.numberOfChannels);f(this,et).info.decoderConfig={codec:f(this,Qe).audio.codec,description:e,numberOfChannels:f(this,Qe).audio.numberOfChannels,sampleRate:f(this,Qe).audio.sampleRate}}},ft=new WeakSet,gt=function(e,t,i){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),n=i,r="";r+=e.toString(2).padStart(5,"0"),r+=a.toString(2).padStart(4,"0"),15===a&&(r+=t.toString(2).padStart(24,"0")),r+=n.toString(2).padStart(4,"0");let s=8*Math.ceil(r.length/8);r=r.padEnd(s,"0");let o=new Uint8Array(r.length/8);for(let h=0;h<r.length;h+=8)o[h/8]=parseInt(r.slice(h,h+8),2);return o},wt=new WeakSet,vt=function(e,t,i,a,n,r,s){let o=a/1e6,h=(a-(s??0))/1e6,l=n/1e6,c=v(this,yt,Ct).call(this,o,h,e);return o=c.presentationTimestamp,h=c.decodeTimestamp,r?.decoderConfig&&(null===e.info.decoderConfig?e.info.decoderConfig=r.decoderConfig:Object.assign(e.info.decoderConfig,r.decoderConfig)),{presentationTimestamp:o,decodeTimestamp:h,duration:l,data:t,size:t.byteLength,type:i,timescaleUnitsToNextSample:E(l,e.timescale)}},xt=new WeakSet,bt=function(e,t){"fragmented"!==f(this,Qe).fastStart&&e.samples.push(t);const i=E(t.presentationTimestamp-t.decodeTimestamp,e.timescale);if(null!==e.lastTimescaleUnits){let a=E(t.decodeTimestamp,e.timescale,!1),n=Math.round(a-e.lastTimescaleUnits);if(e.lastTimescaleUnits+=n,e.lastSample.timescaleUnitsToNextSample=n,"fragmented"!==f(this,Qe).fastStart){let t=z(e.timeToSampleTable);1===t.sampleCount?(t.sampleDelta=n,t.sampleCount++):t.sampleDelta===n?t.sampleCount++:(t.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:n}));const a=z(e.compositionTimeOffsetTable);a.sampleCompositionTimeOffset===i?a.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i})}}else e.lastTimescaleUnits=0,"fragmented"!==f(this,Qe).fastStart&&(e.timeToSampleTable.push({sampleCount:1,sampleDelta:E(t.duration,e.timescale)}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i}));e.lastSample=t;let a=!1;if(e.currentChunk){let i=t.presentationTimestamp-e.currentChunk.startTimestamp;if("fragmented"===f(this,Qe).fastStart){let n=f(this,_e)??f(this,et);const r=f(this,Qe).minFragmentDuration??1;e===n&&"key"===t.type&&i>=r&&(a=!0,v(this,Mt,Tt).call(this))}else a=i>=.5}else a=!0;a&&(e.currentChunk&&v(this,kt,jt).call(this,e),e.currentChunk={startTimestamp:t.presentationTimestamp,samples:[]}),e.currentChunk.samples.push(t)},yt=new WeakSet,Ct=function(e,t,i){const a="strict"===f(this,Qe).firstTimestampBehavior,n=-1===i.lastDecodeTimestamp;if(a&&n&&0!==t)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${t}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`);if("offset"===f(this,Qe).firstTimestampBehavior||"cross-track-offset"===f(this,Qe).firstTimestampBehavior){let a;void 0===i.firstDecodeTimestamp&&(i.firstDecodeTimestamp=t),a="offset"===f(this,Qe).firstTimestampBehavior?i.firstDecodeTimestamp:Math.min(f(this,_e)?.firstDecodeTimestamp??1/0,f(this,et)?.firstDecodeTimestamp??1/0),t-=a,e-=a}if(t<i.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${1e6*i.lastDecodeTimestamp} to ${1e6*t}).`);return i.lastDecodeTimestamp=t,{presentationTimestamp:e,decodeTimestamp:t}},kt=new WeakSet,jt=function(e){if("fragmented"===f(this,Qe).fastStart)throw new Error("Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.");if(e.currentChunk)if(e.finalizedChunks.push(e.currentChunk),f(this,it).push(e.currentChunk),0!==e.compactlyCodedChunkTable.length&&z(e.compactlyCodedChunkTable).samplesPerChunk===e.currentChunk.samples.length||e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:e.currentChunk.samples.length}),"in-memory"!==f(this,Qe).fastStart){e.currentChunk.offset=f(this,Ze).pos;for(let t of e.currentChunk.samples)f(this,Ze).write(t.data),t.data=null;v(this,Nt,St).call(this)}else e.currentChunk.offset=0},Mt=new WeakSet,Tt=function(e=!0){if("fragmented"!==f(this,Qe).fastStart)throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let t=[f(this,_e),f(this,et)].filter(e=>e&&e.currentChunk);if(0===t.length)return;let i=(a=this,n=at,{set _(e){w(a,n,e)},get _(){return f(a,n,r)}})._++;var a,n,r;if(1===i){let e=U(t,f(this,tt),!0);f(this,Ze).writeBox(e)}let s=f(this,Ze).pos,o=ge(i,t);f(this,Ze).writeBox(o);{let e=F(!1),i=0;for(let n of t)for(let e of n.currentChunk.samples)i+=e.size;let a=f(this,Ze).measureBox(e)+i;a>=2**32&&(e.largeSize=!0,a=f(this,Ze).measureBox(e)+i),e.size=a,f(this,Ze).writeBox(e)}for(let c of t){c.currentChunk.offset=f(this,Ze).pos,c.currentChunk.moofOffset=s;for(let e of c.currentChunk.samples)f(this,Ze).write(e.data),e.data=null}let h=f(this,Ze).pos;f(this,Ze).seek(f(this,Ze).offsets.get(o));let l=ge(i,t);f(this,Ze).writeBox(l),f(this,Ze).seek(h);for(let c of t)c.finalizedChunks.push(c.currentChunk),f(this,it).push(c.currentChunk),c.currentChunk=null;e&&v(this,Nt,St).call(this)},Nt=new WeakSet,St=function(){f(this,Ze)instanceof Ge&&f(this,Ze).flush()},Dt=new WeakSet,zt=function(){if(f(this,st))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")},function(){const e=At,t=It();for(;;)try{if(303359===-parseInt(e(510))/1*(-parseInt(e(517))/2)+-parseInt(e(515))/3*(parseInt(e(498))/4)+-parseInt(e(503))/5+-parseInt(e(512))/6+-parseInt(e(518))/7+parseInt(e(506))/8*(-parseInt(e(496))/9)+parseInt(e(500))/10)break;t.push(t.shift())}catch(i){t.push(t.shift())}}();const Pt=({frames:i,clearFrames:a,onionSkinEnabled:n,fps:r=10,width:s=512,height:o=512})=>{const[h,l]=e.useState(!1),c=async()=>{if(!i.length)return;if(!("VideoEncoder"in window))return void alert("WebCodecs not supported in this browser (Chrome 94+ required)");l(!0);let e=null;try{if(n){const t=await async function(e,t=512,i=512){const a=At;return await Promise[a(507)](e[a(504)](async e=>{const n=a;try{const a=document[n(505)](n(519));a[n(499)]=t,a[n(511)]=i;const r=a[n(516)]("2d");if(!r)return e;r[n(497)]=n(495),r[n(509)](0,0,t,i);const s=new Image;return s[n(508)]=n(514),new Promise(o=>{const h=n;s.onload=()=>{const n=At;try{r[n(501)](s,0,0,t,i);const e=a.toDataURL(n(502));o(e)}catch(h){o(e)}},s.onerror=()=>{o(e)},s[h(513)]=e})}catch(r){return e}}))}(i,s,o);e=await Ft(t,r,s,o)}else e=await Ft(i,r,s,o);if(e){const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="animation.mp4",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t),a?.()}}catch(t){alert("Failed to encode video. Check console for details.")}finally{l(!1)}};return e.useEffect(()=>{c()},[]),t.jsx("button",{className:"z-100 relative",onClick:c,disabled:h||!i.length,children:h?"Encoding...":"Download MP4"})};async function Ft(e,t,i,a){return new Promise(async(n,r)=>{const s=new Rt({fastStart:"in-memory",target:new ze,video:{codec:"avc",width:i,height:a}}),o=new OffscreenCanvas(i,a),h=o.getContext("2d",{willReadFrequently:!0});if(!h)return void r(new Error("Could not get 2D context"));const l=new VideoEncoder({output:(e,t)=>{s.addVideoChunk(e,t)},error:e=>{r(new Error(`Encoder error: ${e.message}`))}});await l.configure({codec:"avc1.42001e",width:i,height:a,bitrate:2e6,framerate:t});const c=[];for(const t of e)try{const e=new Image;e.src=t,await e.decode();const n=await createImageBitmap(e,{resizeWidth:i,resizeHeight:a,resizeQuality:"high"});c.push(n)}catch(u){return void r(new Error(`Failed to load frame: ${u}`))}for(let e=0;e<c.length;e++){h.clearRect(0,0,i,a),h.drawImage(c[e],0,0,i,a);const n=new VideoFrame(o,{timestamp:Math.round(1e6*e/t),duration:Math.round(1e6/t)});try{l.encode(n)}finally{n.close()}e%5==0&&await new Promise(e=>setTimeout(e,0))}await l.flush(),s.finalize();let{buffer:d}=s.target;n(new Blob([d],{type:"video/mp4"})),c.forEach(e=>e.close())})}const Ut=({isOpen:i,onClose:a,onLoadFrames:n,currentFrameCount:r})=>{const[s,o]=e.useState([]),[h,l]=e.useState([]),[c,d]=e.useState(!1),[u,m]=e.useState(!0),p=e.useRef(null);if(!i)return null;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:t.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files){const t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/")||e.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(t);const i=t.map(e=>URL.createObjectURL(e));l(i)}},children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Load Frames"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white","aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-gray-300 mb-2",children:"Select image files to load as animation frames. Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP."}),t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("input",{type:"checkbox",id:"autoCreate",checked:u,onChange:e=>m(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"autoCreate",className:"text-gray-300",children:"Auto-create frames from selected files"})]})]}),t.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer mb-4 "+(s.length>0?"bg-gray-700":"bg-gray-900"),onClick:()=>p.current?.click(),children:[t.jsx("input",{type:"file",ref:p,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/")||e.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(t);const i=t.map(e=>URL.createObjectURL(e));l(i)}},className:"hidden",multiple:!0,accept:"image/*"}),0===s.length?t.jsxs("div",{children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),t.jsx("p",{className:"mt-2 text-gray-400",children:"Click or drag and drop image files here"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Supports PNG, JPG, JPEG, GIF, BMP, WebP"})]}):t.jsxs("div",{children:[t.jsxs("p",{className:"text-white mb-2",children:[s.length," file",1!==s.length?"s":""," selected"]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Click to select more files"})]})]}),h.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Preview"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-60 overflow-y-auto",children:h.map((e,i)=>t.jsxs("div",{className:"relative group",children:[t.jsx("img",{src:e,alt:`Preview ${i+1}`,className:"w-full h-24 object-contain bg-gray-200 rounded"}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs",children:i+1})})]},i))})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(0!==s.length){if(r>0){if(!window.confirm(`This will replace your current ${r} frame(s) with ${s.length} new frame(s). Are you sure you want to continue?`))return}d(!0);try{const e=await Promise.all(s.map(e=>new Promise((t,i)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=()=>i(a.error),a.readAsDataURL(e)})));n(e),a()}catch(e){alert("Error loading frames. Please try again.")}finally{d(!1)}}else alert("Please select at least one image file.")},disabled:c||0===s.length,className:"px-4 py-2 rounded-lg transition-colors "+(c||0===s.length?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:c?"Loading...":`Load ${s.length} Frame${1!==s.length?"s":""}`})]})]})})})};
/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function Ht(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function Vt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(i),!0).forEach(function(t){qt(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ht(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function Yt(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function Xt(e){return Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(e)}function $t(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Yt(a.key),a)}}function qt(e,t,i){return(t=Yt(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Gt(e){return function(e){if(Array.isArray(e))return Qt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Qt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Qt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Zt="undefined"!=typeof window&&void 0!==window.document,Jt=Zt?window:{},Kt=!(!Zt||!Jt.document.documentElement)&&"ontouchstart"in Jt.document.documentElement,_t=!!Zt&&"PointerEvent"in Jt,ei="cropper",ti="all",ii="crop",ai="move",ni="zoom",ri="e",si="w",oi="s",hi="n",li="ne",ci="nw",di="se",ui="sw",mi="".concat(ei,"-crop"),pi="".concat(ei,"-disabled"),fi="".concat(ei,"-hidden"),gi="".concat(ei,"-hide"),wi="".concat(ei,"-invisible"),vi="".concat(ei,"-modal"),xi="".concat(ei,"-move"),bi="".concat(ei,"Action"),yi="".concat(ei,"Preview"),Ci="crop",ki="move",ji="none",Mi="crop",Ti="cropend",Ni="cropmove",Si="cropstart",Di="dblclick",zi=_t?"pointerdown":Kt?"touchstart":"mousedown",Li=_t?"pointermove":Kt?"touchmove":"mousemove",Ei=_t?"pointerup pointercancel":Kt?"touchend touchcancel":"mouseup",Bi="ready",Wi="resize",Oi="wheel",Ri="zoom",Ai="image/jpeg",Ii=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Pi=/^data:/,Fi=/^data:image\/jpeg;base64,/,Ui=/^img|canvas$/i,Hi={viewMode:0,dragMode:Ci,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Vi=Number.isNaN||Jt.isNaN;function Yi(e){return"number"==typeof e&&!Vi(e)}var Xi=function(e){return e>0&&e<1/0};function $i(e){return void 0===e}function qi(e){return"object"===Xt(e)&&null!==e}var Gi=Object.prototype.hasOwnProperty;function Qi(e){if(!qi(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&Gi.call(i,"isPrototypeOf")}catch(a){return!1}}function Zi(e){return"function"==typeof e}var Ji=Array.prototype.slice;function Ki(e){return Array.from?Array.from(e):Ji.call(e)}function _i(e,t){return e&&Zi(t)&&(Array.isArray(e)||Yi(e.length)?Ki(e).forEach(function(i,a){t.call(e,i,a,e)}):qi(e)&&Object.keys(e).forEach(function(i){t.call(e,e[i],i,e)})),e}var ea=Object.assign||function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return qi(e)&&i.length>0&&i.forEach(function(t){qi(t)&&Object.keys(t).forEach(function(i){e[i]=t[i]})}),e},ta=/\.\d*(?:0|9){12}\d*$/;function ia(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return ta.test(e)?Math.round(e*t)/t:e}var aa=/^width|height|left|top|marginLeft|marginTop$/;function na(e,t){var i=e.style;_i(t,function(e,t){aa.test(t)&&Yi(e)&&(e="".concat(e,"px")),i[t]=e})}function ra(e,t){if(t)if(Yi(e.length))_i(e,function(e){ra(e,t)});else if(e.classList)e.classList.add(t);else{var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function sa(e,t){t&&(Yi(e.length)?_i(e,function(e){sa(e,t)}):e.classList?e.classList.remove(t):e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function oa(e,t,i){t&&(Yi(e.length)?_i(e,function(e){oa(e,t,i)}):i?ra(e,t):sa(e,t))}var ha=/([a-z\d])([A-Z])/g;function la(e){return e.replace(ha,"$1-$2").toLowerCase()}function ca(e,t){return qi(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(la(t)))}function da(e,t,i){qi(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(la(t)),i)}var ua=/\s\s*/,ma=function(){var e=!1;if(Zt){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(e){t=e}});Jt.addEventListener("test",i,a),Jt.removeEventListener("test",i,a)}return e}();function pa(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;t.trim().split(ua).forEach(function(t){if(!ma){var r=e.listeners;r&&r[t]&&r[t][i]&&(n=r[t][i],delete r[t][i],0===Object.keys(r[t]).length&&delete r[t],0===Object.keys(r).length&&delete e.listeners)}e.removeEventListener(t,n,a)})}function fa(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;t.trim().split(ua).forEach(function(t){if(a.once&&!ma){var r=e.listeners,s=void 0===r?{}:r;n=function(){delete s[t][i],e.removeEventListener(t,n,a);for(var r=arguments.length,o=new Array(r),h=0;h<r;h++)o[h]=arguments[h];i.apply(e,o)},s[t]||(s[t]={}),s[t][i]&&e.removeEventListener(t,s[t][i],a),s[t][i]=n,e.listeners=s}e.addEventListener(t,n,a)})}function ga(e,t,i){var a;return Zi(Event)&&Zi(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,i),e.dispatchEvent(a)}function wa(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var va=Jt.location,xa=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ba(e){var t=e.match(xa);return null!==t&&(t[1]!==va.protocol||t[2]!==va.hostname||t[3]!==va.port)}function ya(e){var t="timestamp=".concat((new Date).getTime());return e+(-1===e.indexOf("?")?"?":"&")+t}function Ca(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,n=e.translateX,r=e.translateY,s=[];Yi(n)&&0!==n&&s.push("translateX(".concat(n,"px)")),Yi(r)&&0!==r&&s.push("translateY(".concat(r,"px)")),Yi(t)&&0!==t&&s.push("rotate(".concat(t,"deg)")),Yi(i)&&1!==i&&s.push("scaleX(".concat(i,")")),Yi(a)&&1!==a&&s.push("scaleY(".concat(a,")"));var o=s.length?s.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function ka(e,t){var i=e.pageX,a=e.pageY,n={endX:i,endY:a};return t?n:Vt({startX:i,startY:a},n)}function ja(e){var t=e.aspectRatio,i=e.height,a=e.width,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",r=Xi(a),s=Xi(i);if(r&&s){var o=i*t;"contain"===n&&o>a||"cover"===n&&o<a?i=a/t:a=i*t}else r?i=a/t:s&&(a=i*t);return{width:a,height:i}}var Ma=String.fromCharCode;var Ta=/^data:.*,/;function Na(e){var t,i=new DataView(e);try{var a,n,r;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var s=i.byteLength,o=2;o+1<s;){if(255===i.getUint8(o)&&225===i.getUint8(o+1)){n=o;break}o+=1}if(n){var h=n+10;if("Exif"===function(e,t,i){var a="";i+=t;for(var n=t;n<i;n+=1)a+=Ma(e.getUint8(n));return a}(i,n+4,4)){var l=i.getUint16(h);if(((a=18761===l)||19789===l)&&42===i.getUint16(h+2,a)){var c=i.getUint32(h+4,a);c>=8&&(r=h+c)}}}if(r){var d,u,m=i.getUint16(r,a);for(u=0;u<m;u+=1)if(d=r+12*u+2,274===i.getUint16(d,a)){d+=8,t=i.getUint16(d,a),i.setUint16(d,1,a);break}}}catch(p){t=1}return t}var Sa={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,t=this.options,i=this.container,a=this.cropper,n=Number(t.minContainerWidth),r=Number(t.minContainerHeight);ra(a,fi),sa(e,fi);var s={width:Math.max(i.offsetWidth,n>=0?n:200),height:Math.max(i.offsetHeight,r>=0?r:100)};this.containerData=s,na(a,{width:s.width,height:s.height}),ra(e,fi),sa(a,fi)},initCanvas:function(){var e=this.containerData,t=this.imageData,i=this.options.viewMode,a=Math.abs(t.rotate)%180==90,n=a?t.naturalHeight:t.naturalWidth,r=a?t.naturalWidth:t.naturalHeight,s=n/r,o=e.width,h=e.height;e.height*s>e.width?3===i?o=e.height*s:h=e.width/s:3===i?h=e.width/s:o=e.height*s;var l={aspectRatio:s,naturalWidth:n,naturalHeight:r,width:o,height:h};this.canvasData=l,this.limited=1===i||2===i,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(e.width-l.width)/2,l.top=(e.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=ea({},l)},limitCanvas:function(e,t){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,s=i.viewMode,o=n.aspectRatio,h=this.cropped&&r;if(e){var l=Number(i.minCanvasWidth)||0,c=Number(i.minCanvasHeight)||0;s>1?(l=Math.max(l,a.width),c=Math.max(c,a.height),3===s&&(c*o>l?l=c*o:c=l/o)):s>0&&(l?l=Math.max(l,h?r.width:0):c?c=Math.max(c,h?r.height:0):h&&(l=r.width,(c=r.height)*o>l?l=c*o:c=l/o));var d=ja({aspectRatio:o,width:l,height:c});l=d.width,c=d.height,n.minWidth=l,n.minHeight=c,n.maxWidth=1/0,n.maxHeight=1/0}if(t)if(s>(h?0:1)){var u=a.width-n.width,m=a.height-n.height;n.minLeft=Math.min(0,u),n.minTop=Math.min(0,m),n.maxLeft=Math.max(0,u),n.maxTop=Math.max(0,m),h&&this.limited&&(n.minLeft=Math.min(r.left,r.left+(r.width-n.width)),n.minTop=Math.min(r.top,r.top+(r.height-n.height)),n.maxLeft=r.left,n.maxTop=r.top,2===s&&(n.width>=a.width&&(n.minLeft=Math.min(0,u),n.maxLeft=Math.max(0,u)),n.height>=a.height&&(n.minTop=Math.min(0,m),n.maxTop=Math.max(0,m))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=a.width,n.maxTop=a.height},renderCanvas:function(e,t){var i=this.canvasData,a=this.imageData;if(t){var n=function(e){var t=e.width,i=e.height,a=e.degree;if(90==(a=Math.abs(a)%180))return{width:i,height:t};var n=a%90*Math.PI/180,r=Math.sin(n),s=Math.cos(n),o=t*s+i*r,h=t*r+i*s;return a>90?{width:h,height:o}:{width:o,height:h}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),r=n.width,s=n.height,o=i.width*(r/i.naturalWidth),h=i.height*(s/i.naturalHeight);i.left-=(o-i.width)/2,i.top-=(h-i.height)/2,i.width=o,i.height=h,i.aspectRatio=r/s,i.naturalWidth=r,i.naturalHeight=s,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,na(this.canvas,ea({width:i.width,height:i.height},Ca({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var t=this.canvasData,i=this.imageData,a=i.naturalWidth*(t.width/t.naturalWidth),n=i.naturalHeight*(t.height/t.naturalHeight);ea(i,{width:a,height:n,left:(t.width-a)/2,top:(t.height-n)/2}),na(this.image,ea({width:i.width,height:i.height},Ca(ea({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,t=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,a=Number(e.autoCropArea)||.8,n={width:t.width,height:t.height};i&&(t.height*i>t.width?n.height=n.width/i:n.width=n.height*i),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*a),n.height=Math.max(n.minHeight,n.height*a),n.left=t.left+(t.width-n.width)/2,n.top=t.top+(t.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=ea({},n)},limitCropBox:function(e,t){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,s=this.limited,o=i.aspectRatio;if(e){var h=Number(i.minCropBoxWidth)||0,l=Number(i.minCropBoxHeight)||0,c=s?Math.min(a.width,n.width,n.width+n.left,a.width-n.left):a.width,d=s?Math.min(a.height,n.height,n.height+n.top,a.height-n.top):a.height;h=Math.min(h,a.width),l=Math.min(l,a.height),o&&(h&&l?l*o>h?l=h/o:h=l*o:h?l=h/o:l&&(h=l*o),d*o>c?d=c/o:c=d*o),r.minWidth=Math.min(h,c),r.minHeight=Math.min(l,d),r.maxWidth=c,r.maxHeight=d}t&&(s?(r.minLeft=Math.max(0,n.left),r.minTop=Math.max(0,n.top),r.maxLeft=Math.min(a.width,n.left+n.width)-r.width,r.maxTop=Math.min(a.height,n.top+n.height)-r.height):(r.minLeft=0,r.minTop=0,r.maxLeft=a.width-r.width,r.maxTop=a.height-r.height))},renderCropBox:function(){var e=this.options,t=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&da(this.face,bi,i.width>=t.width&&i.height>=t.height?ai:ti),na(this.cropBox,ea({width:i.width,height:i.height},Ca({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ga(this.element,Mi,this.getData())}},Da={initPreview:function(){var e=this.element,t=this.crossOrigin,i=this.options.preview,a=t?this.crossOriginUrl:this.url,n=e.alt||"The image to preview",r=document.createElement("img");if(t&&(r.crossOrigin=t),r.src=a,r.alt=n,this.viewBox.appendChild(r),this.viewBoxImage=r,i){var s=i;"string"==typeof i?s=e.ownerDocument.querySelectorAll(i):i.querySelector&&(s=[i]),this.previews=s,_i(s,function(e){var i=document.createElement("img");da(e,yi,{width:e.offsetWidth,height:e.offsetHeight,html:e.innerHTML}),t&&(i.crossOrigin=t),i.src=a,i.alt=n,i.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',e.innerHTML="",e.appendChild(i)})}},resetPreview:function(){_i(this.previews,function(e){var t=ca(e,yi);na(e,{width:t.width,height:t.height}),e.innerHTML=t.html,function(e,t){if(qi(e[t]))try{delete e[t]}catch(i){e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch(i){e.dataset[t]=void 0}else e.removeAttribute("data-".concat(la(t)))}(e,yi)})},preview:function(){var e=this.imageData,t=this.canvasData,i=this.cropBoxData,a=i.width,n=i.height,r=e.width,s=e.height,o=i.left-t.left-e.left,h=i.top-t.top-e.top;this.cropped&&!this.disabled&&(na(this.viewBoxImage,ea({width:r,height:s},Ca(ea({translateX:-o,translateY:-h},e)))),_i(this.previews,function(t){var i=ca(t,yi),l=i.width,c=i.height,d=l,u=c,m=1;a&&(u=n*(m=l/a)),n&&u>c&&(d=a*(m=c/n),u=c),na(t,{width:d,height:u}),na(t.getElementsByTagName("img")[0],ea({width:r*m,height:s*m},Ca(ea({translateX:-o*m,translateY:-h*m},e))))}))}},za={bind:function(){var e=this.element,t=this.options,i=this.cropper;Zi(t.cropstart)&&fa(e,Si,t.cropstart),Zi(t.cropmove)&&fa(e,Ni,t.cropmove),Zi(t.cropend)&&fa(e,Ti,t.cropend),Zi(t.crop)&&fa(e,Mi,t.crop),Zi(t.zoom)&&fa(e,Ri,t.zoom),fa(i,zi,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&fa(i,Oi,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&fa(i,Di,this.onDblclick=this.dblclick.bind(this)),fa(e.ownerDocument,Li,this.onCropMove=this.cropMove.bind(this)),fa(e.ownerDocument,Ei,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&fa(window,Wi,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,t=this.options,i=this.cropper;Zi(t.cropstart)&&pa(e,Si,t.cropstart),Zi(t.cropmove)&&pa(e,Ni,t.cropmove),Zi(t.cropend)&&pa(e,Ti,t.cropend),Zi(t.crop)&&pa(e,Mi,t.crop),Zi(t.zoom)&&pa(e,Ri,t.zoom),pa(i,zi,this.onCropStart),t.zoomable&&t.zoomOnWheel&&pa(i,Oi,this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&pa(i,Di,this.onDblclick),pa(e.ownerDocument,Li,this.onCropMove),pa(e.ownerDocument,Ei,this.onCropEnd),t.responsive&&pa(window,Wi,this.onResize)}},La={resize:function(){if(!this.disabled){var e,t,i=this.options,a=this.container,n=this.containerData,r=a.offsetWidth/n.width,s=a.offsetHeight/n.height,o=Math.abs(r-1)>Math.abs(s-1)?r:s;if(1!==o)i.restore&&(e=this.getCanvasData(),t=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(_i(e,function(t,i){e[i]=t*o})),this.setCropBoxData(_i(t,function(e,i){t[i]=e*o})))}},dblclick:function(){var e,t;this.disabled||this.options.dragMode===ji||this.setDragMode((e=this.dragBox,t=mi,(e.classList?e.classList.contains(t):e.className.indexOf(t)>-1)?ki:Ci))},wheel:function(e){var t=this,i=Number(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(e.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){t.wheeling=!1},50),e.deltaY?a=e.deltaY>0?1:-1:e.wheelDelta?a=-e.wheelDelta/120:e.detail&&(a=e.detail>0?1:-1),this.zoom(-a*i,e)))},cropStart:function(e){var t=e.buttons,i=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(Yi(t)&&1!==t||Yi(i)&&0!==i||e.ctrlKey))){var a,n=this.options,r=this.pointers;e.changedTouches?_i(e.changedTouches,function(e){r[e.identifier]=ka(e)}):r[e.pointerId||0]=ka(e),a=Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?ni:ca(e.target,bi),Ii.test(a)&&!1!==ga(this.element,Si,{originalEvent:e,action:a})&&(e.preventDefault(),this.action=a,this.cropping=!1,a===ii&&(this.cropping=!0,ra(this.dragBox,vi)))}},cropMove:function(e){var t=this.action;if(!this.disabled&&t){var i=this.pointers;e.preventDefault(),!1!==ga(this.element,Ni,{originalEvent:e,action:t})&&(e.changedTouches?_i(e.changedTouches,function(e){ea(i[e.identifier]||{},ka(e,!0))}):ea(i[e.pointerId||0]||{},ka(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var t=this.action,i=this.pointers;e.changedTouches?_i(e.changedTouches,function(e){delete i[e.identifier]}):delete i[e.pointerId||0],t&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,oa(this.dragBox,vi,this.cropped&&this.options.modal)),ga(this.element,Ti,{originalEvent:e,action:t}))}}},Ea={change:function(e){var t,i=this.options,a=this.canvasData,n=this.containerData,r=this.cropBoxData,s=this.pointers,o=this.action,h=i.aspectRatio,l=r.left,c=r.top,d=r.width,u=r.height,m=l+d,p=c+u,f=0,g=0,w=n.width,v=n.height,x=!0;!h&&e.shiftKey&&(h=d&&u?d/u:1),this.limited&&(f=r.minLeft,g=r.minTop,w=f+Math.min(n.width,a.width,a.left+a.width),v=g+Math.min(n.height,a.height,a.top+a.height));var b=s[Object.keys(s)[0]],y={x:b.endX-b.startX,y:b.endY-b.startY},C=function(e){switch(e){case ri:m+y.x>w&&(y.x=w-m);break;case si:l+y.x<f&&(y.x=f-l);break;case hi:c+y.y<g&&(y.y=g-c);break;case oi:p+y.y>v&&(y.y=v-p)}};switch(o){case ti:l+=y.x,c+=y.y;break;case ri:if(y.x>=0&&(m>=w||h&&(c<=g||p>=v))){x=!1;break}C(ri),(d+=y.x)<0&&(o=si,l-=d=-d),h&&(u=d/h,c+=(r.height-u)/2);break;case hi:if(y.y<=0&&(c<=g||h&&(l<=f||m>=w))){x=!1;break}C(hi),u-=y.y,c+=y.y,u<0&&(o=oi,c-=u=-u),h&&(d=u*h,l+=(r.width-d)/2);break;case si:if(y.x<=0&&(l<=f||h&&(c<=g||p>=v))){x=!1;break}C(si),d-=y.x,l+=y.x,d<0&&(o=ri,l-=d=-d),h&&(u=d/h,c+=(r.height-u)/2);break;case oi:if(y.y>=0&&(p>=v||h&&(l<=f||m>=w))){x=!1;break}C(oi),(u+=y.y)<0&&(o=hi,c-=u=-u),h&&(d=u*h,l+=(r.width-d)/2);break;case li:if(h){if(y.y<=0&&(c<=g||m>=w)){x=!1;break}C(hi),u-=y.y,c+=y.y,d=u*h}else C(hi),C(ri),y.x>=0?m<w?d+=y.x:y.y<=0&&c<=g&&(x=!1):d+=y.x,y.y<=0?c>g&&(u-=y.y,c+=y.y):(u-=y.y,c+=y.y);d<0&&u<0?(o=ui,c-=u=-u,l-=d=-d):d<0?(o=ci,l-=d=-d):u<0&&(o=di,c-=u=-u);break;case ci:if(h){if(y.y<=0&&(c<=g||l<=f)){x=!1;break}C(hi),u-=y.y,c+=y.y,d=u*h,l+=r.width-d}else C(hi),C(si),y.x<=0?l>f?(d-=y.x,l+=y.x):y.y<=0&&c<=g&&(x=!1):(d-=y.x,l+=y.x),y.y<=0?c>g&&(u-=y.y,c+=y.y):(u-=y.y,c+=y.y);d<0&&u<0?(o=di,c-=u=-u,l-=d=-d):d<0?(o=li,l-=d=-d):u<0&&(o=ui,c-=u=-u);break;case ui:if(h){if(y.x<=0&&(l<=f||p>=v)){x=!1;break}C(si),d-=y.x,l+=y.x,u=d/h}else C(oi),C(si),y.x<=0?l>f?(d-=y.x,l+=y.x):y.y>=0&&p>=v&&(x=!1):(d-=y.x,l+=y.x),y.y>=0?p<v&&(u+=y.y):u+=y.y;d<0&&u<0?(o=li,c-=u=-u,l-=d=-d):d<0?(o=di,l-=d=-d):u<0&&(o=ci,c-=u=-u);break;case di:if(h){if(y.x>=0&&(m>=w||p>=v)){x=!1;break}C(ri),u=(d+=y.x)/h}else C(oi),C(ri),y.x>=0?m<w?d+=y.x:y.y>=0&&p>=v&&(x=!1):d+=y.x,y.y>=0?p<v&&(u+=y.y):u+=y.y;d<0&&u<0?(o=ci,c-=u=-u,l-=d=-d):d<0?(o=ui,l-=d=-d):u<0&&(o=li,c-=u=-u);break;case ai:this.move(y.x,y.y),x=!1;break;case ni:this.zoom(function(e){var t=Vt({},e),i=0;return _i(e,function(e,a){delete t[a],_i(t,function(t){var a=Math.abs(e.startX-t.startX),n=Math.abs(e.startY-t.startY),r=Math.abs(e.endX-t.endX),s=Math.abs(e.endY-t.endY),o=Math.sqrt(a*a+n*n),h=(Math.sqrt(r*r+s*s)-o)/o;Math.abs(h)>Math.abs(i)&&(i=h)})}),i}(s),e),x=!1;break;case ii:if(!y.x||!y.y){x=!1;break}t=wa(this.cropper),l=b.startX-t.left,c=b.startY-t.top,d=r.minWidth,u=r.minHeight,y.x>0?o=y.y>0?di:li:y.x<0&&(l-=d,o=y.y>0?ui:ci),y.y<0&&(c-=u),this.cropped||(sa(this.cropBox,fi),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}x&&(r.width=d,r.height=u,r.left=l,r.top=c,this.action=o,this.renderCropBox()),_i(s,function(e){e.startX=e.endX,e.startY=e.endY})}},Ba={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&ra(this.dragBox,vi),sa(this.cropBox,fi),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=ea({},this.initialImageData),this.canvasData=ea({},this.initialCanvasData),this.cropBoxData=ea({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(ea(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),sa(this.dragBox,vi),ra(this.cropBox,fi)),this},replace:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),t?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,_i(this.previews,function(t){t.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,sa(this.cropper,pi)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,ra(this.cropper,pi)),this},destroy:function(){var e=this.element;return e[ei]?(e[ei]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=i.left,n=i.top;return this.moveTo($i(e)?e:a+Number(e),$i(t)?t:n+Number(t))},moveTo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(Yi(e)&&(i.left=e,a=!0),Yi(t)&&(i.top=t,a=!0),a&&this.renderCanvas(!0)),this},zoom:function(e,t){var i=this.canvasData;return e=(e=Number(e))<0?1/(1-e):1+e,this.zoomTo(i.width*e/i.naturalWidth,null,t)},zoomTo:function(e,t,i){var a=this.options,n=this.canvasData,r=n.width,s=n.height,o=n.naturalWidth,h=n.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&a.zoomable){var l=o*e,c=h*e;if(!1===ga(this.element,Ri,{ratio:e,oldRatio:r/o,originalEvent:i}))return this;if(i){var d=this.pointers,u=wa(this.cropper),m=d&&Object.keys(d).length?function(e){var t=0,i=0,a=0;return _i(e,function(e){var n=e.startX,r=e.startY;t+=n,i+=r,a+=1}),{pageX:t/=a,pageY:i/=a}}(d):{pageX:i.pageX,pageY:i.pageY};n.left-=(l-r)*((m.pageX-u.left-n.left)/r),n.top-=(c-s)*((m.pageY-u.top-n.top)/s)}else Qi(t)&&Yi(t.x)&&Yi(t.y)?(n.left-=(l-r)*((t.x-n.left)/r),n.top-=(c-s)*((t.y-n.top)/s)):(n.left-=(l-r)/2,n.top-=(c-s)/2);n.width=l,n.height=c,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return Yi(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var t=this.imageData.scaleY;return this.scale(e,Yi(t)?t:1)},scaleY:function(e){var t=this.imageData.scaleX;return this.scale(Yi(t)?t:1,e)},scale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.imageData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(Yi(e)&&(i.scaleX=e,a=!0),Yi(t)&&(i.scaleY=t,a=!0),a&&this.renderCanvas(!0,!0)),this},getData:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.options,a=this.imageData,n=this.canvasData,r=this.cropBoxData;if(this.ready&&this.cropped){e={x:r.left-n.left,y:r.top-n.top,width:r.width,height:r.height};var s=a.width/a.naturalWidth;if(_i(e,function(t,i){e[i]=t/s}),t){var o=Math.round(e.y+e.height),h=Math.round(e.x+e.width);e.x=Math.round(e.x),e.y=Math.round(e.y),e.width=h-e.x,e.height=o-e.y}}else e={x:0,y:0,width:0,height:0};return i.rotatable&&(e.rotate=a.rotate||0),i.scalable&&(e.scaleX=a.scaleX||1,e.scaleY=a.scaleY||1),e},setData:function(e){var t=this.options,i=this.imageData,a=this.canvasData,n={};if(this.ready&&!this.disabled&&Qi(e)){var r=!1;t.rotatable&&Yi(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,r=!0),t.scalable&&(Yi(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,r=!0),Yi(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);var s=i.width/i.naturalWidth;Yi(e.x)&&(n.left=e.x*s+a.left),Yi(e.y)&&(n.top=e.y*s+a.top),Yi(e.width)&&(n.width=e.width*s),Yi(e.height)&&(n.height=e.height*s),this.setCropBoxData(n)}return this},getContainerData:function(){return this.ready?ea({},this.containerData):{}},getImageData:function(){return this.sized?ea({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,t={};return this.ready&&_i(["left","top","width","height","naturalWidth","naturalHeight"],function(i){t[i]=e[i]}),t},setCanvasData:function(e){var t=this.canvasData,i=t.aspectRatio;return this.ready&&!this.disabled&&Qi(e)&&(Yi(e.left)&&(t.left=e.left),Yi(e.top)&&(t.top=e.top),Yi(e.width)?(t.width=e.width,t.height=e.width/i):Yi(e.height)&&(t.height=e.height,t.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var e,t=this.cropBoxData;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(e){var t,i,a=this.cropBoxData,n=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&Qi(e)&&(Yi(e.left)&&(a.left=e.left),Yi(e.top)&&(a.top=e.top),Yi(e.width)&&e.width!==a.width&&(t=!0,a.width=e.width),Yi(e.height)&&e.height!==a.height&&(i=!0,a.height=e.height),n&&(t?a.height=a.width/n:i&&(a.width=a.height*n)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var t=this.canvasData,i=function(e,t,i,a){var n=t.aspectRatio,r=t.naturalWidth,s=t.naturalHeight,o=t.rotate,h=void 0===o?0:o,l=t.scaleX,c=void 0===l?1:l,d=t.scaleY,u=void 0===d?1:d,m=i.aspectRatio,p=i.naturalWidth,f=i.naturalHeight,g=a.fillColor,w=void 0===g?"transparent":g,v=a.imageSmoothingEnabled,x=void 0===v||v,b=a.imageSmoothingQuality,y=void 0===b?"low":b,C=a.maxWidth,k=void 0===C?1/0:C,j=a.maxHeight,M=void 0===j?1/0:j,T=a.minWidth,N=void 0===T?0:T,S=a.minHeight,D=void 0===S?0:S,z=document.createElement("canvas"),L=z.getContext("2d"),E=ja({aspectRatio:m,width:k,height:M}),B=ja({aspectRatio:m,width:N,height:D},"cover"),W=Math.min(E.width,Math.max(B.width,p)),O=Math.min(E.height,Math.max(B.height,f)),R=ja({aspectRatio:n,width:k,height:M}),A=ja({aspectRatio:n,width:N,height:D},"cover"),I=Math.min(R.width,Math.max(A.width,r)),P=Math.min(R.height,Math.max(A.height,s)),F=[-I/2,-P/2,I,P];return z.width=ia(W),z.height=ia(O),L.fillStyle=w,L.fillRect(0,0,W,O),L.save(),L.translate(W/2,O/2),L.rotate(h*Math.PI/180),L.scale(c,u),L.imageSmoothingEnabled=x,L.imageSmoothingQuality=y,L.drawImage.apply(L,[e].concat(Gt(F.map(function(e){return Math.floor(ia(e))})))),L.restore(),z}(this.image,this.imageData,t,e);if(!this.cropped)return i;var a=this.getData(e.rounded),n=a.x,r=a.y,s=a.width,o=a.height,h=i.width/Math.floor(t.naturalWidth);1!==h&&(n*=h,r*=h,s*=h,o*=h);var l=s/o,c=ja({aspectRatio:l,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),d=ja({aspectRatio:l,width:e.minWidth||0,height:e.minHeight||0},"cover"),u=ja({aspectRatio:l,width:e.width||(1!==h?i.width:s),height:e.height||(1!==h?i.height:o)}),m=u.width,p=u.height;m=Math.min(c.width,Math.max(d.width,m)),p=Math.min(c.height,Math.max(d.height,p));var f=document.createElement("canvas"),g=f.getContext("2d");f.width=ia(m),f.height=ia(p),g.fillStyle=e.fillColor||"transparent",g.fillRect(0,0,m,p);var w=e.imageSmoothingEnabled,v=void 0===w||w,x=e.imageSmoothingQuality;g.imageSmoothingEnabled=v,x&&(g.imageSmoothingQuality=x);var b,y,C,k,j,M,T=i.width,N=i.height,S=n,D=r;S<=-s||S>T?(S=0,b=0,C=0,j=0):S<=0?(C=-S,S=0,j=b=Math.min(T,s+S)):S<=T&&(C=0,j=b=Math.min(s,T-S)),b<=0||D<=-o||D>N?(D=0,y=0,k=0,M=0):D<=0?(k=-D,D=0,M=y=Math.min(N,o+D)):D<=N&&(k=0,M=y=Math.min(o,N-D));var z=[S,D,b,y];if(j>0&&M>0){var L=m/s;z.push(C*L,k*L,j*L,M*L)}return g.drawImage.apply(g,[i].concat(Gt(z.map(function(e){return Math.floor(ia(e))})))),f},setAspectRatio:function(e){var t=this.options;return this.disabled||$i(e)||(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var t=this.options,i=this.dragBox,a=this.face;if(this.ready&&!this.disabled){var n=e===Ci,r=t.movable&&e===ki;e=n||r?e:ji,t.dragMode=e,da(i,bi,e),oa(i,mi,n),oa(i,xi,r),t.cropBoxMovable||(da(a,bi,e),oa(a,mi,n),oa(a,xi,r))}return this}},Wa=Jt.Cropper,Oa=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t||!Ui.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=ea({},Hi,Qi(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return t=e,i=[{key:"init",value:function(){var e,t=this.element,i=t.tagName.toLowerCase();if(!t[ei]){if(t[ei]=this,"img"===i){if(this.isImg=!0,e=t.getAttribute("src")||"",this.originalUrl=e,!e)return;e=t.src}else"canvas"===i&&window.HTMLCanvasElement&&(e=t.toDataURL());this.load(e)}}},{key:"load",value:function(e){var t=this;if(e){this.url=e,this.imageData={};var i=this.element,a=this.options;if(a.rotatable||a.scalable||(a.checkOrientation=!1),a.checkOrientation&&window.ArrayBuffer)if(Pi.test(e))Fi.test(e)?this.read((n=e.replace(Ta,""),r=atob(n),s=new ArrayBuffer(r.length),_i(o=new Uint8Array(s),function(e,t){o[t]=r.charCodeAt(t)}),s)):this.clone();else{var n,r,s,o,h=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=h,h.onabort=l,h.onerror=l,h.ontimeout=l,h.onprogress=function(){h.getResponseHeader("content-type")!==Ai&&h.abort()},h.onload=function(){t.read(h.response)},h.onloadend=function(){t.reloading=!1,t.xhr=null},a.checkCrossOrigin&&ba(e)&&i.crossOrigin&&(e=ya(e)),h.open("GET",e,!0),h.responseType="arraybuffer",h.withCredentials="use-credentials"===i.crossOrigin,h.send()}else this.clone()}}},{key:"read",value:function(e){var t=this.options,i=this.imageData,a=Na(e),n=0,r=1,s=1;if(a>1){this.url=function(e,t){for(var i=[],a=new Uint8Array(e);a.length>0;)i.push(Ma.apply(null,Ki(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}(e,Ai);var o=function(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:a}}(a);n=o.rotate,r=o.scaleX,s=o.scaleY}t.rotatable&&(i.rotate=n),t.scalable&&(i.scaleX=r,i.scaleY=s),this.clone()}},{key:"clone",value:function(){var e=this.element,t=this.url,i=e.crossOrigin,a=t;this.options.checkCrossOrigin&&ba(t)&&(i||(i="anonymous"),a=ya(t)),this.crossOrigin=i,this.crossOriginUrl=a;var n=document.createElement("img");i&&(n.crossOrigin=i),n.src=a||t,n.alt=e.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),ra(n,gi),e.parentNode.insertBefore(n,e.nextSibling)}},{key:"start",value:function(){var e=this,t=this.image;t.onload=null,t.onerror=null,this.sizing=!0;var i=Jt.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Jt.navigator.userAgent),a=function(t,i){ea(e.imageData,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),e.initialImageData=ea({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(!t.naturalWidth||i){var n=document.createElement("img"),r=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){a(n.width,n.height),i||r.removeChild(n)},n.src=t.src,i||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",r.appendChild(n))}else a(t.naturalWidth,t.naturalHeight)}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var e=this.element,t=this.options,i=this.image,a=e.parentNode,n=document.createElement("div");n.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var r=n.querySelector(".".concat(ei,"-container")),s=r.querySelector(".".concat(ei,"-canvas")),o=r.querySelector(".".concat(ei,"-drag-box")),h=r.querySelector(".".concat(ei,"-crop-box")),l=h.querySelector(".".concat(ei,"-face"));this.container=a,this.cropper=r,this.canvas=s,this.dragBox=o,this.cropBox=h,this.viewBox=r.querySelector(".".concat(ei,"-view-box")),this.face=l,s.appendChild(i),ra(e,fi),a.insertBefore(r,e.nextSibling),sa(i,gi),this.initPreview(),this.bind(),t.initialAspectRatio=Math.max(0,t.initialAspectRatio)||NaN,t.aspectRatio=Math.max(0,t.aspectRatio)||NaN,t.viewMode=Math.max(0,Math.min(3,Math.round(t.viewMode)))||0,ra(h,fi),t.guides||ra(h.getElementsByClassName("".concat(ei,"-dashed")),fi),t.center||ra(h.getElementsByClassName("".concat(ei,"-center")),fi),t.background&&ra(r,"".concat(ei,"-bg")),t.highlight||ra(l,wi),t.cropBoxMovable&&(ra(l,xi),da(l,bi,ti)),t.cropBoxResizable||(ra(h.getElementsByClassName("".concat(ei,"-line")),fi),ra(h.getElementsByClassName("".concat(ei,"-point")),fi)),this.render(),this.ready=!0,this.setDragMode(t.dragMode),t.autoCrop&&this.crop(),this.setData(t.data),Zi(t.ready)&&fa(e,Bi,t.ready,{once:!0}),ga(e,Bi)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var e=this.cropper.parentNode;e&&e.removeChild(this.cropper),sa(this.element,fi)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],a=[{key:"noConflict",value:function(){return window.Cropper=Wa,e}},{key:"setDefaults",value:function(e){ea(Hi,Qi(e)&&e)}}],i&&$t(t.prototype,i),a&&$t(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,a}();ea(Oa.prototype,Sa,Da,za,La,Ea,Ba);var Ra=function(){return Ra=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Ra.apply(this,arguments)};function Aa(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(i[a[n]]=e[a[n]])}return i}var Ia=["aspectRatio","autoCrop","autoCropArea","background","center","checkCrossOrigin","checkOrientation","cropBoxMovable","cropBoxResizable","data","dragMode","guides","highlight","initialAspectRatio","minCanvasHeight","minCanvasWidth","minContainerHeight","minContainerWidth","minCropBoxHeight","minCropBoxWidth","modal","movable","preview","responsive","restore","rotatable","scalable","toggleDragModeOnDblclick","viewMode","wheelZoomRatio","zoomOnTouch","zoomOnWheel","zoomable","cropstart","cropmove","cropend","crop","zoom","ready"],Pa={opacity:0,maxWidth:"100%"},Fa=i.forwardRef(function(t,a){var n=Aa(t,[]),r=n.dragMode,s=void 0===r?"crop":r,o=n.src,h=n.style,l=n.className,c=n.crossOrigin,d=n.scaleX,u=n.scaleY,m=n.enable,p=n.zoomTo,f=n.rotateTo,g=n.alt,w=void 0===g?"picture":g,v=n.ready,x=n.onInitialized,b=Aa(n,["dragMode","src","style","className","crossOrigin","scaleX","scaleY","enable","zoomTo","rotateTo","alt","ready","onInitialized"]),y={scaleY:u,scaleX:d,enable:m,zoomTo:p,rotateTo:f},C=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var n=e.useRef(null);return i.useEffect(function(){t.forEach(function(e){e&&("function"==typeof e?e(n.current):e.current=n.current)})},[t]),n}(a,e.useRef(null));e.useEffect(function(){var e;(null===(e=C.current)||void 0===e?void 0:e.cropper)&&"number"==typeof p&&C.current.cropper.zoomTo(p)},[n.zoomTo]),e.useEffect(function(){var e;(null===(e=C.current)||void 0===e?void 0:e.cropper)&&void 0!==o&&C.current.cropper.reset().clear().replace(o)},[o]),e.useEffect(function(){if(null!==C.current){var e=new Oa(C.current,Ra(Ra({dragMode:s},b),{ready:function(e){null!==e.currentTarget&&function(e,t){void 0===t&&(t={});var i=t.enable,a=void 0===i||i,n=t.scaleX,r=void 0===n?1:n,s=t.scaleY,o=void 0===s?1:s,h=t.zoomTo,l=void 0===h?0:h,c=t.rotateTo;a?e.enable():e.disable(),e.scaleX(r),e.scaleY(o),void 0!==c&&e.rotateTo(c),l>0&&e.zoomTo(l)}(e.currentTarget.cropper,y),v&&v(e)}}));x&&x(e)}return function(){var e,t;null===(t=null===(e=C.current)||void 0===e?void 0:e.cropper)||void 0===t||t.destroy()}},[C]);var k=function(e){return Ia.reduce(function(e,t){var i=e,a=t;return i[a],Aa(i,["symbol"==typeof a?a:a+""])},e)}(Ra(Ra({},b),{crossOrigin:c,src:o,alt:w}));return i.createElement("div",{style:h,className:l},i.createElement("img",Ra({},k,{style:Pa,ref:C})))});const Ua=({defaultSrc:i,onCropComplete:a,onClose:n})=>{const[r,s]=e.useState(i),[o,h]=e.useState("#"),l=e.createRef();return t.jsxs("div",{children:[t.jsxs("div",{style:{width:"100%"},children:[t.jsx("input",{type:"file",onChange:e=>{let t;e.preventDefault(),e.dataTransfer?t=e.dataTransfer.files:e.target&&(t=e.target.files);const i=new FileReader;i.onload=()=>{s(i.result)},i.readAsDataURL(t[0])}}),t.jsx("button",{onClick:()=>s(i),children:"Use current frame"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(Fa,{ref:l,style:{height:400,width:"100%"},zoomTo:.5,initialAspectRatio:1,preview:".img-preview",src:r,viewMode:1,minCropBoxHeight:10,minCropBoxWidth:10,background:!1,responsive:!0,autoCropArea:1,checkOrientation:!1,guides:!0})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"box",style:{width:"50%",float:"right"},children:[t.jsx("h1",{children:"Preview"}),t.jsx("div",{className:"img-preview",style:{width:"100%",float:"left",height:"300px"}})]}),t.jsxs("div",{className:"box",style:{width:"50%",float:"right",height:"300px"},children:[t.jsxs("h1",{children:[t.jsx("span",{children:"Crop"}),t.jsx("button",{style:{float:"right"},onClick:()=>{if(void 0!==l.current?.cropper){const e=l.current?.cropper.getCroppedCanvas().toDataURL();h(e),a&&a({croppedDataUrl:e,w:l.current?.cropper.getCroppedCanvas().width,h:l.current?.cropper.getCroppedCanvas().height})}},children:"Apply Crop"})]}),t.jsx("img",{style:{width:"100%"},src:o,alt:"cropped"})]})]}),t.jsx("br",{style:{clear:"both"}}),n&&t.jsx("div",{className:"mt-4 text-center",children:t.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:n,children:"Done"})})]})},Ha=()=>{const[i,a]=e.useState(!1),[r,s]=e.useState(!1),[o,h]=e.useState(!1),[l,c]=e.useState(!0),[d,u]=e.useState(!1),[m,p]=e.useState(!1),[f,g]=e.useState(!1),[w,v]=e.useState(64),[x,b]=e.useState(64),[y,C]=e.useState(!1),[k,j]=e.useState("#000000"),[M,T]=e.useState(8),[N,S]=e.useState([]),[D,z]=e.useState([]),[L,E]=e.useState(0),[B,W]=e.useState(!1),[O,R]=e.useState(!1),[A,I]=e.useState(!0),[P,F]=e.useState(!0),[U,H]=e.useState(!1),[V,Y]=e.useState(5),[X,$]=e.useState(!0),[q,G]=e.useState(!0),[Q,Z]=e.useState(!0),J=e.useRef(null),K=e.useRef(null);e.useEffect(()=>{const e=setTimeout(()=>{n(),setTimeout(()=>{if(window.drawingCanvas){const e=window.drawingCanvas.toDataURL(),t=ae();t&&t.length>0?S(t):S([e])}},50)},100);return()=>clearTimeout(e)},[]),e.useEffect(()=>{window.selectedColor=k,window.brushSize=M,window.isEraser=B,window.isMoveMode=O},[k,M,B,O]),e.useEffect(()=>{if(N.length>0&&L>=0&&L<N.length){const t=N[L];if(t&&""!==t)te(t);else if(window.drawingCanvas){const e=window.drawingCanvas,t=e.getContext("2d");t&&(0!==L&&Q?t.clearRect(0,0,e.width,e.height):(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)))}if(L>0&&Q){var e=new Image;const t=document.getElementById("canvas2");if(t){const i=t.getContext("2d"),a=window.drawingCanvas;i.clearRect(0,0,a.width,a.height),i.fillStyle="white",i.fillRect(0,0,a.width,a.height);let n=N[L-1];e.onload=()=>{i.drawImage(e,0,0)},e.src=n}}}},[L,N]),e.useEffect(()=>{A&&N.length>0&&ie(N)},[N,A]),e.useEffect(()=>()=>{K.current&&clearInterval(K.current)},[]);const _=e=>{if(window.drawingCanvas){const t=window.drawingCanvas,i=t.getContext("2d");if(!i)return;switch(0!==L&&Q?i.clearRect(0,0,t.width,t.height):(i.fillStyle="white",i.fillRect(0,0,t.width,t.height)),i.fillStyle=k,i.strokeStyle=k,i.lineWidth=M,e){case"circle":i.beginPath(),i.arc(t.width/2,t.height/2,50,0,2*Math.PI),i.fill();break;case"square":i.fillRect(t.width/2-50,t.height/2-50,100,100);break;case"smiley":i.beginPath(),i.arc(t.width/2,t.height/2,60,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(t.width/2-20,t.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(t.width/2+20,t.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(t.width/2,t.height/2,30,0,Math.PI,!1),i.stroke()}}},ee=()=>window.getDrawingCanvasData?window.getDrawingCanvasData():"",te=e=>{window.setDrawingCanvasData&&e&&window.setDrawingCanvasData(e)},ie=e=>{if(A)try{localStorage.setItem("animationFrames",JSON.stringify(e))}catch(t){}},ae=()=>{try{const e=localStorage.getItem("animationFrames");return e?JSON.parse(e):null}catch(e){return null}},ne=()=>{K.current&&(clearInterval(K.current),K.current=null),H(!1)},re=e=>{if(e<0||e>=N.length)return;const t=[...N];t[L]=ee(),S(t),E(e)},se=e=>{const t=e.target.files?.[0];if(!t)return;const i=new FileReader;i.onload=e=>{const t=new Image;t.onload=()=>{if(!window.confirm(`Are you sure you want to load frames from this image? This will replace all current frames (${N.length} frames will be deleted).`))return void g(!1);const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)return alert("Could not create canvas context"),void g(!1);let a,n,r=w,s=x;if(q?(a=Math.floor(t.width/w),n=Math.floor(t.height/x),a>0&&n>0?(r=Math.floor(t.width/a),s=Math.floor(t.height/n)):(a=Math.floor(t.width/r),n=Math.floor(t.height/s))):(a=Math.floor(t.width/r),n=Math.floor(t.height/s)),a<=0||n<=0)return alert("Cell size is too large for the image or invalid dimensions"),void g(!1);const o=[];for(let h=0;h<n;h++)for(let n=0;n<a;n++){e.width=r,e.height=s,i.drawImage(t,n*r,h*s,r,s,0,0,r,s);const a=e.toDataURL("image/png");o.push(a)}S(o),E(0),g(!1),A&&ie(o)},t.src=e.target?.result},i.readAsDataURL(t)};return t.jsxs("div",{className:"fixed inset-0 bg-gray-900 overflow-hidden",children:[t.jsx("canvas",{id:"canvas2",className:"absolute left-0 top-0 z-1 contrast-20"+(N.length>1||!U?"":" hidden")}),t.jsx("canvas",{id:"canvas",className:"absolute left-0 top-0 z-2"}),i&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsx("div",{className:"grid grid-cols-6 gap-2 mb-3",children:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A"].map(e=>t.jsx("button",{className:`w-8 h-8 rounded-full border-2 ${k===e?"border-white":"border-gray-600"} focus:outline-none`,style:{backgroundColor:e},onClick:()=>j(e),"aria-label":`Select ${e} color`},e))}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("label",{htmlFor:"brushSize",className:"text-white text-sm",children:"Size:"}),t.jsx("input",{id:"brushSize",type:"range",min:"1",max:"20",value:M,onChange:e=>T(parseInt(e.target.value)),className:"w-32 accent-white"}),t.jsxs("span",{className:"text-white text-sm w-8",children:[M,"px"]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white p-2 rounded",onClick:()=>(e=>{if(window.drawingCanvas){const t=window.drawingCanvas,i=t.getContext("2d");if(i){const a=[...N];a[L]=ee(),i.fillStyle=e,i.fillRect(0,0,t.width,t.height),a[L]=t.toDataURL(),S(a),A&&ie(a)}}})(k),"aria-label":"Fill canvas with selected color",children:"Fill Canvas"})})]}),r&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsx("h3",{className:"text-white mb-2",children:"Examples"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{_("circle"),s(!1)},children:"Circle"}),t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{_("square"),s(!1)},children:"Square"}),t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{_("smiley"),s(!1)},children:"Smiley"})]})]}),l&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-50 w-full max-w-4xl",children:[t.jsx("div",{className:"flex justify-between items-center mb-3",children:t.jsx("h3",{className:"text-white font-bold",children:"Frame Manager"})}),t.jsxs("div",{className:"flex flex-col space-y-3",children:[t.jsxs("div",{className:"flex space-x-2 justify-center",children:[t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded",onClick:()=>{const e=[...N];e[L]=ee(),S(e);const t=[...e];t.splice(L+1,0,""),S(t),E(L+1)},"aria-label":"Add frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),t.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white p-2 rounded",onClick:()=>{if(0===N.length)return;const e=[...N];e[L]=ee(),S(e);const t=e[L],i=[...e];i.splice(L+1,0,t),S(i),E(L+1),A&&ie(i)},"aria-label":"Duplicate frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded",onClick:()=>{if(window.confirm("Are you sure you want to clear the current canvas? This action cannot be undone.")&&window.drawingCanvas){const e=window.drawingCanvas,t=e.getContext("2d");if(t){0!==L&&Q?t.clearRect(0,0,e.width,e.height):(t.fillStyle="white",t.fillRect(0,0,e.width,e.height));const i=[...N];i[L]=e.toDataURL(),S(i),A&&ie(i)}}},"aria-label":"Clear canvas",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),t.jsx("button",{className:"bg-teal-500 hover:bg-teal-600 text-white p-2 rounded",onClick:()=>{const e=ee();if(!e)return void alert("No frame data to save");const t=document.createElement("a");t.href=e,t.download=`frame_${L+1}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},"aria-label":"Save current frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})}),t.jsx("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded",onClick:()=>{const e=document.getElementById("canvas2");U?(Q&&e?.classList.add("contrast-20"),ne()):(Q&&e?.classList.remove("contrast-20"),L===N.length-1&&re(0),(()=>{if(N.length<=1)return;H(!0),K.current&&clearInterval(K.current);const e=Math.max(10,1e3/V);K.current=setInterval(()=>{E(e=>(e+1)%N.length)},e)})())},"aria-label":U?"Pause animation":"Play animation",children:U?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 p-2 rounded",children:[t.jsx("label",{htmlFor:"fps-control",className:"text-white text-sm",children:"FPS:"}),t.jsxs("select",{id:"fps-control",value:V,onChange:e=>Y(parseInt(e.target.value)),className:"bg-gray-600 text-white text-sm rounded px-1",disabled:U,children:[t.jsx("option",{value:"1",children:"1"}),t.jsx("option",{value:"5",children:"5"}),V>1&&V<10&&5!==V&&t.jsx("option",{value:V,children:V}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"24",children:"24"}),t.jsx("option",{value:"30",children:"30"})]})]})]}),N.length>1&&t.jsx("div",{className:"flex flex-wrap gap-1 justify-center max-h-24 overflow-y-auto",children:N.map((e,i)=>t.jsx("button",{className:"w-10 h-10 rounded "+(i===L?"ring-2 ring-blue-400":""),onClick:()=>re(i),"aria-label":`Go to frame ${i+1}`,children:t.jsx("div",{className:"w-full h-full bg-gray-200 border border-gray-400 rounded flex items-center justify-center text-xs",children:i+1})},i))}),t.jsxs("div",{className:"flex items-center justify-between text-white text-sm text-center",children:[t.jsxs("div",{children:["Frame: ",L+1,"/",N.length]}),N.length>1&&t.jsx("button",{className:"bg-gray-600 hover:bg-gray-500 text-white p-2 rounded",onClick:()=>{if(N.length<=1)return;if(P&&!window.confirm("Are you sure you want to delete this frame? This action cannot be undone."))return;const e=[...N];e[L]=ee();const t=e.filter((e,t)=>t!==L);S(t);const i=Math.min(L,t.length-1);E(i),A&&ie(t)},"aria-label":"Delete frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),o&&t.jsxs("div",{className:"fixed bottom-20 left-1/3 transform -translate-x-1/3 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-white font-bold",children:"Settings"}),t.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>h(!1),"aria-label":"Close settings",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-5",children:[t.jsx("span",{className:"text-white",children:"New Project"}),t.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded",onClick:()=>{if(window.confirm("Are you sure you want to start a new project? This will delete all frames and cannot be undone.")&&window.drawingCanvas){const e=window.drawingCanvas,t=e.getContext("2d");if(t){t.fillStyle="white",t.fillRect(0,0,e.width,e.height);const i=e.toDataURL();S([i]),E(0);const a=document.getElementById("canvas2");if(a){const t=a.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height))}U&&(ne(),H(!1)),A&&ie([i]),window.resetZoom&&window.resetZoom()}}},"aria-label":"Start new project",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"Ask delete frame"}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"sr-only peer",checked:P,onChange:e=>F(e.target.checked)}),t.jsx("div",{className:`w-11 h-6 rounded-full peer ${P?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"Autosave to localStorage"}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"sr-only peer",checked:A,onChange:e=>I(e.target.checked)}),t.jsx("div",{className:`w-11 h-6 rounded-full peer ${A?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"LOAD FRAMES"}),t.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded",onClick:()=>{h(!1),u(!0)},"aria-label":"Load frames",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"Save as MP4"}),t.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded",onClick:async()=>{0!==N.length?window.confirm("Are you sure you want to export this animation as an MP4 with white background? This may take a moment.")&&z(N):alert("No frames to export")},"aria-label":"Export as MP4",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:""+(N.length>1?"text-gray-500":"text-white"),children:["Onion Skin ",N.length>1?"(disabled)":""]}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{disabled:N.length>1,type:"checkbox",className:"sr-only peer "+(N.length>1?" disabled":""),checked:Q,onChange:e=>{Z(e.target.checked)}}),t.jsx("div",{className:`w-11 h-6 rounded-full peer ${Q?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("span",{className:"text-white",children:"Custom FPS"}),t.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white p-2 rounded",onClick:()=>p(!0),"aria-label":"Set custom FPS",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("span",{className:"text-white",children:"Load Grid (in dev)"}),t.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded",onClick:()=>g(!0),"aria-label":"Load frames from grid",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}),t.jsxs("div",{className:"hidden flex items-center justify-between mt-2",children:[t.jsx("span",{className:"text-white",children:"Crop Image (in dev)"}),t.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded",onClick:()=>C(!0),"aria-label":"Crop image",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]})]}),m&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-white font-bold",children:"Set Custom FPS"}),t.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>p(!1),"aria-label":"Close custom FPS",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6,7,8,9].map(e=>t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-lg font-bold",onClick:()=>{Y(e),p(!1),h(!1)},"aria-label":`Set FPS to ${e}`,children:e},e))})]}),f&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70 w-96",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-white font-bold",children:"Load Frames from Grid"}),t.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>g(!1),"aria-label":"Close load grid",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-white mb-1",children:"Cell Width (px):"}),t.jsx("input",{type:"number",min:"1",value:w,onChange:e=>v(parseInt(e.target.value)||1),className:"w-full bg-gray-700 text-white p-2 rounded"})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-white mb-1",children:"Cell Height (px):"}),t.jsx("input",{type:"number",min:"1",value:x,onChange:e=>b(parseInt(e.target.value)||1),className:"w-full bg-gray-700 text-white p-2 rounded"})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-white mb-1",children:"Select Grid Image:"}),t.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:se,className:"w-full text-white"})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"block text-white mb-2",children:"Example Grids:"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.jsx("button",{type:"button",className:"bg-purple-600 hover:bg-purple-700 text-white p-2 rounded text-sm",onClick:()=>((e,t,i)=>{e=`/clipanima${e}`,v(t),b(i);const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{if(!window.confirm(`Are you sure you want to load frames from this example image? This will replace all current frames (${N.length} frames will be deleted).`))return void g(!1);const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)return alert("Could not create canvas context"),void g(!1);let r,s,o=t,h=i;if(q?(r=Math.floor(a.width/t),s=Math.floor(a.height/i),r>0&&s>0?(o=Math.floor(a.width/r),h=Math.floor(a.height/s)):(r=Math.floor(a.width/o),s=Math.floor(a.height/h))):(r=Math.floor(a.width/o),s=Math.floor(a.height/h)),r<=0||s<=0)return alert("Cell size is too large for the image or invalid dimensions"),void g(!1);const l=[];for(let t=0;t<s;t++)for(let i=0;i<r;i++){e.width=o,e.height=h,n.drawImage(a,i*o,t*h,o,h,0,0,o,h);const r=e.toDataURL("image/png");l.push(r)}S(l),E(0),g(!1),A&&ie(l)};const n=document.getElementById("canvas2");if(n){const e=window.drawingCanvas,t=n.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height))}a.src=e})("/assets/grid_man.jpg",130,160),"aria-label":"Load man grid example",children:"Man Grid"})})]}),t.jsxs("div",{className:"hidden mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"checkbox",id:"preserveAspectRatio",checked:X,onChange:e=>$(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"preserveAspectRatio",className:"text-gray-300",children:"Preserve aspect ratio"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"autoAdjustGrid",checked:q,onChange:e=>G(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"autoAdjustGrid",className:"text-gray-300",children:"Auto-adjust grid size"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded",onClick:()=>g(!1),children:"Cancel"}),t.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",onClick:()=>{if(J.current&&J.current.files&&J.current.files.length>0){const e={target:J.current};se(e)}else alert("Please select an image file first.")},children:"OK"})]})]}),y&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70 w-full max-w-4xl h-3/4 max-h-[80vh] overflow-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-white font-bold",children:"Crop Image"}),t.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>C(!1),"aria-label":"Close crop",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t.jsx("div",{className:"h-[70vh]",children:t.jsx(Ua,{defaultSrc:N[L]||"",onCropComplete:e=>{v(e.w),b(e.h)},onClose:()=>C(!1)})})]}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-gray-800/90 backdrop-blur-sm z-60 overflow-x-auto flex flex-col items-center",children:t.jsxs("div",{className:"flex items-center space-x-4 min-w-max pb-2",children:[t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg",onClick:()=>{h(!o)},"aria-label":o?"Hide settings":"Show settings",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg",onClick:()=>{a(!i),r&&s(!1)},"aria-label":i?"Hide color palette":"Show color palette",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg",onClick:()=>{c(!l),a(!1)},"aria-label":"Frame manager",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg",onClick:()=>{s(!r),i&&a(!1)},"aria-label":r?"Hide examples":"Show examples",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg "+(B?"ring-2 ring-yellow-400":""),onClick:()=>W(!B),"aria-label":B?"Switch to drawing mode":"Switch to eraser mode",children:t.jsx("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",children:t.jsx("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#ffffff",stroke:"none",children:t.jsx("path",{d:"M3140 4826 c-36 -8 -98 -27 -139 -42 -161 -60 -144 -44 -1369 -1267\n-629 -628 -1163 -1167 -1186 -1197 -232 -298 -227 -703 12 -1001 75 -93 830\n-843 897 -891 130 -92 258 -135 440 -148 72 -5 712 -9 1423 -10 1441 0 1334\n-5 1390 68 22 29 27 46 27 93 0 62 -17 94 -69 133 -27 21 -37 21 -1062 26\nl-1034 5 1091 1090 c600 600 1110 1118 1135 1152 98 135 146 287 146 463 0\n174 -44 316 -140 457 -22 32 -240 256 -484 499 -435 433 -445 441 -533 487\n-130 66 -216 88 -360 93 -78 2 -143 -1 -185 -10z m360 -346 c72 -32 91 -49\n498 -454 233 -232 436 -441 452 -466 90 -139 99 -311 24 -470 -34 -73 -55 -95\n-669 -710 l-635 -635 -710 710 c-390 390 -710 715 -710 720 0 17 1221 1230\n1274 1265 27 18 79 44 115 57 57 21 80 23 176 21 100 -3 117 -6 185 -38z\nm-1825 -1680 l150 -150 -560 -560 c-308 -308 -564 -559 -570 -557 -5 2 -27 37\n-47 78 -71 142 -71 284 -1 429 34 70 61 100 451 493 229 229 419 417 422 417\n3 0 73 -68 155 -150z m565 -565 l185 -185 -563 -562 -562 -563 -190 190 -190\n190 557 557 c307 307 562 558 568 558 6 0 93 -83 195 -185z m301 -1119 c-422\n-422 -464 -458 -581 -493 -121 -38 -292 -14 -394 53 l-39 26 559 559 559 559\n150 -150 150 -150 -404 -404z"})})})}),N.length>1&&0!==L&&t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg "+(O?"ring-2 ring-yellow-400":""),onClick:()=>R(!O),"aria-label":O?"Switch to drawing mode":"Switch to move mode",children:t.jsx("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",children:t.jsxs("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#ffffff",stroke:"none",children:[t.jsx("path",{d:"M2495 4786 c-16 -8 -168 -153 -337 -322 -259 -261 -308 -315 -317\n-349 -21 -81 31 -171 114 -194 23 -6 126 -11 242 -11 l202 0 3 -384 c3 -370 4\n-386 24 -412 39 -53 71 -69 134 -69 63 0 95 16 134 69 20 26 21 42 24 412 l3\n384 202 0 c116 0 219 5 242 11 83 23 136 113 114 194 -9 33 -62 91 -317 349\n-170 170 -321 314 -339 322 -40 17 -89 17 -128 0z"}),t.jsx("path",{d:"M995 3275 c-30 -11 -112 -87 -351 -327 -338 -338 -336 -336 -319\n-425 5 -33 48 -79 323 -355 269 -269 323 -318 357 -327 82 -21 171 32 194 114\n6 23 11 126 11 242 l0 202 384 3 c370 3 386 4 412 24 53 39 69 71 69 134 0 63\n-16 95 -69 134 -26 20 -42 21 -412 24 l-384 3 0 207 c-1 215 -8 261 -47 304\n-42 46 -110 64 -168 43z"}),t.jsx("path",{d:"M4025 3275 c-49 -17 -90 -62 -104 -112 -6 -21 -11 -129 -11 -240 l0\n-202 -384 -3 c-370 -3 -386 -4 -412 -24 -53 -39 -69 -71 -69 -134 0 -63 16\n-95 69 -134 26 -20 42 -21 412 -24 l384 -3 0 -202 c0 -116 5 -219 11 -242 23\n-83 113 -136 194 -114 34 9 91 62 357 327 275 276 318 322 323 355 17 89 18\n87 -313 420 -169 170 -318 314 -332 322 -42 22 -83 25 -125 10z"}),t.jsx("path",{d:"M2495 2066 c-37 -17 -70 -52 -84 -89 -7 -18 -11 -160 -11 -398 l0\n-369 -202 0 c-117 0 -220 -5 -243 -11 -83 -23 -136 -113 -114 -194 9 -34 62\n-91 327 -357 276 -275 322 -318 354 -323 90 -17 88 -18 421 313 170 169 315\n319 323 334 22 42 18 119 -9 158 -46 70 -66 75 -314 78 l-222 3 -3 384 c-3\n369 -4 385 -24 411 -11 15 -32 37 -46 47 -34 25 -113 32 -153 13z"})]})})})]})}),!!D.length&&t.jsx(Pt,{frames:D,fps:V,width:512,height:512,clearFrames:()=>z([]),onionSkinEnabled:Q}),t.jsx(Ut,{isOpen:d,onClose:()=>u(!1),onLoadFrames:e=>{if(N.length>0){const e=[...N];e[L]=ee(),S(e)}S(e),E(0),e.length>0&&te(e[0]),A&&ie(e)},currentFrameCount:N.length})]})};export{Ha as default};
