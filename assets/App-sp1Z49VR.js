import{r as e,j as t}from"./index-BBqjNdRx.js";function i(){var e=["maxTouchPoints","width","length","push","arc","touchmove","8pIpIHT","toWorld","globalCompositeOperation","touchstart","sin","drawingCanvas","2070230stRUGB","clearRect","fill","globalAlpha","addEventListener","apply","selectedColor","down","cos","count","height","472143ZiykIE","stroke","changedTouches","4363290bLesEw","identifier","strokeStyle","touchend","drawImage","type","invScale","134403szAhnS","getDrawingCanvasData","beginPath","points","source-over","7FdmjkT","getContext","lineWidth","fillStyle","shift","indexOf","font","iPad","isEraser","forEach","src","pCount","setTransform","8BzsSxh","setPinch","atan2","pageY","createElement","2164266ZIwCWa","white","rgba(255, 255, 255, 1)","update","pageX","setContext","black","setDrawingCanvasData","canvas","preventDefault","brushSize","7715240UjJYGR","fillRect","703732HlDdaT","appVersion"];return(i=function(){return e})()}function s(e,t){return e-=231,i()[e]}!function(){for(var e=s,t=i();;)try{if(680232===parseInt(e(273))/1+parseInt(e(248))/2+-parseInt(e(283))/3*(-parseInt(e(256))/4)+parseInt(e(262))/5+-parseInt(e(235))/6*(parseInt(e(288))/7)+-parseInt(e(301))/8*(-parseInt(e(276))/9)+-parseInt(e(246))/10)break;t.push(t.shift())}catch(a){t.push(t.shift())}}();const a=()=>{var e=s;let t=document.getElementById(e(243));if(!t)return;const i={x:0,y:0},a=t[e(289)]("2d");var r=!1,n=!1,o=!0;const l=document[e(234)](e(243)),h=l[e(251)]=512,d=l[e(272)]=512,c=l.getContext("2d");c[e(291)]=e(236),c.fillRect(0,0,h,d),window[e(261)]=l,window[e(284)]=()=>l.toDataURL(),window[e(242)]=t=>{var i=e;const a=new Image;a.onload=()=>{var e=s;c[e(263)](0,0,l.width,l.height),c[e(280)](a,0,0)},a[i(298)]=t};const u=function(t){var i=e;if(void 0===navigator[i(250)]&&(navigator[i(249)][i(293)]("Android")>-1||navigator[i(249)][i(293)]("iPhone")>-1||navigator[i(249)].indexOf(i(295))>-1)&&(navigator[i(250)]=5),navigator.maxTouchPoints>0)return function(t){var i=e;const s={points:[],x:0,y:0,count:0,w:0,rx:0,ry:0};var a=s,r=s[i(286)];function n(){for(var e=i,t=0;t<a[e(299)];t++)if(-1===r[t].id)return r[t]}function o(e){for(var t=i,s=0;s<a[t(299)];s++)if(r[s].id===e)return r[s]}function l(e,t,s,a){var r=i;void 0!==e&&(s?(e.oy=t[r(239)],e.ox=t[r(233)],e.id=t.identifier):(e.ox=e.x,e.oy=e.y),e.x=t[r(239)],e.y=t.pageY,e[r(269)]=a,!a&&(e.id=-1))}function h(){for(var e=i,t=0,s=0;s<a.pCount;s++)-1!==r[s].id&&(0===t&&(a.x=r[s].x,a.y=r[s].y),t+=1);a[e(271)]=t}function d(e){var t,s,a=i;if(s=e[a(275)],e.type===a(259))for(t=0;t<s[a(252)];t++)l(n(),s[t],!0,!0);else if("touchmove"===e[a(281)])for(t=0;t<s[a(252)];t++)l(o(s[t][a(277)]),s[t],!1,!0);else if(e.type===a(279))for(t=0;t<s[a(252)];t++)l(o(s[t].identifier),s[t],!1,!1);return h(),e[a(244)](),!1}return s[i(299)]=navigator[i(250)],t=void 0===t?document:t,((e,t)=>{for(var i=0;i<e&&!0!==t(i++););})(navigator.maxTouchPoints,()=>s[i(286)].push({x:0,y:0,dx:0,dy:0,down:!1,id:-1})),[i(259),i(255),i(279)][i(297)](e=>t[i(266)](e,d)),s}(t)}(t);if(a[e(294)]="16px arial.",void 0===u)return;const m=[];function f(){var t=e;const i=window[t(268)]||"black",s=window[t(245)]||8,a=window[t(296)]||!1;for(c[t(258)]=t(287),a?(c[t(291)]=t(237),c[t(278)]="rgba(255, 255, 255, 1)"):(c[t(291)]=i,c[t(278)]=i),c[t(290)]=s;m[t(252)]>0;){const e=m[t(292)]();c[t(285)](),c[t(254)](e.x,e.y,s/2,0,2*Math.PI),c[t(264)](),c[t(274)]()}}var p=t.width,w=t[e(272)];requestAnimationFrame(function s(c){var x=e;o&&(o=!1,g[e(240)](a)),a[x(300)](1,0,0,1,0,0),a[x(265)]=1,a[x(258)]="source-over",(p!==innerWidth||w!==innerHeight)&&(p=t[x(251)]=innerWidth,w=t[x(272)]=innerHeight),a[x(263)](0,0,p,w),g[x(267)](),a.fillStyle=x(241),a[x(265)]=.4,a[x(247)](5,d,h-5,5),a[x(247)](h,5,5,d),a.globalAlpha=1,a[x(280)](l,0,0),a[x(300)](1,0,0,1,0,0),1!==u.count&&!r||n?2===u.count||n?(m[x(252)]=0,0===u.count?n=!1:n||2!==u.count?g.movePinch(u[x(286)][0],u.points[1]):(n=!0,g[x(231)](u[x(286)][0],u[x(286)][1]))):(n=!1,r=!1):0===u.count?(r=!1,f()):(g[x(257)](u,i),m[x(253)]({x:i.x,y:i.y}),r?f():m[x(252)]>8&&(r=!0)),requestAnimationFrame(s)});const g=(()=>{const e=[1,0,0,1,0,0],t=[1,0,0,1,0,0];var i=e,a=t,r=1,n=0;const o={x:0,y:0},l={x:0,y:0};var h,d=0,c=1,u=0,m=0;const f={x:0,y:0};var p=!0;return{canvasDefault(){h[s(300)](1,0,0,1,0,0)},apply(){var e=s;p&&this[e(238)](),h[e(300)](i[0],i[1],i[2],i[3],i[4],i[5])},reset(){r=1,n=0,f.x=0,f.y=0,p=!0},matrix:e,invMatrix:t,update(){var e=s;p=!1,i[3]=i[0]=Math[e(270)](n)*r,i[2]=-(i[1]=Math[e(260)](n)*r),i[4]=f.x,i[5]=f.y,this[e(282)]=1/r;var t=i[0]*i[3]-i[1]*i[2];a[0]=i[3]/t,a[1]=-i[1]/t,a[2]=-i[2]/t,a[3]=i[0]/t},toWorld(e,t={}){var r,n;return p&&this[s(238)](),r=e.x-i[4],n=e.y-i[5],t.x=r*a[0]+n*a[2],t.y=r*a[1]+n*a[3],t},toScreen(e,t={}){return p&&this.update(),t.x=e.x*i[0]+e.y*i[2]+i[4],t.y=e.x*i[1]+e.y*i[3]+i[5],t},setPinch(e,t){var i=s;p&&this.update(),o.x=e.x,o.y=e.y;var a=t.x-o.x,h=t.y-o.y;d=Math.sqrt(a*a+h*h),m=Math[i(232)](h,a),c=r,u=n,this.toWorld(o,l)},movePinch(e,t,a){var o=s;p&&this[o(238)]();var h=t.x-e.x,w=t.y-e.y,g=Math.sqrt(h*h+w*w);if(r=c*(g/d),!a){var x=Math[o(232)](w,h);n=u+(x-m)}this[o(238)](),f.x=e.x-l.x*i[0]-l.y*i[2],f.y=e.y-l.x*i[1]-l.y*i[3],p=!0},setContext(e){h=e,p=!0}}})()};var r,n,o,l,h,d,c,u,m=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},f=(e,t,i)=>(m(e,t,"read from private field"),i?i.call(e):t.get(e)),p=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},w=(e,t,i,s)=>(m(e,t,"write to private field"),t.set(e,i),i),g=(e,t,i)=>(m(e,t,"access private method"),i),x=new Uint8Array(8),v=new DataView(x.buffer),b=e=>[(e%256+256)%256],y=e=>(v.setUint16(0,e,!1),[x[0],x[1]]),k=e=>(v.setUint32(0,e,!1),[x[1],x[2],x[3]]),C=e=>(v.setUint32(0,e,!1),[x[0],x[1],x[2],x[3]]),j=e=>(v.setUint32(0,Math.floor(e/2**32),!1),v.setUint32(4,e,!1),[x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7]]),T=e=>(v.setInt16(0,256*e,!1),[x[0],x[1]]),S=e=>(v.setInt32(0,65536*e,!1),[x[0],x[1],x[2],x[3]]),N=e=>(v.setInt32(0,2**30*e,!1),[x[0],x[1],x[2],x[3]]),M=(e,t=!1)=>{let i=Array(e.length).fill(null).map((t,i)=>e.charCodeAt(i));return t&&i.push(0),i},z=e=>e&&e[e.length-1],E=e=>{let t;for(let i of e)(!t||i.presentationTimestamp>t.presentationTimestamp)&&(t=i);return t},L=(e,t,i=!0)=>{let s=e*t;return i?Math.round(s):s},A=e=>{let t=e*(Math.PI/180),i=Math.cos(t),s=Math.sin(t);return[i,s,0,-s,i,0,0,0,1]},F=A(0),W=e=>[S(e[0]),S(e[1]),N(e[2]),S(e[3]),S(e[4]),N(e[5]),S(e[6]),S(e[7]),N(e[8])],B=e=>e?"object"!=typeof e?e:Array.isArray(e)?e.map(B):Object.fromEntries(Object.entries(e).map(([e,t])=>[e,B(t)])):e,D=e=>e>=0&&e<2**32,I=(e,t,i)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:i}),R=(e,t,i,s,a)=>I(e,[b(t),k(i),s??[]],a),U=e=>({type:"mdat",largeSize:e}),P=(e,t,i=!1)=>I("moov",null,[O(t,e),...e.map(e=>V(e,t)),i?me(e):null]),O=(e,t)=>{let i=L(Math.max(0,...t.filter(e=>e.samples.length>0).map(e=>{const t=E(e.samples);return t.presentationTimestamp+t.duration})),Lt),s=Math.max(...t.map(e=>e.id))+1,a=!D(e)||!D(i),r=a?j:C;return R("mvhd",+a,0,[r(e),r(e),C(Lt),r(i),S(1),T(1),Array(10).fill(0),W(F),Array(24).fill(0),C(s)])},V=(e,t)=>I("trak",null,[$(e,t),H(e,t)]),$=(e,t)=>{let i,s=E(e.samples),a=L(s?s.presentationTimestamp+s.duration:0,Lt),r=!D(t)||!D(a),n=r?j:C;return i="video"===e.info.type?"number"==typeof e.info.rotation?A(e.info.rotation):e.info.rotation:F,R("tkhd",+r,3,[n(t),n(t),C(e.id),C(0),n(a),Array(8).fill(0),y(0),y(0),T("audio"===e.info.type?1:0),y(0),W(i),S("video"===e.info.type?e.info.width:0),S("video"===e.info.type?e.info.height:0)])},H=(e,t)=>I("mdia",null,[q(e,t),G("video"===e.info.type?"vide":"soun"),J(e)]),q=(e,t)=>{let i=E(e.samples),s=L(i?i.presentationTimestamp+i.duration:0,e.timescale),a=!D(t)||!D(s),r=a?j:C;return R("mdhd",+a,0,[r(t),r(t),C(e.timescale),r(s),y(21956),y(0)])},G=e=>R("hdlr",0,0,[M("mhlr"),M(e),C(0),C(0),C(0),M("mp4-muxer-hdlr",!0)]),J=e=>I("minf",null,["video"===e.info.type?_():Y(),Z(),K(e)]),_=()=>R("vmhd",0,1,[y(0),y(0),y(0),y(0)]),Y=()=>R("smhd",0,0,[y(0),y(0)]),Z=()=>I("dinf",null,[Q()]),Q=()=>R("dref",0,0,[C(1)],[X()]),X=()=>R("url ",0,1),K=e=>{const t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(e=>0!==e.sampleCompositionTimeOffset);return I("stbl",null,[ee(e),oe(e),le(e),he(e),de(e),ce(e),t?ue(e):null])},ee=e=>R("stsd",0,0,[C(1)],["video"===e.info.type?te(je[e.info.codec],e):ne(Se[e.info.codec],e)]),te=(e,t)=>{return I(e,[Array(6).fill(0),y(1),y(0),y(0),Array(12).fill(0),y(t.info.width),y(t.info.height),C(4718592),C(4718592),C(0),y(1),Array(32).fill(0),y(24),(i=65535,v.setInt16(0,i,!1),[x[0],x[1]])],[Te[t.info.codec](t),t.info.decoderConfig.colorSpace?re(t):null]);var i},ie={bt709:1,bt470bg:5,smpte170m:6},se={bt709:1,smpte170m:6,"iec61966-2-1":13},ae={rgb:0,bt709:1,bt470bg:5,smpte170m:6},re=e=>I("colr",[M("nclx"),y(ie[e.info.decoderConfig.colorSpace.primaries]),y(se[e.info.decoderConfig.colorSpace.transfer]),y(ae[e.info.decoderConfig.colorSpace.matrix]),b((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),ne=(e,t)=>I(e,[Array(6).fill(0),y(1),y(0),y(0),C(0),y(t.info.numberOfChannels),y(16),y(0),y(0),S(t.info.sampleRate)],[Ne[t.info.codec](t)]),oe=e=>R("stts",0,0,[C(e.timeToSampleTable.length),e.timeToSampleTable.map(e=>[C(e.sampleCount),C(e.sampleDelta)])]),le=e=>{if(e.samples.every(e=>"key"===e.type))return null;let t=[...e.samples.entries()].filter(([,e])=>"key"===e.type);return R("stss",0,0,[C(t.length),t.map(([e])=>C(e+1))])},he=e=>R("stsc",0,0,[C(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(e=>[C(e.firstChunk),C(e.samplesPerChunk),C(1)])]),de=e=>R("stsz",0,0,[C(0),C(e.samples.length),e.samples.map(e=>C(e.size))]),ce=e=>e.finalizedChunks.length>0&&z(e.finalizedChunks).offset>=2**32?R("co64",0,0,[C(e.finalizedChunks.length),e.finalizedChunks.map(e=>j(e.offset))]):R("stco",0,0,[C(e.finalizedChunks.length),e.finalizedChunks.map(e=>C(e.offset))]),ue=e=>R("ctts",0,0,[C(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(e=>[C(e.sampleCount),C(e.sampleCompositionTimeOffset)])]),me=e=>I("mvex",null,e.map(fe)),fe=e=>R("trex",0,0,[C(e.id),C(1),C(0),C(0),C(0)]),pe=(e,t)=>I("moof",null,[we(e),...t.map(xe)]),we=e=>R("mfhd",0,0,[C(e)]),ge=e=>{let t=0,i=0,s="delta"===e.type;return i|=+s,t|=s?1:2,t<<24|i<<16},xe=e=>I("traf",null,[ve(e),be(e),ye(e)]),ve=e=>{let t=0;t|=8,t|=16,t|=32,t|=131072;let i=e.currentChunk.samples[1]??e.currentChunk.samples[0],s={duration:i.timescaleUnitsToNextSample,size:i.size,flags:ge(i)};return R("tfhd",0,131128,[C(e.id),C(s.duration),C(s.size),C(s.flags)])},be=e=>R("tfdt",1,0,[j(L(e.currentChunk.startTimestamp,e.timescale))]),ye=e=>{let t=e.currentChunk.samples.map(e=>e.timescaleUnitsToNextSample),i=e.currentChunk.samples.map(e=>e.size),s=e.currentChunk.samples.map(ge),a=e.currentChunk.samples.map(t=>L(t.presentationTimestamp-t.decodeTimestamp,e.timescale)),r=new Set(t),n=new Set(i),o=new Set(s),l=new Set(a),h=2===o.size&&s[0]!==s[1],d=r.size>1,c=n.size>1,u=!h&&o.size>1,m=l.size>1||[...l].some(e=>0!==e),f=0;return f|=1,f|=4*+h,f|=256*+d,f|=512*+c,f|=1024*+u,f|=2048*+m,R("trun",1,f,[C(e.currentChunk.samples.length),C(e.currentChunk.offset-e.currentChunk.moofOffset||0),h?C(s[0]):[],e.currentChunk.samples.map((e,r)=>{return[d?C(t[r]):[],c?C(i[r]):[],u?C(s[r]):[],m?(n=a[r],v.setInt32(0,n,!1),[x[0],x[1],x[2],x[3]]):[]];var n})])},ke=(e,t)=>R("tfra",1,0,[C(e.id),C(63),C(e.finalizedChunks.length),e.finalizedChunks.map(i=>[j(L(i.startTimestamp,e.timescale)),j(i.moofOffset),C(t+1),C(1),C(1)])]),Ce=()=>R("mfro",0,0,[C(0)]),je={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Te={avc:e=>e.info.decoderConfig&&I("avcC",[...new Uint8Array(e.info.decoderConfig.description)]),hevc:e=>e.info.decoderConfig&&I("hvcC",[...new Uint8Array(e.info.decoderConfig.description)]),vp9:e=>{if(!e.info.decoderConfig)return null;let t=e.info.decoderConfig;if(!t.colorSpace)throw new Error("'colorSpace' is required in the decoder config for VP9.");let i=t.codec.split("."),s=Number(i[1]),a=Number(i[2]),r=0+(Number(i[3])<<4)+Number(t.colorSpace.fullRange);return R("vpcC",1,0,[b(s),b(a),b(r),b(2),b(2),b(2),y(0)])},av1:()=>I("av1C",[129,0,0,0])},Se={aac:"mp4a",opus:"Opus"},Ne={aac:e=>{let t=new Uint8Array(e.info.decoderConfig.description);return R("esds",0,0,[C(58753152),b(32+t.byteLength),y(1),b(0),C(75530368),b(18+t.byteLength),b(64),b(21),k(0),C(130071),C(130071),C(92307584),b(t.byteLength),...t,C(109084800),b(1),b(2)])},opus:e=>{let t=3840,i=0;const s=e.info.decoderConfig?.description;if(s){if(s.byteLength<18)throw new TypeError("Invalid decoder description provided for Opus; must be at least 18 bytes long.");const e=ArrayBuffer.isView(s)?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(s);t=e.getUint16(10,!0),i=e.getInt16(14,!0)}return I("dOps",[b(0),b(e.info.numberOfChannels),y(t),C(e.info.sampleRate),T(i),b(0)])}},Me=class{},ze=class extends Me{constructor(){super(...arguments),this.buffer=null}},Ee=class extends Me{constructor(e){if(super(),this.options=e,"object"!=typeof e)throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(e.onData){if("function"!=typeof e.onData)throw new TypeError("options.onData, when provided, must be a function.");if(e.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(void 0!==e.chunked&&"boolean"!=typeof e.chunked)throw new TypeError("options.chunked, when provided, must be a boolean.");if(void 0!==e.chunkSize&&(!Number.isInteger(e.chunkSize)||e.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},Le=class extends Me{constructor(e,t){if(super(),this.stream=e,this.options=t,!(e instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(void 0!==t&&"object"!=typeof t)throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(t&&void 0!==t.chunkSize&&(!Number.isInteger(t.chunkSize)||t.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Ae=class{constructor(){this.pos=0,p(this,r,new Uint8Array(8)),p(this,n,new DataView(f(this,r).buffer)),this.offsets=new WeakMap}seek(e){this.pos=e}writeU32(e){f(this,n).setUint32(0,e,!1),this.write(f(this,r).subarray(0,4))}writeU64(e){f(this,n).setUint32(0,Math.floor(e/2**32),!1),f(this,n).setUint32(4,e,!1),this.write(f(this,r).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)f(this,n).setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.write(f(this,r));e.length%8!=0&&this.write(f(this,r).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let t=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let a of e.children)a&&this.writeBox(a);let i=this.pos,s=e.size??i-t;this.seek(t),this.writeBoxHeader(e,s),this.seek(i)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let t=this.pos;this.seek(this.offsets.get(e)),this.writeBox(e),this.seek(t)}measureBox(e){if(e.contents&&!e.children){return this.measureBoxHeader(e)+e.contents.byteLength}{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(let i of e.children)i&&(t+=this.measureBox(i));return t}}};r=new WeakMap,n=new WeakMap;var Fe=class extends Ae{constructor(e){super(),p(this,c),p(this,o,void 0),p(this,l,new ArrayBuffer(65536)),p(this,h,new Uint8Array(f(this,l))),p(this,d,0),w(this,o,e)}write(e){g(this,c,u).call(this,this.pos+e.byteLength),f(this,h).set(e,this.pos),this.pos+=e.byteLength,w(this,d,Math.max(f(this,d),this.pos))}finalize(){g(this,c,u).call(this,this.pos),f(this,o).buffer=f(this,l).slice(0,Math.max(f(this,d),this.pos))}};o=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,c=new WeakSet,u=function(e){let t=f(this,l).byteLength;for(;t<e;)t*=2;if(t===f(this,l).byteLength)return;let i=new ArrayBuffer(t),s=new Uint8Array(i);s.set(f(this,h),0),w(this,l,i),w(this,h,s)};var We,Be,De,Ie,Re,Ue,Pe,Oe,Ve,$e,He,qe,Ge,Je=class extends Ae{constructor(e){super(),p(this,Ue),p(this,Oe),p(this,$e),p(this,qe),p(this,We,void 0),p(this,Be,[]),p(this,De,void 0),p(this,Ie,void 0),p(this,Re,[]),w(this,We,e),w(this,De,e.options?.chunked??!1),w(this,Ie,e.options?.chunkSize??16777216)}write(e){f(this,Be).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){if(0===f(this,Be).length)return;let e=[],t=[...f(this,Be)].sort((e,t)=>e.start-t.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let s=e[e.length-1],a=t[i];a.start<=s.start+s.size?s.size=Math.max(s.size,a.start+a.data.byteLength-s.start):e.push({start:a.start,size:a.data.byteLength})}for(let i of e){i.data=new Uint8Array(i.size);for(let e of f(this,Be))i.start<=e.start&&e.start<i.start+i.size&&i.data.set(e.data,e.start-i.start);f(this,De)?(g(this,Ue,Pe).call(this,i.data,i.start),g(this,qe,Ge).call(this)):f(this,We).options.onData?.(i.data,i.start)}f(this,Be).length=0}finalize(){f(this,De)&&g(this,qe,Ge).call(this,!0)}};We=new WeakMap,Be=new WeakMap,De=new WeakMap,Ie=new WeakMap,Re=new WeakMap,Ue=new WeakSet,Pe=function(e,t){let i=f(this,Re).findIndex(e=>e.start<=t&&t<e.start+f(this,Ie));-1===i&&(i=g(this,$e,He).call(this,t));let s=f(this,Re)[i],a=t-s.start,r=e.subarray(0,Math.min(f(this,Ie)-a,e.byteLength));s.data.set(r,a);let n={start:a,end:a+r.byteLength};if(g(this,Oe,Ve).call(this,s,n),0===s.written[0].start&&s.written[0].end===f(this,Ie)&&(s.shouldFlush=!0),f(this,Re).length>2){for(let e=0;e<f(this,Re).length-1;e++)f(this,Re)[e].shouldFlush=!0;g(this,qe,Ge).call(this)}r.byteLength<e.byteLength&&g(this,Ue,Pe).call(this,e.subarray(r.byteLength),t+r.byteLength)},Oe=new WeakSet,Ve=function(e,t){let i=0,s=e.written.length-1,a=-1;for(;i<=s;){let r=Math.floor(i+(s-i+1)/2);e.written[r].start<=t.start?(i=r+1,a=r):s=r-1}for(e.written.splice(a+1,0,t),(-1===a||e.written[a].end<t.start)&&a++;a<e.written.length-1&&e.written[a].end>=e.written[a+1].start;)e.written[a].end=Math.max(e.written[a].end,e.written[a+1].end),e.written.splice(a+1,1)},$e=new WeakSet,He=function(e){let t={start:Math.floor(e/f(this,Ie))*f(this,Ie),data:new Uint8Array(f(this,Ie)),written:[],shouldFlush:!1};return f(this,Re).push(t),f(this,Re).sort((e,t)=>e.start-t.start),f(this,Re).indexOf(t)},qe=new WeakSet,Ge=function(e=!1){for(let t=0;t<f(this,Re).length;t++){let i=f(this,Re)[t];if(i.shouldFlush||e){for(let e of i.written)f(this,We).options.onData?.(i.data.subarray(e.start,e.end),i.start+e.start);f(this,Re).splice(t--,1)}}};var _e,Ye,Ze,Qe,Xe,Ke,et,tt,it,st,at,rt,nt,ot,lt,ht,dt,ct,ut,mt,ft,pt,wt,gt,xt,vt,bt,yt,kt,Ct,jt,Tt,St,Nt,Mt,zt,Et=class extends Je{constructor(e){super(new Ee({onData:(t,i)=>e.stream.write({type:"write",data:t,position:i}),chunked:!0,chunkSize:e.options?.chunkSize}))}},Lt=1e3,At=["avc","hevc","vp9","av1"],Ft=["aac","opus"],Wt=["strict","offset","cross-track-offset"],Bt=class{constructor(e){if(p(this,nt),p(this,lt),p(this,dt),p(this,ut),p(this,ft),p(this,wt),p(this,xt),p(this,bt),p(this,kt),p(this,jt),p(this,St),p(this,Mt),p(this,_e,void 0),p(this,Ye,void 0),p(this,Ze,void 0),p(this,Qe,void 0),p(this,Xe,null),p(this,Ke,null),p(this,et,Math.floor(Date.now()/1e3)+2082844800),p(this,tt,[]),p(this,it,1),p(this,st,[]),p(this,at,[]),p(this,rt,!1),g(this,nt,ot).call(this,e),e.video=B(e.video),e.audio=B(e.audio),e.fastStart=B(e.fastStart),this.target=e.target,w(this,_e,{firstTimestampBehavior:"strict",...e}),e.target instanceof ze)w(this,Ye,new Fe(e.target));else if(e.target instanceof Ee)w(this,Ye,new Je(e.target));else{if(!(e.target instanceof Le))throw new Error(`Invalid target: ${e.target}`);w(this,Ye,new Et(e.target))}g(this,ut,mt).call(this),g(this,lt,ht).call(this)}addVideoChunk(e,t,i,s){if(!(e instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.");if(t&&"object"!=typeof t)throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");if(void 0!==s&&!Number.isFinite(s))throw new TypeError("addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.");let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addVideoChunkRaw(a,e.type,i??e.timestamp,e.duration,t,s)}addVideoChunkRaw(e,t,i,s,a,r){if(!(e instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(s)||s<0)throw new TypeError("addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.");if(a&&"object"!=typeof a)throw new TypeError("addVideoChunkRaw's fifth argument (meta), when provided, must be an object.");if(void 0!==r&&!Number.isFinite(r))throw new TypeError("addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.");if(g(this,Mt,zt).call(this),!f(this,_e).video)throw new Error("No video track declared.");if("object"==typeof f(this,_e).fastStart&&f(this,Xe).samples.length===f(this,_e).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${f(this,_e).fastStart.expectedVideoChunks}).`);let n=g(this,wt,gt).call(this,f(this,Xe),e,t,i,s,a,r);if("fragmented"===f(this,_e).fastStart&&f(this,Ke)){for(;f(this,at).length>0&&f(this,at)[0].decodeTimestamp<=n.decodeTimestamp;){let e=f(this,at).shift();g(this,xt,vt).call(this,f(this,Ke),e)}n.decodeTimestamp<=f(this,Ke).lastDecodeTimestamp?g(this,xt,vt).call(this,f(this,Xe),n):f(this,st).push(n)}else g(this,xt,vt).call(this,f(this,Xe),n)}addAudioChunk(e,t,i){if(!(e instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.");if(t&&"object"!=typeof t)throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let s=new Uint8Array(e.byteLength);e.copyTo(s),this.addAudioChunkRaw(s,e.type,i??e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,i,s,a){if(!(e instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==t&&"delta"!==t)throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(s)||s<0)throw new TypeError("addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.");if(a&&"object"!=typeof a)throw new TypeError("addAudioChunkRaw's fifth argument (meta), when provided, must be an object.");if(g(this,Mt,zt).call(this),!f(this,_e).audio)throw new Error("No audio track declared.");if("object"==typeof f(this,_e).fastStart&&f(this,Ke).samples.length===f(this,_e).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${f(this,_e).fastStart.expectedAudioChunks}).`);let r=g(this,wt,gt).call(this,f(this,Ke),e,t,i,s,a);if("fragmented"===f(this,_e).fastStart&&f(this,Xe)){for(;f(this,st).length>0&&f(this,st)[0].decodeTimestamp<=r.decodeTimestamp;){let e=f(this,st).shift();g(this,xt,vt).call(this,f(this,Xe),e)}r.decodeTimestamp<=f(this,Xe).lastDecodeTimestamp?g(this,xt,vt).call(this,f(this,Ke),r):f(this,at).push(r)}else g(this,xt,vt).call(this,f(this,Ke),r)}finalize(){if(f(this,rt))throw new Error("Cannot finalize a muxer more than once.");if("fragmented"===f(this,_e).fastStart){for(let e of f(this,st))g(this,xt,vt).call(this,f(this,Xe),e);for(let e of f(this,at))g(this,xt,vt).call(this,f(this,Ke),e);g(this,jt,Tt).call(this,!1)}else f(this,Xe)&&g(this,kt,Ct).call(this,f(this,Xe)),f(this,Ke)&&g(this,kt,Ct).call(this,f(this,Ke));let e=[f(this,Xe),f(this,Ke)].filter(Boolean);if("in-memory"===f(this,_e).fastStart){let t;for(let s=0;s<2;s++){let i=P(e,f(this,et)),s=f(this,Ye).measureBox(i);t=f(this,Ye).measureBox(f(this,Qe));let a=f(this,Ye).pos+s+t;for(let e of f(this,tt)){e.offset=a;for(let{data:i}of e.samples)a+=i.byteLength,t+=i.byteLength}if(a<2**32)break;t>=2**32&&(f(this,Qe).largeSize=!0)}let i=P(e,f(this,et));f(this,Ye).writeBox(i),f(this,Qe).size=t,f(this,Ye).writeBox(f(this,Qe));for(let e of f(this,tt))for(let t of e.samples)f(this,Ye).write(t.data),t.data=null}else if("fragmented"===f(this,_e).fastStart){let t=f(this,Ye).pos,i=(e=>I("mfra",null,[...e.map(ke),Ce()]))(e);f(this,Ye).writeBox(i);let s=f(this,Ye).pos-t;f(this,Ye).seek(f(this,Ye).pos-4),f(this,Ye).writeU32(s)}else{let t=f(this,Ye).offsets.get(f(this,Qe)),i=f(this,Ye).pos-t;f(this,Qe).size=i,f(this,Qe).largeSize=i>=2**32,f(this,Ye).patchBox(f(this,Qe));let s=P(e,f(this,et));if("object"==typeof f(this,_e).fastStart){f(this,Ye).seek(f(this,Ze)),f(this,Ye).writeBox(s);let e=t-f(this,Ye).pos;f(this,Ye).writeBox({type:"free",size:e})}else f(this,Ye).writeBox(s)}g(this,St,Nt).call(this),f(this,Ye).finalize(),w(this,rt,!0)}};_e=new WeakMap,Ye=new WeakMap,Ze=new WeakMap,Qe=new WeakMap,Xe=new WeakMap,Ke=new WeakMap,et=new WeakMap,tt=new WeakMap,it=new WeakMap,st=new WeakMap,at=new WeakMap,rt=new WeakMap,nt=new WeakSet,ot=function(e){if("object"!=typeof e)throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(e.target instanceof Me))throw new TypeError("The target must be provided and an instance of Target.");if(e.video){if(!At.includes(e.video.codec))throw new TypeError(`Unsupported video codec: ${e.video.codec}`);if(!Number.isInteger(e.video.width)||e.video.width<=0)throw new TypeError(`Invalid video width: ${e.video.width}. Must be a positive integer.`);if(!Number.isInteger(e.video.height)||e.video.height<=0)throw new TypeError(`Invalid video height: ${e.video.height}. Must be a positive integer.`);const t=e.video.rotation;if("number"==typeof t&&![0,90,180,270].includes(t))throw new TypeError(`Invalid video rotation: ${t}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(t)&&(9!==t.length||t.some(e=>"number"!=typeof e)))throw new TypeError(`Invalid video transformation matrix: ${t.join()}`);if(void 0!==e.video.frameRate&&(!Number.isInteger(e.video.frameRate)||e.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${e.video.frameRate}. Must be a positive integer.`)}if(e.audio){if(!Ft.includes(e.audio.codec))throw new TypeError(`Unsupported audio codec: ${e.audio.codec}`);if(!Number.isInteger(e.audio.numberOfChannels)||e.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${e.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(e.audio.sampleRate)||e.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${e.audio.sampleRate}. Must be a positive integer.`)}if(e.firstTimestampBehavior&&!Wt.includes(e.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`);if("object"==typeof e.fastStart){if(e.video){if(void 0===e.fastStart.expectedVideoChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(!Number.isInteger(e.fastStart.expectedVideoChunks)||e.fastStart.expectedVideoChunks<0)throw new TypeError("'expectedVideoChunks' must be a non-negative integer.")}if(e.audio){if(void 0===e.fastStart.expectedAudioChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedAudioChunks'.");if(!Number.isInteger(e.fastStart.expectedAudioChunks)||e.fastStart.expectedAudioChunks<0)throw new TypeError("'expectedAudioChunks' must be a non-negative integer.")}}else if(![!1,"in-memory","fragmented"].includes(e.fastStart))throw new TypeError("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.");if(void 0!==e.minFragmentDuration&&(!Number.isFinite(e.minFragmentDuration)||e.minFragmentDuration<0))throw new TypeError("'minFragmentDuration' must be a non-negative number.")},lt=new WeakSet,ht=function(){var e;if(f(this,Ye).writeBox((e={holdsAvc:"avc"===f(this,_e).video?.codec,fragmented:"fragmented"===f(this,_e).fastStart}).fragmented?I("ftyp",[M("iso5"),C(512),M("iso5"),M("iso6"),M("mp41")]):I("ftyp",[M("isom"),C(512),M("isom"),e.holdsAvc?M("avc1"):[],M("mp41")])),w(this,Ze,f(this,Ye).pos),"in-memory"===f(this,_e).fastStart)w(this,Qe,U(!1));else if("fragmented"===f(this,_e).fastStart);else{if("object"==typeof f(this,_e).fastStart){let e=g(this,dt,ct).call(this);f(this,Ye).seek(f(this,Ye).pos+e)}w(this,Qe,U(!0)),f(this,Ye).writeBox(f(this,Qe))}g(this,St,Nt).call(this)},dt=new WeakSet,ct=function(){if("object"!=typeof f(this,_e).fastStart)return;let e=0,t=[f(this,_e).fastStart.expectedVideoChunks,f(this,_e).fastStart.expectedAudioChunks];for(let i of t)i&&(e+=8*Math.ceil(2/3*i),e+=4*i,e+=12*Math.ceil(2/3*i),e+=4*i,e+=8*i);return e+=4096,e},ut=new WeakSet,mt=function(){if(f(this,_e).video&&w(this,Xe,{id:1,info:{type:"video",codec:f(this,_e).video.codec,width:f(this,_e).video.width,height:f(this,_e).video.height,rotation:f(this,_e).video.rotation??0,decoderConfig:null},timescale:f(this,_e).video.frameRate??57600,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),f(this,_e).audio&&(w(this,Ke,{id:f(this,_e).video?2:1,info:{type:"audio",codec:f(this,_e).audio.codec,numberOfChannels:f(this,_e).audio.numberOfChannels,sampleRate:f(this,_e).audio.sampleRate,decoderConfig:null},timescale:f(this,_e).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),"aac"===f(this,_e).audio.codec)){let e=g(this,ft,pt).call(this,2,f(this,_e).audio.sampleRate,f(this,_e).audio.numberOfChannels);f(this,Ke).info.decoderConfig={codec:f(this,_e).audio.codec,description:e,numberOfChannels:f(this,_e).audio.numberOfChannels,sampleRate:f(this,_e).audio.sampleRate}}},ft=new WeakSet,pt=function(e,t,i){let s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),a=i,r="";r+=e.toString(2).padStart(5,"0"),r+=s.toString(2).padStart(4,"0"),15===s&&(r+=t.toString(2).padStart(24,"0")),r+=a.toString(2).padStart(4,"0");let n=8*Math.ceil(r.length/8);r=r.padEnd(n,"0");let o=new Uint8Array(r.length/8);for(let l=0;l<r.length;l+=8)o[l/8]=parseInt(r.slice(l,l+8),2);return o},wt=new WeakSet,gt=function(e,t,i,s,a,r,n){let o=s/1e6,l=(s-(n??0))/1e6,h=a/1e6,d=g(this,bt,yt).call(this,o,l,e);return o=d.presentationTimestamp,l=d.decodeTimestamp,r?.decoderConfig&&(null===e.info.decoderConfig?e.info.decoderConfig=r.decoderConfig:Object.assign(e.info.decoderConfig,r.decoderConfig)),{presentationTimestamp:o,decodeTimestamp:l,duration:h,data:t,size:t.byteLength,type:i,timescaleUnitsToNextSample:L(h,e.timescale)}},xt=new WeakSet,vt=function(e,t){"fragmented"!==f(this,_e).fastStart&&e.samples.push(t);const i=L(t.presentationTimestamp-t.decodeTimestamp,e.timescale);if(null!==e.lastTimescaleUnits){let s=L(t.decodeTimestamp,e.timescale,!1),a=Math.round(s-e.lastTimescaleUnits);if(e.lastTimescaleUnits+=a,e.lastSample.timescaleUnitsToNextSample=a,"fragmented"!==f(this,_e).fastStart){let t=z(e.timeToSampleTable);1===t.sampleCount?(t.sampleDelta=a,t.sampleCount++):t.sampleDelta===a?t.sampleCount++:(t.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:a}));const s=z(e.compositionTimeOffsetTable);s.sampleCompositionTimeOffset===i?s.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i})}}else e.lastTimescaleUnits=0,"fragmented"!==f(this,_e).fastStart&&(e.timeToSampleTable.push({sampleCount:1,sampleDelta:L(t.duration,e.timescale)}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i}));e.lastSample=t;let s=!1;if(e.currentChunk){let i=t.presentationTimestamp-e.currentChunk.startTimestamp;if("fragmented"===f(this,_e).fastStart){let a=f(this,Xe)??f(this,Ke);const r=f(this,_e).minFragmentDuration??1;e===a&&"key"===t.type&&i>=r&&(s=!0,g(this,jt,Tt).call(this))}else s=i>=.5}else s=!0;s&&(e.currentChunk&&g(this,kt,Ct).call(this,e),e.currentChunk={startTimestamp:t.presentationTimestamp,samples:[]}),e.currentChunk.samples.push(t)},bt=new WeakSet,yt=function(e,t,i){const s="strict"===f(this,_e).firstTimestampBehavior,a=-1===i.lastDecodeTimestamp;if(s&&a&&0!==t)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${t}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`);if("offset"===f(this,_e).firstTimestampBehavior||"cross-track-offset"===f(this,_e).firstTimestampBehavior){let s;void 0===i.firstDecodeTimestamp&&(i.firstDecodeTimestamp=t),s="offset"===f(this,_e).firstTimestampBehavior?i.firstDecodeTimestamp:Math.min(f(this,Xe)?.firstDecodeTimestamp??1/0,f(this,Ke)?.firstDecodeTimestamp??1/0),t-=s,e-=s}if(t<i.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${1e6*i.lastDecodeTimestamp} to ${1e6*t}).`);return i.lastDecodeTimestamp=t,{presentationTimestamp:e,decodeTimestamp:t}},kt=new WeakSet,Ct=function(e){if("fragmented"===f(this,_e).fastStart)throw new Error("Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.");if(e.currentChunk)if(e.finalizedChunks.push(e.currentChunk),f(this,tt).push(e.currentChunk),0!==e.compactlyCodedChunkTable.length&&z(e.compactlyCodedChunkTable).samplesPerChunk===e.currentChunk.samples.length||e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:e.currentChunk.samples.length}),"in-memory"!==f(this,_e).fastStart){e.currentChunk.offset=f(this,Ye).pos;for(let t of e.currentChunk.samples)f(this,Ye).write(t.data),t.data=null;g(this,St,Nt).call(this)}else e.currentChunk.offset=0},jt=new WeakSet,Tt=function(e=!0){if("fragmented"!==f(this,_e).fastStart)throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let t=[f(this,Xe),f(this,Ke)].filter(e=>e&&e.currentChunk);if(0===t.length)return;let i=(s=this,a=it,{set _(e){w(s,a,e)},get _(){return f(s,a,r)}})._++;var s,a,r;if(1===i){let e=P(t,f(this,et),!0);f(this,Ye).writeBox(e)}let n=f(this,Ye).pos,o=pe(i,t);f(this,Ye).writeBox(o);{let e=U(!1),i=0;for(let a of t)for(let e of a.currentChunk.samples)i+=e.size;let s=f(this,Ye).measureBox(e)+i;s>=2**32&&(e.largeSize=!0,s=f(this,Ye).measureBox(e)+i),e.size=s,f(this,Ye).writeBox(e)}for(let d of t){d.currentChunk.offset=f(this,Ye).pos,d.currentChunk.moofOffset=n;for(let e of d.currentChunk.samples)f(this,Ye).write(e.data),e.data=null}let l=f(this,Ye).pos;f(this,Ye).seek(f(this,Ye).offsets.get(o));let h=pe(i,t);f(this,Ye).writeBox(h),f(this,Ye).seek(l);for(let d of t)d.finalizedChunks.push(d.currentChunk),f(this,tt).push(d.currentChunk),d.currentChunk=null;e&&g(this,St,Nt).call(this)},St=new WeakSet,Nt=function(){f(this,Ye)instanceof Je&&f(this,Ye).flush()},Mt=new WeakSet,zt=function(){if(f(this,rt))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};const Dt=({frames:i,clearFrames:s,fps:a=10,width:r=512,height:n=512})=>{const[o,l]=e.useState(!1),h=async()=>{if(!i.length)return;if(!("VideoEncoder"in window))return void alert("WebCodecs not supported in this browser (Chrome 94+ required)");l(!0);let e=null;try{if(e=await async function(e,t,i,s){return new Promise(async(a,r)=>{const n=new Bt({fastStart:"in-memory",target:new ze,video:{codec:"avc",width:i,height:s}}),o=new OffscreenCanvas(i,s),l=o.getContext("2d",{willReadFrequently:!0});if(!l)return void r(new Error("Could not get 2D context"));const h=new VideoEncoder({output:(e,t)=>{n.addVideoChunk(e,t)},error:e=>{r(new Error(`Encoder error: ${e.message}`))}});await h.configure({codec:"avc1.42001e",width:i,height:s,bitrate:2e6,framerate:t});const d=[];for(const t of e)try{const e=new Image;e.src=t,await e.decode();const a=await createImageBitmap(e,{resizeWidth:i,resizeHeight:s,resizeQuality:"high"});d.push(a)}catch(u){return void r(new Error(`Failed to load frame: ${u}`))}for(let e=0;e<d.length;e++){l.clearRect(0,0,i,s),l.drawImage(d[e],0,0,i,s);const a=new VideoFrame(o,{timestamp:Math.round(1e6*e/t),duration:Math.round(1e6/t)});try{h.encode(a)}finally{a.close()}e%5==0&&await new Promise(e=>setTimeout(e,0))}await h.flush(),n.finalize();let{buffer:c}=n.target;a(new Blob([c],{type:"video/mp4"})),d.forEach(e=>e.close())})}(i,a,r,n),e){const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="animation.mp4",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t),s?.()}}catch(t){alert("Failed to encode video. Check console for details.")}finally{l(!1)}};return e.useEffect(()=>{h()},[]),t.jsx("button",{className:"z-100 relative",onClick:h,disabled:o||!i.length,children:o?"Encoding...":"Download MP4"})};const It=({isOpen:i,onClose:s,onLoadFrames:a,currentFrameCount:r})=>{const[n,o]=e.useState([]),[l,h]=e.useState([]),[d,c]=e.useState(!1),[u,m]=e.useState(!0),f=e.useRef(null);if(!i)return null;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:t.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files){const t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/")||e.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(t);const i=t.map(e=>URL.createObjectURL(e));h(i)}},children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"Load Frames"}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white","aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-gray-300 mb-2",children:"Select image files to load as animation frames. Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP."}),t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("input",{type:"checkbox",id:"autoCreate",checked:u,onChange:e=>m(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"autoCreate",className:"text-gray-300",children:"Auto-create frames from selected files"})]})]}),t.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer mb-4 "+(n.length>0?"bg-gray-700":"bg-gray-900"),onClick:()=>f.current?.click(),children:[t.jsx("input",{type:"file",ref:f,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files).filter(e=>e.type.startsWith("image/")||e.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(t);const i=t.map(e=>URL.createObjectURL(e));h(i)}},className:"hidden",multiple:!0,accept:"image/*"}),0===n.length?t.jsxs("div",{children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),t.jsx("p",{className:"mt-2 text-gray-400",children:"Click or drag and drop image files here"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Supports PNG, JPG, JPEG, GIF, BMP, WebP"})]}):t.jsxs("div",{children:[t.jsxs("p",{className:"text-white mb-2",children:[n.length," file",1!==n.length?"s":""," selected"]}),t.jsx("p",{className:"text-sm text-gray-400",children:"Click to select more files"})]})]}),l.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Preview"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-60 overflow-y-auto",children:l.map((e,i)=>t.jsxs("div",{className:"relative group",children:[t.jsx("img",{src:e,alt:`Preview ${i+1}`,className:"w-full h-24 object-contain bg-gray-200 rounded"}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs",children:i+1})})]},i))})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(0!==n.length){if(r>0){if(!window.confirm(`This will replace your current ${r} frame(s) with ${n.length} new frame(s). Are you sure you want to continue?`))return}c(!0);try{const e=await Promise.all(n.map(e=>new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>i(s.error),s.readAsDataURL(e)})));a(e),s()}catch(e){alert("Error loading frames. Please try again.")}finally{c(!1)}}else alert("Please select at least one image file.")},disabled:d||0===n.length,className:"px-4 py-2 rounded-lg transition-colors "+(d||0===n.length?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:d?"Loading...":`Load ${n.length} Frame${1!==n.length?"s":""}`})]})]})})})},Rt=()=>{const[i,s]=e.useState(!1),[r,n]=e.useState(!1),[o,l]=e.useState(!1),[h,d]=e.useState(!0),[c,u]=e.useState(!1),[m,f]=e.useState("#000000"),[p,w]=e.useState(8),[g,x]=e.useState([]),[v,b]=e.useState([]),[y,k]=e.useState(0),[C,j]=e.useState(!1),[T,S]=e.useState(!0),[N,M]=e.useState(!1),[z,E]=e.useState(5),L=e.useRef(null);e.useEffect(()=>{const e=setTimeout(()=>{a(),setTimeout(()=>{if(window.drawingCanvas){const e=window.drawingCanvas.toDataURL(),t=D();t&&t.length>0?x(t):x([e])}},50)},100);return()=>clearTimeout(e)},[]),e.useEffect(()=>{window.selectedColor=m,window.brushSize=p,window.isEraser=C},[m,p,C]),e.useEffect(()=>{if(g.length>0&&y>=0&&y<g.length){const e=g[y];if(e&&""!==e)W(e);else if(window.drawingCanvas){const e=window.drawingCanvas,t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height))}}},[y,g]),e.useEffect(()=>{T&&g.length>0&&B(g)},[g,T]),e.useEffect(()=>()=>{L.current&&clearInterval(L.current)},[]);const A=e=>{if(window.drawingCanvas){const t=window.drawingCanvas,i=t.getContext("2d");if(!i)return;switch(i.fillStyle="white",i.fillRect(0,0,t.width,t.height),i.fillStyle=m,i.strokeStyle=m,i.lineWidth=p,e){case"circle":i.beginPath(),i.arc(t.width/2,t.height/2,50,0,2*Math.PI),i.fill();break;case"square":i.fillRect(t.width/2-50,t.height/2-50,100,100);break;case"smiley":i.beginPath(),i.arc(t.width/2,t.height/2,60,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(t.width/2-20,t.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(t.width/2+20,t.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(t.width/2,t.height/2,30,0,Math.PI,!1),i.stroke()}}},F=()=>window.getDrawingCanvasData?window.getDrawingCanvasData():"",W=e=>{window.setDrawingCanvasData&&e&&window.setDrawingCanvasData(e)},B=e=>{if(T)try{localStorage.setItem("animationFrames",JSON.stringify(e))}catch(t){}},D=()=>{try{const e=localStorage.getItem("animationFrames");return e?JSON.parse(e):null}catch(e){return null}},I=e=>{if(e<0||e>=g.length)return;const t=[...g];t[y]=F(),x(t),k(e),T&&B(t)};return t.jsxs("div",{className:"fixed inset-0 bg-gray-900 overflow-hidden",children:[t.jsx("canvas",{id:"canvas"}),i&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsx("div",{className:"grid grid-cols-6 gap-2 mb-3",children:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A"].map(e=>t.jsx("button",{className:`w-8 h-8 rounded-full border-2 ${m===e?"border-white":"border-gray-600"} focus:outline-none`,style:{backgroundColor:e},onClick:()=>f(e),"aria-label":`Select ${e} color`},e))}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("label",{htmlFor:"brushSize",className:"text-white text-sm",children:"Size:"}),t.jsx("input",{id:"brushSize",type:"range",min:"1",max:"20",value:p,onChange:e=>w(parseInt(e.target.value)),className:"w-32 accent-white"}),t.jsxs("span",{className:"text-white text-sm w-8",children:[p,"px"]})]})]}),t.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 -translate-x-16",onClick:()=>{s(!i),r&&n(!1)},"aria-label":i?"Hide color palette":"Show color palette",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),t.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-0",onClick:()=>{d(!h),s(!1)},"aria-label":"Frame manager",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-16",onClick:()=>{n(!r),i&&s(!1)},"aria-label":r?"Hide examples":"Show examples",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),r&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsx("h3",{className:"text-white mb-2",children:"Examples"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{A("circle"),n(!1)},children:"Circle"}),t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{A("square"),n(!1)},children:"Square"}),t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{A("smiley"),n(!1)},children:"Smiley"})]})]}),h&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-50 w-full max-w-4xl",children:[t.jsx("div",{className:"flex justify-between items-center mb-3",children:t.jsx("h3",{className:"text-white font-bold",children:"Frame Manager"})}),t.jsxs("div",{className:"flex flex-col space-y-3",children:[t.jsxs("div",{className:"flex space-x-2 justify-center",children:[t.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded",onClick:()=>{const e=[...g];e[y]=F(),x(e);const t=[...e];t.splice(y+1,0,""),x(t),k(y+1),T&&B(t)},"aria-label":"Add frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),t.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white p-2 rounded",onClick:()=>{if(0===g.length)return;const e=[...g];e[y]=F(),x(e);const t=e[y],i=[...e];i.splice(y+1,0,t),x(i),k(y+1),T&&B(i)},"aria-label":"Duplicate frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded",onClick:()=>{if(window.confirm("Are you sure you want to clear the current canvas? This action cannot be undone.")&&window.drawingCanvas){const e=window.drawingCanvas,t=e.getContext("2d");if(t){t.fillStyle="white",t.fillRect(0,0,e.width,e.height);const i=[...g];i[y]=e.toDataURL(),x(i),T&&B(i)}}},"aria-label":"Clear canvas",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),t.jsx("button",{className:"bg-teal-500 hover:bg-teal-600 text-white p-2 rounded",onClick:()=>{const e=F();if(!e)return void alert("No frame data to save");const t=document.createElement("a");t.href=e,t.download=`frame_${y+1}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},"aria-label":"Save current frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})}),t.jsx("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded",onClick:()=>{N?(L.current&&(clearInterval(L.current),L.current=null),M(!1)):(y===g.length-1&&I(0),(()=>{if(g.length<=1)return;M(!0),L.current&&clearInterval(L.current);const e=Math.max(10,1e3/z);L.current=setInterval(()=>{k(e=>(e+1)%g.length)},e)})())},"aria-label":N?"Pause animation":"Play animation",children:N?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 p-2 rounded",children:[t.jsx("label",{htmlFor:"fps-control",className:"text-white text-sm",children:"FPS:"}),t.jsxs("select",{id:"fps-control",value:z,onChange:e=>E(parseInt(e.target.value)),className:"bg-gray-600 text-white text-sm rounded px-1",disabled:N,children:[t.jsx("option",{value:"1",children:"1"}),t.jsx("option",{value:"5",children:"5"}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"24",children:"24"}),t.jsx("option",{value:"30",children:"30"})]})]})]}),t.jsx("div",{className:"flex flex-wrap gap-1 justify-center max-h-24 overflow-y-auto",children:g.map((e,i)=>t.jsx("button",{className:"w-10 h-10 rounded "+(i===y?"ring-2 ring-blue-400":""),onClick:()=>I(i),"aria-label":`Go to frame ${i+1}`,children:t.jsx("div",{className:"w-full h-full bg-gray-200 border border-gray-400 rounded flex items-center justify-center text-xs",children:i+1})},i))}),t.jsxs("div",{className:"flex items-center justify-between text-white text-sm text-center",children:[t.jsxs("div",{children:["Frame: ",y+1,"/",g.length]}),t.jsx("button",{className:"bg-gray-600 hover:bg-gray-500 text-white p-2 rounded",onClick:()=>{if(g.length<=1)return;if(!window.confirm("Are you sure you want to delete this frame? This action cannot be undone."))return;const e=[...g];e[y]=F();const t=e.filter((e,t)=>t!==y);x(t);const i=Math.min(y,t.length-1);k(i),T&&B(t)},"aria-label":"Delete frame",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),o&&t.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-white font-bold",children:"Settings"}),t.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>l(!1),"aria-label":"Close settings",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"Autosave to localStorage"}),t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"sr-only peer",checked:T,onChange:e=>S(e.target.checked)}),t.jsx("div",{className:`w-11 h-6 rounded-full peer ${T?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"LOAD FRAMES"}),t.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded",onClick:()=>{l(!1),u(!0)},"aria-label":"Load frames",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})})]}),t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-white",children:"Save as MP4"}),t.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded",onClick:async()=>{if(0!==g.length){if(window.confirm("Are you sure you want to export this animation as a MP4? This may take a moment."))try{let e=[];for(let t=0;t<g.length;t++){const i=g[t];if(i&&e.push(i),i){const e=i.split(",")[1],t=atob(e),s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i)}}e.length&&b(g.filter(Boolean));g.map((e,t)=>`file 'frame${t.toString().padStart(3,"0")}.png'`).join("\n")}catch(e){}}else alert("No frames to export")},"aria-label":"Export as MP4",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]}),t.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 -translate-x-32",onClick:()=>{l(!o)},"aria-label":o?"Hide settings":"Show settings",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-32 "+(C?"ring-2 ring-yellow-400":""),onClick:()=>j(!C),"aria-label":C?"Switch to drawing mode":"Switch to eraser mode",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!!v.length&&t.jsx(Dt,{frames:v,fps:z,width:512,height:512,clearFrames:()=>b([])}),t.jsx(It,{isOpen:c,onClose:()=>u(!1),onLoadFrames:e=>{if(g.length>0){const e=[...g];e[y]=F(),x(e)}x(e),k(0),e.length>0&&W(e[0]),T&&B(e)},currentFrameCount:g.length})]})};export{Rt as default};
