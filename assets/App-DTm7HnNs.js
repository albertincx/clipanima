import{r as t,j as e,e as i}from"./index-CagFanF-.js";var a=n;function n(t,e){return t-=370,s()[t]}!function(){for(var t=n,e=s();;)try{if(787979===parseInt(t(405))/1*(parseInt(t(390))/2)+-parseInt(t(381))/3*(parseInt(t(434))/4)+parseInt(t(392))/5+parseInt(t(432))/6*(-parseInt(t(429))/7)+-parseInt(t(388))/8+-parseInt(t(411))/9+parseInt(t(382))/10)break;e.push(e.shift())}catch(i){e.push(e.shift())}}();const r=(t=a(420))=>{var e=a;let i=document[e(391)](t);if(!i)return;const r={x:0,y:0},s=i[e(373)]("2d");var o=!1,h=!1,l=!0;const c=document.createElement(e(420)),d=c[e(407)]=512,u=c[e(425)]=512,m=c[e(373)]("2d");if(m[e(375)]=e(440),m.fillRect(0,0,d,u),window.drawingCanvas=c,window[e(418)]=()=>c.toDataURL(),window[e(430)]=t=>{var i=e;const a=new Image;a[i(384)]=()=>{var t=i;m[t(376)](0,0,c[t(407)],c[t(425)]),m[t(380)](a,0,0)},a[i(431)]=t},"canvas"===t){const t=document[e(391)](e(419)).getContext("2d");t.clearRect(0,0,w,v),t[e(389)](5,u,d-5,5),t[e(389)](d,5,5,u)}const p=function(t){var i=e;if(void 0===navigator[i(387)]&&(navigator.appVersion[i(400)](i(370))>-1||navigator[i(404)][i(400)]("iPhone")>-1||navigator[i(404)].indexOf(i(396))>-1)&&(navigator[i(387)]=5),navigator.maxTouchPoints>0)return function(t){var i=e;const a={points:[],x:0,y:0,count:0,w:0,rx:0,ry:0};var n=a,r=a[i(423)];function s(){for(var t=i,e=0;e<n[t(416)];e++)if(-1===r[e].id)return r[e]}function o(t){for(var e=0;e<n.pCount;e++)if(r[e].id===t)return r[e]}function h(t,e,a,n){var r=i;void 0!==t&&(a?(t.oy=e[r(398)],t.ox=e[r(386)],t.id=e[r(408)]):(t.ox=t.x,t.oy=t.y),t.x=e[r(398)],t.y=e[r(386)],t.down=n,!n&&(t.id=-1))}function l(){for(var t=i,e=0,a=0;a<n[t(416)];a++)-1!==r[a].id&&(0===e&&(n.x=r[a].x,n.y=r[a].y),e+=1);n[t(438)]=e}function c(t){var e,a,n=i;if(a=t[n(403)],t[n(426)]===n(413))for(e=0;e<a.length;e++)h(s(),a[e],!0,!0);else if("touchmove"===t[n(426)])for(e=0;e<a[n(372)];e++)h(o(a[e][n(408)]),a[e],!1,!0);else if("touchend"===t.type)for(e=0;e<a[n(372)];e++)h(o(a[e][n(408)]),a[e],!1,!1);return l(),t[n(439)](),!1}return a[i(416)]=navigator.maxTouchPoints,t=void 0===t?document:t,((t,e)=>{for(var i=0;i<t&&!0!==e(i++););})(navigator[i(387)],()=>a.points.push({x:0,y:0,dx:0,dy:0,down:!1,id:-1})),["touchstart",i(397),i(409)].forEach(e=>t.addEventListener(e,c)),a}(t)}(i);if(s[e(415)]=e(394),void 0===p)return;const f=[];function g(){var t=e;const i=window[t(424)]||t(393),a=window[t(436)]||8,n=window.isEraser||!1;for(m[t(401)]=t(374),n?(m[t(375)]=t(406),m[t(435)]=t(406)):(m[t(375)]=i,m.strokeStyle=i),m[t(410)]=a;f[t(372)]>0;){const e=f[t(412)]();m[t(414)](),m[t(378)](e.x,e.y,a/2,0,2*Math.PI),m[t(421)](),m[t(437)]()}}var w=i.width,v=i[e(425)];requestAnimationFrame(function t(a){var n=e;l&&(l=!1,x.setContext(s)),s[n(399)](1,0,0,1,0,0),s[n(377)]=1,s[n(401)]="source-over",(w!==innerWidth||v!==innerHeight)&&(w=i[n(407)]=innerWidth,v=i[n(425)]=innerHeight),300===canvas2.width&&(canvas2[n(407)]=innerWidth,canvas2.height=innerHeight),s[n(376)](0,0,w,v),x[n(422)](),s.fillStyle=n(393),s[n(377)]=.4,s[n(389)](5,u,d-5,5),s[n(389)](d,5,5,u),s[n(377)]=1,s.drawImage(c,0,0),s[n(399)](1,0,0,1,0,0),1!==p[n(438)]&&!o||h?2===p[n(438)]||h?(f.length=0,0===p.count?h=!1:h||2!==p[n(438)]?x[n(428)](p[n(423)][0],p.points[1]):(h=!0,x[n(395)](p[n(423)][0],p[n(423)][1]))):(h=!1,o=!1):0===p[n(438)]?(o=!1,g()):(x[n(379)](p,r),f[n(402)]({x:r.x,y:r.y}),o?g():f.length>8&&(o=!0)),requestAnimationFrame(t)});const x=(()=>{const t=[1,0,0,1,0,0],e=[1,0,0,1,0,0];var i=t,a=e,r=1,s=0;const o={x:0,y:0},h={x:0,y:0};var l,c=0,d=1,u=0,m=0;const p={x:0,y:0};var f=!0;return{canvasDefault(){l[n(399)](1,0,0,1,0,0)},apply(){var t=n;f&&this[t(417)](),l[t(399)](i[0],i[1],i[2],i[3],i[4],i[5])},reset(){r=1,s=0,p.x=0,p.y=0,f=!0},matrix:t,invMatrix:e,update(){var t=n;f=!1,i[3]=i[0]=Math[t(371)](s)*r,i[2]=-(i[1]=Math[t(427)](s)*r),i[4]=p.x,i[5]=p.y,this[t(383)]=1/r;var e=i[0]*i[3]-i[1]*i[2];a[0]=i[3]/e,a[1]=-i[1]/e,a[2]=-i[2]/e,a[3]=i[0]/e},toWorld(t,e={}){var r,s;return f&&this[n(417)](),r=t.x-i[4],s=t.y-i[5],e.x=r*a[0]+s*a[2],e.y=r*a[1]+s*a[3],e},toScreen(t,e={}){return f&&this[n(417)](),e.x=t.x*i[0]+t.y*i[2]+i[4],e.y=t.x*i[1]+t.y*i[3]+i[5],e},setPinch(t,e){var i=n;f&&this[i(417)](),o.x=t.x,o.y=t.y;var a=e.x-o.x,l=e.y-o.y;c=Math[i(433)](a*a+l*l),m=Math.atan2(l,a),d=r,u=s,this[i(379)](o,h)},movePinch(t,e,a){var o=n;f&&this[o(417)]();var l=e.x-t.x,g=e.y-t.y,w=Math[o(433)](l*l+g*g);if(r=d*(w/c),!a){var v=Math[o(385)](g,l);s=u+(v-m)}this[o(417)](),p.x=t.x-h.x*i[0]-h.y*i[2],p.y=t.y-h.x*i[1]-h.y*i[3],f=!0},setContext(t){l=t,f=!0}}})()};function s(){var t=["invScale","onload","atan2","pageY","maxTouchPoints","6084856ToujOr","fillRect","2577202lAzYEN","getElementById","2036485QZGGSB","black","16px arial.","setPinch","iPad","touchmove","pageX","setTransform","indexOf","globalCompositeOperation","push","changedTouches","appVersion","1pABBKj","rgba(255, 255, 255, 1)","width","identifier","touchend","lineWidth","1384794NpQmay","shift","touchstart","beginPath","font","pCount","update","getDrawingCanvasData","canvas2","canvas","fill","apply","points","selectedColor","height","type","sin","movePinch","6573EDJGGf","setDrawingCanvasData","src","2118yZPlhM","sqrt","4LJIsLT","strokeStyle","brushSize","stroke","count","preventDefault","white","Android","cos","length","getContext","source-over","fillStyle","clearRect","globalAlpha","arc","toWorld","drawImage","3440169YmRfhE","14847440NXlVAu"];return(s=function(){return t})()}var o,h,l,c,d,u,m,p,f=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},g=(t,e,i)=>(f(t,e,"read from private field"),i?i.call(t):e.get(t)),w=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},v=(t,e,i,a)=>(f(t,e,"write to private field"),e.set(t,i),i),x=(t,e,i)=>(f(t,e,"access private method"),i),b=new Uint8Array(8),y=new DataView(b.buffer),C=t=>[(t%256+256)%256],k=t=>(y.setUint16(0,t,!1),[b[0],b[1]]),j=t=>(y.setUint32(0,t,!1),[b[1],b[2],b[3]]),M=t=>(y.setUint32(0,t,!1),[b[0],b[1],b[2],b[3]]),T=t=>(y.setUint32(0,Math.floor(t/2**32),!1),y.setUint32(4,t,!1),[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]]),N=t=>(y.setInt16(0,256*t,!1),[b[0],b[1]]),S=t=>(y.setInt32(0,65536*t,!1),[b[0],b[1],b[2],b[3]]),D=t=>(y.setInt32(0,2**30*t,!1),[b[0],b[1],b[2],b[3]]),L=(t,e=!1)=>{let i=Array(t.length).fill(null).map((e,i)=>t.charCodeAt(i));return e&&i.push(0),i},E=t=>t&&t[t.length-1],z=t=>{let e;for(let i of t)(!e||i.presentationTimestamp>e.presentationTimestamp)&&(e=i);return e},B=(t,e,i=!0)=>{let a=t*e;return i?Math.round(a):a},O=t=>{let e=t*(Math.PI/180),i=Math.cos(e),a=Math.sin(e);return[i,a,0,-a,i,0,0,0,1]},R=O(0),W=t=>[S(t[0]),S(t[1]),D(t[2]),S(t[3]),S(t[4]),D(t[5]),S(t[6]),S(t[7]),D(t[8])],A=t=>t?"object"!=typeof t?t:Array.isArray(t)?t.map(A):Object.fromEntries(Object.entries(t).map(([t,e])=>[t,A(e)])):t,I=t=>t>=0&&t<2**32,P=(t,e,i)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:i}),F=(t,e,i,a,n)=>P(t,[C(e),j(i),a??[]],n),H=t=>({type:"mdat",largeSize:t}),U=(t,e,i=!1)=>P("moov",null,[Y(e,t),...t.map(t=>V(t,e)),i?ft(t):null]),Y=(t,e)=>{let i=B(Math.max(0,...e.filter(t=>t.samples.length>0).map(t=>{const e=z(t.samples);return e.presentationTimestamp+e.duration})),Be),a=Math.max(...e.map(t=>t.id))+1,n=!I(t)||!I(i),r=n?T:M;return F("mvhd",+n,0,[r(t),r(t),M(Be),r(i),S(1),N(1),Array(10).fill(0),W(R),Array(24).fill(0),M(a)])},V=(t,e)=>P("trak",null,[X(t,e),$(t,e)]),X=(t,e)=>{let i,a=z(t.samples),n=B(a?a.presentationTimestamp+a.duration:0,Be),r=!I(e)||!I(n),s=r?T:M;return i="video"===t.info.type?"number"==typeof t.info.rotation?O(t.info.rotation):t.info.rotation:R,F("tkhd",+r,3,[s(e),s(e),M(t.id),M(0),s(n),Array(8).fill(0),k(0),k(0),N("audio"===t.info.type?1:0),k(0),W(i),S("video"===t.info.type?t.info.width:0),S("video"===t.info.type?t.info.height:0)])},$=(t,e)=>P("mdia",null,[q(t,e),G("video"===t.info.type?"vide":"soun"),J(t)]),q=(t,e)=>{let i=z(t.samples),a=B(i?i.presentationTimestamp+i.duration:0,t.timescale),n=!I(e)||!I(a),r=n?T:M;return F("mdhd",+n,0,[r(e),r(e),M(t.timescale),r(a),k(21956),k(0)])},G=t=>F("hdlr",0,0,[L("mhlr"),L(t),M(0),M(0),M(0),L("mp4-muxer-hdlr",!0)]),J=t=>P("minf",null,["video"===t.info.type?Q():K(),Z(),et(t)]),Q=()=>F("vmhd",0,1,[k(0),k(0),k(0),k(0)]),K=()=>F("smhd",0,0,[k(0),k(0)]),Z=()=>P("dinf",null,[_()]),_=()=>F("dref",0,0,[M(1)],[tt()]),tt=()=>F("url ",0,1),et=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(t=>0!==t.sampleCompositionTimeOffset);return P("stbl",null,[it(t),lt(t),ct(t),dt(t),ut(t),mt(t),e?pt(t):null])},it=t=>F("stsd",0,0,[M(1)],["video"===t.info.type?at(Tt[t.info.codec],t):ht(St[t.info.codec],t)]),at=(t,e)=>{return P(t,[Array(6).fill(0),k(1),k(0),k(0),Array(12).fill(0),k(e.info.width),k(e.info.height),M(4718592),M(4718592),M(0),k(1),Array(32).fill(0),k(24),(i=65535,y.setInt16(0,i,!1),[b[0],b[1]])],[Nt[e.info.codec](e),e.info.decoderConfig.colorSpace?ot(e):null]);var i},nt={bt709:1,bt470bg:5,smpte170m:6},rt={bt709:1,smpte170m:6,"iec61966-2-1":13},st={rgb:0,bt709:1,bt470bg:5,smpte170m:6},ot=t=>P("colr",[L("nclx"),k(nt[t.info.decoderConfig.colorSpace.primaries]),k(rt[t.info.decoderConfig.colorSpace.transfer]),k(st[t.info.decoderConfig.colorSpace.matrix]),C((t.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),ht=(t,e)=>P(t,[Array(6).fill(0),k(1),k(0),k(0),M(0),k(e.info.numberOfChannels),k(16),k(0),k(0),S(e.info.sampleRate)],[Dt[e.info.codec](e)]),lt=t=>F("stts",0,0,[M(t.timeToSampleTable.length),t.timeToSampleTable.map(t=>[M(t.sampleCount),M(t.sampleDelta)])]),ct=t=>{if(t.samples.every(t=>"key"===t.type))return null;let e=[...t.samples.entries()].filter(([,t])=>"key"===t.type);return F("stss",0,0,[M(e.length),e.map(([t])=>M(t+1))])},dt=t=>F("stsc",0,0,[M(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(t=>[M(t.firstChunk),M(t.samplesPerChunk),M(1)])]),ut=t=>F("stsz",0,0,[M(0),M(t.samples.length),t.samples.map(t=>M(t.size))]),mt=t=>t.finalizedChunks.length>0&&E(t.finalizedChunks).offset>=2**32?F("co64",0,0,[M(t.finalizedChunks.length),t.finalizedChunks.map(t=>T(t.offset))]):F("stco",0,0,[M(t.finalizedChunks.length),t.finalizedChunks.map(t=>M(t.offset))]),pt=t=>F("ctts",0,0,[M(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(t=>[M(t.sampleCount),M(t.sampleCompositionTimeOffset)])]),ft=t=>P("mvex",null,t.map(gt)),gt=t=>F("trex",0,0,[M(t.id),M(1),M(0),M(0),M(0)]),wt=(t,e)=>P("moof",null,[vt(t),...e.map(bt)]),vt=t=>F("mfhd",0,0,[M(t)]),xt=t=>{let e=0,i=0,a="delta"===t.type;return i|=+a,e|=a?1:2,e<<24|i<<16},bt=t=>P("traf",null,[yt(t),Ct(t),kt(t)]),yt=t=>{let e=0;e|=8,e|=16,e|=32,e|=131072;let i=t.currentChunk.samples[1]??t.currentChunk.samples[0],a={duration:i.timescaleUnitsToNextSample,size:i.size,flags:xt(i)};return F("tfhd",0,131128,[M(t.id),M(a.duration),M(a.size),M(a.flags)])},Ct=t=>F("tfdt",1,0,[T(B(t.currentChunk.startTimestamp,t.timescale))]),kt=t=>{let e=t.currentChunk.samples.map(t=>t.timescaleUnitsToNextSample),i=t.currentChunk.samples.map(t=>t.size),a=t.currentChunk.samples.map(xt),n=t.currentChunk.samples.map(e=>B(e.presentationTimestamp-e.decodeTimestamp,t.timescale)),r=new Set(e),s=new Set(i),o=new Set(a),h=new Set(n),l=2===o.size&&a[0]!==a[1],c=r.size>1,d=s.size>1,u=!l&&o.size>1,m=h.size>1||[...h].some(t=>0!==t),p=0;return p|=1,p|=4*+l,p|=256*+c,p|=512*+d,p|=1024*+u,p|=2048*+m,F("trun",1,p,[M(t.currentChunk.samples.length),M(t.currentChunk.offset-t.currentChunk.moofOffset||0),l?M(a[0]):[],t.currentChunk.samples.map((t,r)=>{return[c?M(e[r]):[],d?M(i[r]):[],u?M(a[r]):[],m?(s=n[r],y.setInt32(0,s,!1),[b[0],b[1],b[2],b[3]]):[]];var s})])},jt=(t,e)=>F("tfra",1,0,[M(t.id),M(63),M(t.finalizedChunks.length),t.finalizedChunks.map(i=>[T(B(i.startTimestamp,t.timescale)),T(i.moofOffset),M(e+1),M(1),M(1)])]),Mt=()=>F("mfro",0,0,[M(0)]),Tt={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Nt={avc:t=>t.info.decoderConfig&&P("avcC",[...new Uint8Array(t.info.decoderConfig.description)]),hevc:t=>t.info.decoderConfig&&P("hvcC",[...new Uint8Array(t.info.decoderConfig.description)]),vp9:t=>{if(!t.info.decoderConfig)return null;let e=t.info.decoderConfig;if(!e.colorSpace)throw new Error("'colorSpace' is required in the decoder config for VP9.");let i=e.codec.split("."),a=Number(i[1]),n=Number(i[2]),r=0+(Number(i[3])<<4)+Number(e.colorSpace.fullRange);return F("vpcC",1,0,[C(a),C(n),C(r),C(2),C(2),C(2),k(0)])},av1:()=>P("av1C",[129,0,0,0])},St={aac:"mp4a",opus:"Opus"},Dt={aac:t=>{let e=new Uint8Array(t.info.decoderConfig.description);return F("esds",0,0,[M(58753152),C(32+e.byteLength),k(1),C(0),M(75530368),C(18+e.byteLength),C(64),C(21),j(0),M(130071),M(130071),M(92307584),C(e.byteLength),...e,M(109084800),C(1),C(2)])},opus:t=>{let e=3840,i=0;const a=t.info.decoderConfig?.description;if(a){if(a.byteLength<18)throw new TypeError("Invalid decoder description provided for Opus; must be at least 18 bytes long.");const t=ArrayBuffer.isView(a)?new DataView(a.buffer,a.byteOffset,a.byteLength):new DataView(a);e=t.getUint16(10,!0),i=t.getInt16(14,!0)}return P("dOps",[C(0),C(t.info.numberOfChannels),k(e),M(t.info.sampleRate),N(i),C(0)])}},Lt=class{},Et=class extends Lt{constructor(){super(...arguments),this.buffer=null}},zt=class extends Lt{constructor(t){if(super(),this.options=t,"object"!=typeof t)throw new TypeError("StreamTarget requires an options object to be passed to its constructor.");if(t.onData){if("function"!=typeof t.onData)throw new TypeError("options.onData, when provided, must be a function.");if(t.onData.length<2)throw new TypeError("options.onData, when provided, must be a function that takes in at least two arguments (data and position). Ignoring the position argument, which specifies the byte offset at which the data is to be written, can lead to broken outputs.")}if(void 0!==t.chunked&&"boolean"!=typeof t.chunked)throw new TypeError("options.chunked, when provided, must be a boolean.");if(void 0!==t.chunkSize&&(!Number.isInteger(t.chunkSize)||t.chunkSize<1024))throw new TypeError("options.chunkSize, when provided, must be an integer and not smaller than 1024.")}},Bt=class extends Lt{constructor(t,e){if(super(),this.stream=t,this.options=e,!(t instanceof FileSystemWritableFileStream))throw new TypeError("FileSystemWritableFileStreamTarget requires a FileSystemWritableFileStream instance.");if(void 0!==e&&"object"!=typeof e)throw new TypeError("FileSystemWritableFileStreamTarget's options, when provided, must be an object.");if(e&&void 0!==e.chunkSize&&(!Number.isInteger(e.chunkSize)||e.chunkSize<=0))throw new TypeError("options.chunkSize, when provided, must be a positive integer")}},Ot=class{constructor(){this.pos=0,w(this,o,new Uint8Array(8)),w(this,h,new DataView(g(this,o).buffer)),this.offsets=new WeakMap}seek(t){this.pos=t}writeU32(t){g(this,h).setUint32(0,t,!1),this.write(g(this,o).subarray(0,4))}writeU64(t){g(this,h).setUint32(0,Math.floor(t/2**32),!1),g(this,h).setUint32(4,t,!1),this.write(g(this,o).subarray(0,8))}writeAscii(t){for(let e=0;e<t.length;e++)g(this,h).setUint8(e%8,t.charCodeAt(e)),e%8==7&&this.write(g(this,o));t.length%8!=0&&this.write(g(this,o).subarray(0,t.length%8))}writeBox(t){if(this.offsets.set(t,this.pos),t.contents&&!t.children)this.writeBoxHeader(t,t.size??t.contents.byteLength+8),this.write(t.contents);else{let e=this.pos;if(this.writeBoxHeader(t,0),t.contents&&this.write(t.contents),t.children)for(let n of t.children)n&&this.writeBox(n);let i=this.pos,a=t.size??i-e;this.seek(e),this.writeBoxHeader(t,a),this.seek(i)}}writeBoxHeader(t,e){this.writeU32(t.largeSize?1:e),this.writeAscii(t.type),t.largeSize&&this.writeU64(e)}measureBoxHeader(t){return 8+(t.largeSize?8:0)}patchBox(t){let e=this.pos;this.seek(this.offsets.get(t)),this.writeBox(t),this.seek(e)}measureBox(t){if(t.contents&&!t.children){return this.measureBoxHeader(t)+t.contents.byteLength}{let e=this.measureBoxHeader(t);if(t.contents&&(e+=t.contents.byteLength),t.children)for(let i of t.children)i&&(e+=this.measureBox(i));return e}}};o=new WeakMap,h=new WeakMap;var Rt=class extends Ot{constructor(t){super(),w(this,m),w(this,l,void 0),w(this,c,new ArrayBuffer(65536)),w(this,d,new Uint8Array(g(this,c))),w(this,u,0),v(this,l,t)}write(t){x(this,m,p).call(this,this.pos+t.byteLength),g(this,d).set(t,this.pos),this.pos+=t.byteLength,v(this,u,Math.max(g(this,u),this.pos))}finalize(){x(this,m,p).call(this,this.pos),g(this,l).buffer=g(this,c).slice(0,Math.max(g(this,u),this.pos))}};l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,m=new WeakSet,p=function(t){let e=g(this,c).byteLength;for(;e<t;)e*=2;if(e===g(this,c).byteLength)return;let i=new ArrayBuffer(e),a=new Uint8Array(i);a.set(g(this,d),0),v(this,c,i),v(this,d,a)};var Wt,At,It,Pt,Ft,Ht,Ut,Yt,Vt,Xt,$t,qt,Gt,Jt=class extends Ot{constructor(t){super(),w(this,Ht),w(this,Yt),w(this,Xt),w(this,qt),w(this,Wt,void 0),w(this,At,[]),w(this,It,void 0),w(this,Pt,void 0),w(this,Ft,[]),v(this,Wt,t),v(this,It,t.options?.chunked??!1),v(this,Pt,t.options?.chunkSize??16777216)}write(t){g(this,At).push({data:t.slice(),start:this.pos}),this.pos+=t.byteLength}flush(){if(0===g(this,At).length)return;let t=[],e=[...g(this,At)].sort((t,e)=>t.start-e.start);t.push({start:e[0].start,size:e[0].data.byteLength});for(let i=1;i<e.length;i++){let a=t[t.length-1],n=e[i];n.start<=a.start+a.size?a.size=Math.max(a.size,n.start+n.data.byteLength-a.start):t.push({start:n.start,size:n.data.byteLength})}for(let i of t){i.data=new Uint8Array(i.size);for(let t of g(this,At))i.start<=t.start&&t.start<i.start+i.size&&i.data.set(t.data,t.start-i.start);g(this,It)?(x(this,Ht,Ut).call(this,i.data,i.start),x(this,qt,Gt).call(this)):g(this,Wt).options.onData?.(i.data,i.start)}g(this,At).length=0}finalize(){g(this,It)&&x(this,qt,Gt).call(this,!0)}};Wt=new WeakMap,At=new WeakMap,It=new WeakMap,Pt=new WeakMap,Ft=new WeakMap,Ht=new WeakSet,Ut=function(t,e){let i=g(this,Ft).findIndex(t=>t.start<=e&&e<t.start+g(this,Pt));-1===i&&(i=x(this,Xt,$t).call(this,e));let a=g(this,Ft)[i],n=e-a.start,r=t.subarray(0,Math.min(g(this,Pt)-n,t.byteLength));a.data.set(r,n);let s={start:n,end:n+r.byteLength};if(x(this,Yt,Vt).call(this,a,s),0===a.written[0].start&&a.written[0].end===g(this,Pt)&&(a.shouldFlush=!0),g(this,Ft).length>2){for(let t=0;t<g(this,Ft).length-1;t++)g(this,Ft)[t].shouldFlush=!0;x(this,qt,Gt).call(this)}r.byteLength<t.byteLength&&x(this,Ht,Ut).call(this,t.subarray(r.byteLength),e+r.byteLength)},Yt=new WeakSet,Vt=function(t,e){let i=0,a=t.written.length-1,n=-1;for(;i<=a;){let r=Math.floor(i+(a-i+1)/2);t.written[r].start<=e.start?(i=r+1,n=r):a=r-1}for(t.written.splice(n+1,0,e),(-1===n||t.written[n].end<e.start)&&n++;n<t.written.length-1&&t.written[n].end>=t.written[n+1].start;)t.written[n].end=Math.max(t.written[n].end,t.written[n+1].end),t.written.splice(n+1,1)},Xt=new WeakSet,$t=function(t){let e={start:Math.floor(t/g(this,Pt))*g(this,Pt),data:new Uint8Array(g(this,Pt)),written:[],shouldFlush:!1};return g(this,Ft).push(e),g(this,Ft).sort((t,e)=>t.start-e.start),g(this,Ft).indexOf(e)},qt=new WeakSet,Gt=function(t=!1){for(let e=0;e<g(this,Ft).length;e++){let i=g(this,Ft)[e];if(i.shouldFlush||t){for(let t of i.written)g(this,Wt).options.onData?.(i.data.subarray(t.start,t.end),i.start+t.start);g(this,Ft).splice(e--,1)}}};var Qt,Kt,Zt,_t,te,ee,ie,ae,ne,re,se,oe,he,le,ce,de,ue,me,pe,fe,ge,we,ve,xe,be,ye,Ce,ke,je,Me,Te,Ne,Se,De,Le,Ee,ze=class extends Jt{constructor(t){super(new zt({onData:(e,i)=>t.stream.write({type:"write",data:e,position:i}),chunked:!0,chunkSize:t.options?.chunkSize}))}},Be=1e3,Oe=["avc","hevc","vp9","av1"],Re=["aac","opus"],We=["strict","offset","cross-track-offset"],Ae=class{constructor(t){if(w(this,he),w(this,ce),w(this,ue),w(this,pe),w(this,ge),w(this,ve),w(this,be),w(this,Ce),w(this,je),w(this,Te),w(this,Se),w(this,Le),w(this,Qt,void 0),w(this,Kt,void 0),w(this,Zt,void 0),w(this,_t,void 0),w(this,te,null),w(this,ee,null),w(this,ie,Math.floor(Date.now()/1e3)+2082844800),w(this,ae,[]),w(this,ne,1),w(this,re,[]),w(this,se,[]),w(this,oe,!1),x(this,he,le).call(this,t),t.video=A(t.video),t.audio=A(t.audio),t.fastStart=A(t.fastStart),this.target=t.target,v(this,Qt,{firstTimestampBehavior:"strict",...t}),t.target instanceof Et)v(this,Kt,new Rt(t.target));else if(t.target instanceof zt)v(this,Kt,new Jt(t.target));else{if(!(t.target instanceof Bt))throw new Error(`Invalid target: ${t.target}`);v(this,Kt,new ze(t.target))}x(this,pe,fe).call(this),x(this,ce,de).call(this)}addVideoChunk(t,e,i,a){if(!(t instanceof EncodedVideoChunk))throw new TypeError("addVideoChunk's first argument (sample) must be of type EncodedVideoChunk.");if(e&&"object"!=typeof e)throw new TypeError("addVideoChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addVideoChunk's third argument (timestamp), when provided, must be a non-negative real number.");if(void 0!==a&&!Number.isFinite(a))throw new TypeError("addVideoChunk's fourth argument (compositionTimeOffset), when provided, must be a real number.");let n=new Uint8Array(t.byteLength);t.copyTo(n),this.addVideoChunkRaw(n,t.type,i??t.timestamp,t.duration,e,a)}addVideoChunkRaw(t,e,i,a,n,r){if(!(t instanceof Uint8Array))throw new TypeError("addVideoChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==e&&"delta"!==e)throw new TypeError("addVideoChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addVideoChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(a)||a<0)throw new TypeError("addVideoChunkRaw's fourth argument (duration) must be a non-negative real number.");if(n&&"object"!=typeof n)throw new TypeError("addVideoChunkRaw's fifth argument (meta), when provided, must be an object.");if(void 0!==r&&!Number.isFinite(r))throw new TypeError("addVideoChunkRaw's sixth argument (compositionTimeOffset), when provided, must be a real number.");if(x(this,Le,Ee).call(this),!g(this,Qt).video)throw new Error("No video track declared.");if("object"==typeof g(this,Qt).fastStart&&g(this,te).samples.length===g(this,Qt).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${g(this,Qt).fastStart.expectedVideoChunks}).`);let s=x(this,ve,xe).call(this,g(this,te),t,e,i,a,n,r);if("fragmented"===g(this,Qt).fastStart&&g(this,ee)){for(;g(this,se).length>0&&g(this,se)[0].decodeTimestamp<=s.decodeTimestamp;){let t=g(this,se).shift();x(this,be,ye).call(this,g(this,ee),t)}s.decodeTimestamp<=g(this,ee).lastDecodeTimestamp?x(this,be,ye).call(this,g(this,te),s):g(this,re).push(s)}else x(this,be,ye).call(this,g(this,te),s)}addAudioChunk(t,e,i){if(!(t instanceof EncodedAudioChunk))throw new TypeError("addAudioChunk's first argument (sample) must be of type EncodedAudioChunk.");if(e&&"object"!=typeof e)throw new TypeError("addAudioChunk's second argument (meta), when provided, must be an object.");if(void 0!==i&&(!Number.isFinite(i)||i<0))throw new TypeError("addAudioChunk's third argument (timestamp), when provided, must be a non-negative real number.");let a=new Uint8Array(t.byteLength);t.copyTo(a),this.addAudioChunkRaw(a,t.type,i??t.timestamp,t.duration,e)}addAudioChunkRaw(t,e,i,a,n){if(!(t instanceof Uint8Array))throw new TypeError("addAudioChunkRaw's first argument (data) must be an instance of Uint8Array.");if("key"!==e&&"delta"!==e)throw new TypeError("addAudioChunkRaw's second argument (type) must be either 'key' or 'delta'.");if(!Number.isFinite(i)||i<0)throw new TypeError("addAudioChunkRaw's third argument (timestamp) must be a non-negative real number.");if(!Number.isFinite(a)||a<0)throw new TypeError("addAudioChunkRaw's fourth argument (duration) must be a non-negative real number.");if(n&&"object"!=typeof n)throw new TypeError("addAudioChunkRaw's fifth argument (meta), when provided, must be an object.");if(x(this,Le,Ee).call(this),!g(this,Qt).audio)throw new Error("No audio track declared.");if("object"==typeof g(this,Qt).fastStart&&g(this,ee).samples.length===g(this,Qt).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${g(this,Qt).fastStart.expectedAudioChunks}).`);let r=x(this,ve,xe).call(this,g(this,ee),t,e,i,a,n);if("fragmented"===g(this,Qt).fastStart&&g(this,te)){for(;g(this,re).length>0&&g(this,re)[0].decodeTimestamp<=r.decodeTimestamp;){let t=g(this,re).shift();x(this,be,ye).call(this,g(this,te),t)}r.decodeTimestamp<=g(this,te).lastDecodeTimestamp?x(this,be,ye).call(this,g(this,ee),r):g(this,se).push(r)}else x(this,be,ye).call(this,g(this,ee),r)}finalize(){if(g(this,oe))throw new Error("Cannot finalize a muxer more than once.");if("fragmented"===g(this,Qt).fastStart){for(let t of g(this,re))x(this,be,ye).call(this,g(this,te),t);for(let t of g(this,se))x(this,be,ye).call(this,g(this,ee),t);x(this,Te,Ne).call(this,!1)}else g(this,te)&&x(this,je,Me).call(this,g(this,te)),g(this,ee)&&x(this,je,Me).call(this,g(this,ee));let t=[g(this,te),g(this,ee)].filter(Boolean);if("in-memory"===g(this,Qt).fastStart){let e;for(let a=0;a<2;a++){let i=U(t,g(this,ie)),a=g(this,Kt).measureBox(i);e=g(this,Kt).measureBox(g(this,_t));let n=g(this,Kt).pos+a+e;for(let t of g(this,ae)){t.offset=n;for(let{data:i}of t.samples)n+=i.byteLength,e+=i.byteLength}if(n<2**32)break;e>=2**32&&(g(this,_t).largeSize=!0)}let i=U(t,g(this,ie));g(this,Kt).writeBox(i),g(this,_t).size=e,g(this,Kt).writeBox(g(this,_t));for(let t of g(this,ae))for(let e of t.samples)g(this,Kt).write(e.data),e.data=null}else if("fragmented"===g(this,Qt).fastStart){let e=g(this,Kt).pos,i=(t=>P("mfra",null,[...t.map(jt),Mt()]))(t);g(this,Kt).writeBox(i);let a=g(this,Kt).pos-e;g(this,Kt).seek(g(this,Kt).pos-4),g(this,Kt).writeU32(a)}else{let e=g(this,Kt).offsets.get(g(this,_t)),i=g(this,Kt).pos-e;g(this,_t).size=i,g(this,_t).largeSize=i>=2**32,g(this,Kt).patchBox(g(this,_t));let a=U(t,g(this,ie));if("object"==typeof g(this,Qt).fastStart){g(this,Kt).seek(g(this,Zt)),g(this,Kt).writeBox(a);let t=e-g(this,Kt).pos;g(this,Kt).writeBox({type:"free",size:t})}else g(this,Kt).writeBox(a)}x(this,Se,De).call(this),g(this,Kt).finalize(),v(this,oe,!0)}};function Ie(t,e){t-=201;return Pe()[t]}function Pe(){const t=["canvas","1167516HCvRtY","4hsHsfu","104hDHQCy","5881320hiUFbW","3vaJbED","toDataURL","all","231086KAlLVO","drawImage","451355nntSYl","onerror","1043035oPgWNR","onload","57123AyIOEY","anonymous","map","createElement","getContext","150333GGLrdk","src","crossOrigin","height"];return(Pe=function(){return t})()}Qt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,_t=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ae=new WeakMap,ne=new WeakMap,re=new WeakMap,se=new WeakMap,oe=new WeakMap,he=new WeakSet,le=function(t){if("object"!=typeof t)throw new TypeError("The muxer requires an options object to be passed to its constructor.");if(!(t.target instanceof Lt))throw new TypeError("The target must be provided and an instance of Target.");if(t.video){if(!Oe.includes(t.video.codec))throw new TypeError(`Unsupported video codec: ${t.video.codec}`);if(!Number.isInteger(t.video.width)||t.video.width<=0)throw new TypeError(`Invalid video width: ${t.video.width}. Must be a positive integer.`);if(!Number.isInteger(t.video.height)||t.video.height<=0)throw new TypeError(`Invalid video height: ${t.video.height}. Must be a positive integer.`);const e=t.video.rotation;if("number"==typeof e&&![0,90,180,270].includes(e))throw new TypeError(`Invalid video rotation: ${e}. Has to be 0, 90, 180 or 270.`);if(Array.isArray(e)&&(9!==e.length||e.some(t=>"number"!=typeof t)))throw new TypeError(`Invalid video transformation matrix: ${e.join()}`);if(void 0!==t.video.frameRate&&(!Number.isInteger(t.video.frameRate)||t.video.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${t.video.frameRate}. Must be a positive integer.`)}if(t.audio){if(!Re.includes(t.audio.codec))throw new TypeError(`Unsupported audio codec: ${t.audio.codec}`);if(!Number.isInteger(t.audio.numberOfChannels)||t.audio.numberOfChannels<=0)throw new TypeError(`Invalid number of audio channels: ${t.audio.numberOfChannels}. Must be a positive integer.`);if(!Number.isInteger(t.audio.sampleRate)||t.audio.sampleRate<=0)throw new TypeError(`Invalid audio sample rate: ${t.audio.sampleRate}. Must be a positive integer.`)}if(t.firstTimestampBehavior&&!We.includes(t.firstTimestampBehavior))throw new TypeError(`Invalid first timestamp behavior: ${t.firstTimestampBehavior}`);if("object"==typeof t.fastStart){if(t.video){if(void 0===t.fastStart.expectedVideoChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(!Number.isInteger(t.fastStart.expectedVideoChunks)||t.fastStart.expectedVideoChunks<0)throw new TypeError("'expectedVideoChunks' must be a non-negative integer.")}if(t.audio){if(void 0===t.fastStart.expectedAudioChunks)throw new TypeError("'fastStart' is an object but is missing property 'expectedAudioChunks'.");if(!Number.isInteger(t.fastStart.expectedAudioChunks)||t.fastStart.expectedAudioChunks<0)throw new TypeError("'expectedAudioChunks' must be a non-negative integer.")}}else if(![!1,"in-memory","fragmented"].includes(t.fastStart))throw new TypeError("'fastStart' option must be false, 'in-memory', 'fragmented' or an object.");if(void 0!==t.minFragmentDuration&&(!Number.isFinite(t.minFragmentDuration)||t.minFragmentDuration<0))throw new TypeError("'minFragmentDuration' must be a non-negative number.")},ce=new WeakSet,de=function(){var t;if(g(this,Kt).writeBox((t={holdsAvc:"avc"===g(this,Qt).video?.codec,fragmented:"fragmented"===g(this,Qt).fastStart}).fragmented?P("ftyp",[L("iso5"),M(512),L("iso5"),L("iso6"),L("mp41")]):P("ftyp",[L("isom"),M(512),L("isom"),t.holdsAvc?L("avc1"):[],L("mp41")])),v(this,Zt,g(this,Kt).pos),"in-memory"===g(this,Qt).fastStart)v(this,_t,H(!1));else if("fragmented"===g(this,Qt).fastStart);else{if("object"==typeof g(this,Qt).fastStart){let t=x(this,ue,me).call(this);g(this,Kt).seek(g(this,Kt).pos+t)}v(this,_t,H(!0)),g(this,Kt).writeBox(g(this,_t))}x(this,Se,De).call(this)},ue=new WeakSet,me=function(){if("object"!=typeof g(this,Qt).fastStart)return;let t=0,e=[g(this,Qt).fastStart.expectedVideoChunks,g(this,Qt).fastStart.expectedAudioChunks];for(let i of e)i&&(t+=8*Math.ceil(2/3*i),t+=4*i,t+=12*Math.ceil(2/3*i),t+=4*i,t+=8*i);return t+=4096,t},pe=new WeakSet,fe=function(){if(g(this,Qt).video&&v(this,te,{id:1,info:{type:"video",codec:g(this,Qt).video.codec,width:g(this,Qt).video.width,height:g(this,Qt).video.height,rotation:g(this,Qt).video.rotation??0,decoderConfig:null},timescale:g(this,Qt).video.frameRate??57600,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),g(this,Qt).audio&&(v(this,ee,{id:g(this,Qt).video?2:1,info:{type:"audio",codec:g(this,Qt).audio.codec,numberOfChannels:g(this,Qt).audio.numberOfChannels,sampleRate:g(this,Qt).audio.sampleRate,decoderConfig:null},timescale:g(this,Qt).audio.sampleRate,samples:[],finalizedChunks:[],currentChunk:null,firstDecodeTimestamp:void 0,lastDecodeTimestamp:-1,timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,compactlyCodedChunkTable:[]}),"aac"===g(this,Qt).audio.codec)){let t=x(this,ge,we).call(this,2,g(this,Qt).audio.sampleRate,g(this,Qt).audio.numberOfChannels);g(this,ee).info.decoderConfig={codec:g(this,Qt).audio.codec,description:t,numberOfChannels:g(this,Qt).audio.numberOfChannels,sampleRate:g(this,Qt).audio.sampleRate}}},ge=new WeakSet,we=function(t,e,i){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),n=i,r="";r+=t.toString(2).padStart(5,"0"),r+=a.toString(2).padStart(4,"0"),15===a&&(r+=e.toString(2).padStart(24,"0")),r+=n.toString(2).padStart(4,"0");let s=8*Math.ceil(r.length/8);r=r.padEnd(s,"0");let o=new Uint8Array(r.length/8);for(let h=0;h<r.length;h+=8)o[h/8]=parseInt(r.slice(h,h+8),2);return o},ve=new WeakSet,xe=function(t,e,i,a,n,r,s){let o=a/1e6,h=(a-(s??0))/1e6,l=n/1e6,c=x(this,Ce,ke).call(this,o,h,t);return o=c.presentationTimestamp,h=c.decodeTimestamp,r?.decoderConfig&&(null===t.info.decoderConfig?t.info.decoderConfig=r.decoderConfig:Object.assign(t.info.decoderConfig,r.decoderConfig)),{presentationTimestamp:o,decodeTimestamp:h,duration:l,data:e,size:e.byteLength,type:i,timescaleUnitsToNextSample:B(l,t.timescale)}},be=new WeakSet,ye=function(t,e){"fragmented"!==g(this,Qt).fastStart&&t.samples.push(e);const i=B(e.presentationTimestamp-e.decodeTimestamp,t.timescale);if(null!==t.lastTimescaleUnits){let a=B(e.decodeTimestamp,t.timescale,!1),n=Math.round(a-t.lastTimescaleUnits);if(t.lastTimescaleUnits+=n,t.lastSample.timescaleUnitsToNextSample=n,"fragmented"!==g(this,Qt).fastStart){let e=E(t.timeToSampleTable);1===e.sampleCount?(e.sampleDelta=n,e.sampleCount++):e.sampleDelta===n?e.sampleCount++:(e.sampleCount--,t.timeToSampleTable.push({sampleCount:2,sampleDelta:n}));const a=E(t.compositionTimeOffsetTable);a.sampleCompositionTimeOffset===i?a.sampleCount++:t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i})}}else t.lastTimescaleUnits=0,"fragmented"!==g(this,Qt).fastStart&&(t.timeToSampleTable.push({sampleCount:1,sampleDelta:B(e.duration,t.timescale)}),t.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:i}));t.lastSample=e;let a=!1;if(t.currentChunk){let i=e.presentationTimestamp-t.currentChunk.startTimestamp;if("fragmented"===g(this,Qt).fastStart){let n=g(this,te)??g(this,ee);const r=g(this,Qt).minFragmentDuration??1;t===n&&"key"===e.type&&i>=r&&(a=!0,x(this,Te,Ne).call(this))}else a=i>=.5}else a=!0;a&&(t.currentChunk&&x(this,je,Me).call(this,t),t.currentChunk={startTimestamp:e.presentationTimestamp,samples:[]}),t.currentChunk.samples.push(e)},Ce=new WeakSet,ke=function(t,e,i){const a="strict"===g(this,Qt).firstTimestampBehavior,n=-1===i.lastDecodeTimestamp;if(a&&n&&0!==e)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received DTS=${e}).Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of thedocument, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`);if("offset"===g(this,Qt).firstTimestampBehavior||"cross-track-offset"===g(this,Qt).firstTimestampBehavior){let a;void 0===i.firstDecodeTimestamp&&(i.firstDecodeTimestamp=e),a="offset"===g(this,Qt).firstTimestampBehavior?i.firstDecodeTimestamp:Math.min(g(this,te)?.firstDecodeTimestamp??1/0,g(this,ee)?.firstDecodeTimestamp??1/0),e-=a,t-=a}if(e<i.lastDecodeTimestamp)throw new Error(`Timestamps must be monotonically increasing (DTS went from ${1e6*i.lastDecodeTimestamp} to ${1e6*e}).`);return i.lastDecodeTimestamp=e,{presentationTimestamp:t,decodeTimestamp:e}},je=new WeakSet,Me=function(t){if("fragmented"===g(this,Qt).fastStart)throw new Error("Can't finalize individual chunks if 'fastStart' is set to 'fragmented'.");if(t.currentChunk)if(t.finalizedChunks.push(t.currentChunk),g(this,ae).push(t.currentChunk),0!==t.compactlyCodedChunkTable.length&&E(t.compactlyCodedChunkTable).samplesPerChunk===t.currentChunk.samples.length||t.compactlyCodedChunkTable.push({firstChunk:t.finalizedChunks.length,samplesPerChunk:t.currentChunk.samples.length}),"in-memory"!==g(this,Qt).fastStart){t.currentChunk.offset=g(this,Kt).pos;for(let e of t.currentChunk.samples)g(this,Kt).write(e.data),e.data=null;x(this,Se,De).call(this)}else t.currentChunk.offset=0},Te=new WeakSet,Ne=function(t=!0){if("fragmented"!==g(this,Qt).fastStart)throw new Error("Can't finalize a fragment unless 'fastStart' is set to 'fragmented'.");let e=[g(this,te),g(this,ee)].filter(t=>t&&t.currentChunk);if(0===e.length)return;let i=(a=this,n=ne,{set _(t){v(a,n,t)},get _(){return g(a,n,r)}})._++;var a,n,r;if(1===i){let t=U(e,g(this,ie),!0);g(this,Kt).writeBox(t)}let s=g(this,Kt).pos,o=wt(i,e);g(this,Kt).writeBox(o);{let t=H(!1),i=0;for(let n of e)for(let t of n.currentChunk.samples)i+=t.size;let a=g(this,Kt).measureBox(t)+i;a>=2**32&&(t.largeSize=!0,a=g(this,Kt).measureBox(t)+i),t.size=a,g(this,Kt).writeBox(t)}for(let c of e){c.currentChunk.offset=g(this,Kt).pos,c.currentChunk.moofOffset=s;for(let t of c.currentChunk.samples)g(this,Kt).write(t.data),t.data=null}let h=g(this,Kt).pos;g(this,Kt).seek(g(this,Kt).offsets.get(o));let l=wt(i,e);g(this,Kt).writeBox(l),g(this,Kt).seek(h);for(let c of e)c.finalizedChunks.push(c.currentChunk),g(this,ae).push(c.currentChunk),c.currentChunk=null;t&&x(this,Se,De).call(this)},Se=new WeakSet,De=function(){g(this,Kt)instanceof Jt&&g(this,Kt).flush()},Le=new WeakSet,Ee=function(){if(g(this,oe))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")},function(){const t=Ie,e=Pe();for(;;)try{if(151447===-parseInt(t(216))/1+parseInt(t(205))/2*(-parseInt(t(202))/3)+-parseInt(t(222))/4*(-parseInt(t(207))/5)+-parseInt(t(221))/6+-parseInt(t(209))/7+parseInt(t(223))/8*(parseInt(t(211))/9)+parseInt(t(201))/10)break;e.push(e.shift())}catch(i){e.push(e.shift())}}();const Fe=({frames:i,clearFrames:a,onionSkinEnabled:n,fps:r=10,width:s=512,height:o=512})=>{const[h,l]=t.useState(!1),c=async()=>{if(!i.length)return;if(!("VideoEncoder"in window))return void alert("WebCodecs not supported in this browser (Chrome 94+ required)");l(!0);let t=null;try{if(n){const e=await async function(t,e=512,i=512){const a=Ie;return await Promise[a(204)](t[a(213)](async t=>{const n=a;try{const a=document[n(214)](n(220));a.width=e,a[n(219)]=i;const r=a[n(215)]("2d");if(!r)return t;r.fillStyle="white",r.fillRect(0,0,e,i);const s=new Image;return s[n(218)]=n(212),new Promise(o=>{const h=n;s[h(210)]=()=>{const n=h;try{r[n(206)](s,0,0,e,i);const t=a[n(203)]("image/png");o(t)}catch(l){o(t)}},s[h(208)]=()=>{o(t)},s[h(217)]=t})}catch(r){return t}}))}(i,s,o);t=await He(e,r,s,o)}else t=await He(i,r,s,o);if(t){const e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="animation.mp4",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e),a?.()}}catch(e){alert("Failed to encode video. Check console for details.")}finally{l(!1)}};return t.useEffect(()=>{c()},[]),e.jsx("button",{className:"z-100 relative",onClick:c,disabled:h||!i.length,children:h?"Encoding...":"Download MP4"})};async function He(t,e,i,a){return new Promise(async(n,r)=>{const s=new Ae({fastStart:"in-memory",target:new Et,video:{codec:"avc",width:i,height:a}}),o=new OffscreenCanvas(i,a),h=o.getContext("2d",{willReadFrequently:!0});if(!h)return void r(new Error("Could not get 2D context"));const l=new VideoEncoder({output:(t,e)=>{s.addVideoChunk(t,e)},error:t=>{r(new Error(`Encoder error: ${t.message}`))}});await l.configure({codec:"avc1.42001e",width:i,height:a,bitrate:2e6,framerate:e});const c=[];for(const e of t)try{const t=new Image;t.src=e,await t.decode();const n=await createImageBitmap(t,{resizeWidth:i,resizeHeight:a,resizeQuality:"high"});c.push(n)}catch(u){return void r(new Error(`Failed to load frame: ${u}`))}for(let t=0;t<c.length;t++){h.clearRect(0,0,i,a),h.drawImage(c[t],0,0,i,a);const n=new VideoFrame(o,{timestamp:Math.round(1e6*t/e),duration:Math.round(1e6/e)});try{l.encode(n)}finally{n.close()}t%5==0&&await new Promise(t=>setTimeout(t,0))}await l.flush(),s.finalize();let{buffer:d}=s.target;n(new Blob([d],{type:"video/mp4"})),c.forEach(t=>t.close())})}const Ue=({isOpen:i,onClose:a,onLoadFrames:n,currentFrameCount:r})=>{const[s,o]=t.useState([]),[h,l]=t.useState([]),[c,d]=t.useState(!1),[u,m]=t.useState(!0),p=t.useRef(null);if(!i)return null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",onDragOver:t=>{t.preventDefault(),t.stopPropagation()},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.files){const e=Array.from(t.dataTransfer.files).filter(t=>t.type.startsWith("image/")||t.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(e);const i=e.map(t=>URL.createObjectURL(t));l(i)}},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Load Frames"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-300 mb-2",children:"Select image files to load as animation frames. Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP."}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("input",{type:"checkbox",id:"autoCreate",checked:u,onChange:t=>m(t.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"autoCreate",className:"text-gray-300",children:"Auto-create frames from selected files"})]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer mb-4 "+(s.length>0?"bg-gray-700":"bg-gray-900"),onClick:()=>p.current?.click(),children:[e.jsx("input",{type:"file",ref:p,onChange:t=>{if(t.target.files){const e=Array.from(t.target.files).filter(t=>t.type.startsWith("image/")||t.name.match(/\.(png|jpg|jpeg|gif|bmp|webp)$/i));o(e);const i=e.map(t=>URL.createObjectURL(t));l(i)}},className:"hidden",multiple:!0,accept:"image/*"}),0===s.length?e.jsxs("div",{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Click or drag and drop image files here"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supports PNG, JPG, JPEG, GIF, BMP, WebP"})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-white mb-2",children:[s.length," file",1!==s.length?"s":""," selected"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Click to select more files"})]})]}),h.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Preview"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 max-h-60 overflow-y-auto",children:h.map((t,i)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Preview ${i+1}`,className:"w-full h-24 object-contain bg-gray-200 rounded"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs",children:i+1})})]},i))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(0!==s.length){if(r>0){if(!window.confirm(`This will replace your current ${r} frame(s) with ${s.length} new frame(s). Are you sure you want to continue?`))return}d(!0);try{const t=await Promise.all(s.map(t=>new Promise((e,i)=>{const a=new FileReader;a.onload=()=>e(a.result),a.onerror=()=>i(a.error),a.readAsDataURL(t)})));n(t),a()}catch(t){alert("Error loading frames. Please try again.")}finally{d(!1)}}else alert("Please select at least one image file.")},disabled:c||0===s.length,className:"px-4 py-2 rounded-lg transition-colors "+(c||0===s.length?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:c?"Loading...":`Load ${s.length} Frame${1!==s.length?"s":""}`})]})]})})})};
/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function Ye(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function Ve(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ye(Object(i),!0).forEach(function(e){Ge(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ye(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function Xe(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function $e(t){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$e(t)}function qe(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Xe(a.key),a)}}function Ge(t,e,i){return(e=Xe(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Je(t){return function(t){if(Array.isArray(t))return Qe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Qe(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Qe(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}var Ke="undefined"!=typeof window&&void 0!==window.document,Ze=Ke?window:{},_e=!(!Ke||!Ze.document.documentElement)&&"ontouchstart"in Ze.document.documentElement,ti=!!Ke&&"PointerEvent"in Ze,ei="cropper",ii="all",ai="crop",ni="move",ri="zoom",si="e",oi="w",hi="s",li="n",ci="ne",di="nw",ui="se",mi="sw",pi="".concat(ei,"-crop"),fi="".concat(ei,"-disabled"),gi="".concat(ei,"-hidden"),wi="".concat(ei,"-hide"),vi="".concat(ei,"-invisible"),xi="".concat(ei,"-modal"),bi="".concat(ei,"-move"),yi="".concat(ei,"Action"),Ci="".concat(ei,"Preview"),ki="crop",ji="move",Mi="none",Ti="crop",Ni="cropend",Si="cropmove",Di="cropstart",Li="dblclick",Ei=ti?"pointerdown":_e?"touchstart":"mousedown",zi=ti?"pointermove":_e?"touchmove":"mousemove",Bi=ti?"pointerup pointercancel":_e?"touchend touchcancel":"mouseup",Oi="ready",Ri="resize",Wi="wheel",Ai="zoom",Ii="image/jpeg",Pi=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Fi=/^data:/,Hi=/^data:image\/jpeg;base64,/,Ui=/^img|canvas$/i,Yi={viewMode:0,dragMode:ki,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Vi=Number.isNaN||Ze.isNaN;function Xi(t){return"number"==typeof t&&!Vi(t)}var $i=function(t){return t>0&&t<1/0};function qi(t){return void 0===t}function Gi(t){return"object"===$e(t)&&null!==t}var Ji=Object.prototype.hasOwnProperty;function Qi(t){if(!Gi(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&Ji.call(i,"isPrototypeOf")}catch(a){return!1}}function Ki(t){return"function"==typeof t}var Zi=Array.prototype.slice;function _i(t){return Array.from?Array.from(t):Zi.call(t)}function ta(t,e){return t&&Ki(e)&&(Array.isArray(t)||Xi(t.length)?_i(t).forEach(function(i,a){e.call(t,i,a,t)}):Gi(t)&&Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})),t}var ea=Object.assign||function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];return Gi(t)&&i.length>0&&i.forEach(function(e){Gi(e)&&Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},ia=/\.\d*(?:0|9){12}\d*$/;function aa(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return ia.test(t)?Math.round(t*e)/e:t}var na=/^width|height|left|top|marginLeft|marginTop$/;function ra(t,e){var i=t.style;ta(e,function(t,e){na.test(e)&&Xi(t)&&(t="".concat(t,"px")),i[e]=t})}function sa(t,e){if(e)if(Xi(t.length))ta(t,function(t){sa(t,e)});else if(t.classList)t.classList.add(e);else{var i=t.className.trim();i?i.indexOf(e)<0&&(t.className="".concat(i," ").concat(e)):t.className=e}}function oa(t,e){e&&(Xi(t.length)?ta(t,function(t){oa(t,e)}):t.classList?t.classList.remove(e):t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,"")))}function ha(t,e,i){e&&(Xi(t.length)?ta(t,function(t){ha(t,e,i)}):i?sa(t,e):oa(t,e))}var la=/([a-z\d])([A-Z])/g;function ca(t){return t.replace(la,"$1-$2").toLowerCase()}function da(t,e){return Gi(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-".concat(ca(e)))}function ua(t,e,i){Gi(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-".concat(ca(e)),i)}var ma=/\s\s*/,pa=function(){var t=!1;if(Ke){var e=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(t){e=t}});Ze.addEventListener("test",i,a),Ze.removeEventListener("test",i,a)}return t}();function fa(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;e.trim().split(ma).forEach(function(e){if(!pa){var r=t.listeners;r&&r[e]&&r[e][i]&&(n=r[e][i],delete r[e][i],0===Object.keys(r[e]).length&&delete r[e],0===Object.keys(r).length&&delete t.listeners)}t.removeEventListener(e,n,a)})}function ga(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;e.trim().split(ma).forEach(function(e){if(a.once&&!pa){var r=t.listeners,s=void 0===r?{}:r;n=function(){delete s[e][i],t.removeEventListener(e,n,a);for(var r=arguments.length,o=new Array(r),h=0;h<r;h++)o[h]=arguments[h];i.apply(t,o)},s[e]||(s[e]={}),s[e][i]&&t.removeEventListener(e,s[e][i],a),s[e][i]=n,t.listeners=s}t.addEventListener(e,n,a)})}function wa(t,e,i){var a;return Ki(Event)&&Ki(CustomEvent)?a=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,i),t.dispatchEvent(a)}function va(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var xa=Ze.location,ba=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ya(t){var e=t.match(ba);return null!==e&&(e[1]!==xa.protocol||e[2]!==xa.hostname||e[3]!==xa.port)}function Ca(t){var e="timestamp=".concat((new Date).getTime());return t+(-1===t.indexOf("?")?"?":"&")+e}function ka(t){var e=t.rotate,i=t.scaleX,a=t.scaleY,n=t.translateX,r=t.translateY,s=[];Xi(n)&&0!==n&&s.push("translateX(".concat(n,"px)")),Xi(r)&&0!==r&&s.push("translateY(".concat(r,"px)")),Xi(e)&&0!==e&&s.push("rotate(".concat(e,"deg)")),Xi(i)&&1!==i&&s.push("scaleX(".concat(i,")")),Xi(a)&&1!==a&&s.push("scaleY(".concat(a,")"));var o=s.length?s.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function ja(t,e){var i=t.pageX,a=t.pageY,n={endX:i,endY:a};return e?n:Ve({startX:i,startY:a},n)}function Ma(t){var e=t.aspectRatio,i=t.height,a=t.width,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",r=$i(a),s=$i(i);if(r&&s){var o=i*e;"contain"===n&&o>a||"cover"===n&&o<a?i=a/e:a=i*e}else r?i=a/e:s&&(a=i*e);return{width:a,height:i}}var Ta=String.fromCharCode;var Na=/^data:.*,/;function Sa(t){var e,i=new DataView(t);try{var a,n,r;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var s=i.byteLength,o=2;o+1<s;){if(255===i.getUint8(o)&&225===i.getUint8(o+1)){n=o;break}o+=1}if(n){var h=n+10;if("Exif"===function(t,e,i){var a="";i+=e;for(var n=e;n<i;n+=1)a+=Ta(t.getUint8(n));return a}(i,n+4,4)){var l=i.getUint16(h);if(((a=18761===l)||19789===l)&&42===i.getUint16(h+2,a)){var c=i.getUint32(h+4,a);c>=8&&(r=h+c)}}}if(r){var d,u,m=i.getUint16(r,a);for(u=0;u<m;u+=1)if(d=r+12*u+2,274===i.getUint16(d,a)){d+=8,e=i.getUint16(d,a),i.setUint16(d,1,a);break}}}catch(p){e=1}return e}var Da={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,i=this.container,a=this.cropper,n=Number(e.minContainerWidth),r=Number(e.minContainerHeight);sa(a,gi),oa(t,gi);var s={width:Math.max(i.offsetWidth,n>=0?n:200),height:Math.max(i.offsetHeight,r>=0?r:100)};this.containerData=s,ra(a,{width:s.width,height:s.height}),sa(t,gi),oa(a,gi)},initCanvas:function(){var t=this.containerData,e=this.imageData,i=this.options.viewMode,a=Math.abs(e.rotate)%180==90,n=a?e.naturalHeight:e.naturalWidth,r=a?e.naturalWidth:e.naturalHeight,s=n/r,o=t.width,h=t.height;t.height*s>t.width?3===i?o=t.height*s:h=t.width/s:3===i?h=t.width/s:o=t.height*s;var l={aspectRatio:s,naturalWidth:n,naturalHeight:r,width:o,height:h};this.canvasData=l,this.limited=1===i||2===i,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=ea({},l)},limitCanvas:function(t,e){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,s=i.viewMode,o=n.aspectRatio,h=this.cropped&&r;if(t){var l=Number(i.minCanvasWidth)||0,c=Number(i.minCanvasHeight)||0;s>1?(l=Math.max(l,a.width),c=Math.max(c,a.height),3===s&&(c*o>l?l=c*o:c=l/o)):s>0&&(l?l=Math.max(l,h?r.width:0):c?c=Math.max(c,h?r.height:0):h&&(l=r.width,(c=r.height)*o>l?l=c*o:c=l/o));var d=Ma({aspectRatio:o,width:l,height:c});l=d.width,c=d.height,n.minWidth=l,n.minHeight=c,n.maxWidth=1/0,n.maxHeight=1/0}if(e)if(s>(h?0:1)){var u=a.width-n.width,m=a.height-n.height;n.minLeft=Math.min(0,u),n.minTop=Math.min(0,m),n.maxLeft=Math.max(0,u),n.maxTop=Math.max(0,m),h&&this.limited&&(n.minLeft=Math.min(r.left,r.left+(r.width-n.width)),n.minTop=Math.min(r.top,r.top+(r.height-n.height)),n.maxLeft=r.left,n.maxTop=r.top,2===s&&(n.width>=a.width&&(n.minLeft=Math.min(0,u),n.maxLeft=Math.max(0,u)),n.height>=a.height&&(n.minTop=Math.min(0,m),n.maxTop=Math.max(0,m))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=a.width,n.maxTop=a.height},renderCanvas:function(t,e){var i=this.canvasData,a=this.imageData;if(e){var n=function(t){var e=t.width,i=t.height,a=t.degree;if(90==(a=Math.abs(a)%180))return{width:i,height:e};var n=a%90*Math.PI/180,r=Math.sin(n),s=Math.cos(n),o=e*s+i*r,h=e*r+i*s;return a>90?{width:h,height:o}:{width:o,height:h}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),r=n.width,s=n.height,o=i.width*(r/i.naturalWidth),h=i.height*(s/i.naturalHeight);i.left-=(o-i.width)/2,i.top-=(h-i.height)/2,i.width=o,i.height=h,i.aspectRatio=r/s,i.naturalWidth=r,i.naturalHeight=s,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,ra(this.canvas,ea({width:i.width,height:i.height},ka({translateX:i.left,translateY:i.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,i=this.imageData,a=i.naturalWidth*(e.width/e.naturalWidth),n=i.naturalHeight*(e.height/e.naturalHeight);ea(i,{width:a,height:n,left:(e.width-a)/2,top:(e.height-n)/2}),ra(this.image,ea({width:i.width,height:i.height},ka(ea({translateX:i.left,translateY:i.top},i)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,i=t.aspectRatio||t.initialAspectRatio,a=Number(t.autoCropArea)||.8,n={width:e.width,height:e.height};i&&(e.height*i>e.width?n.height=n.width/i:n.width=n.height*i),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*a),n.height=Math.max(n.minHeight,n.height*a),n.left=e.left+(e.width-n.width)/2,n.top=e.top+(e.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=ea({},n)},limitCropBox:function(t,e){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,s=this.limited,o=i.aspectRatio;if(t){var h=Number(i.minCropBoxWidth)||0,l=Number(i.minCropBoxHeight)||0,c=s?Math.min(a.width,n.width,n.width+n.left,a.width-n.left):a.width,d=s?Math.min(a.height,n.height,n.height+n.top,a.height-n.top):a.height;h=Math.min(h,a.width),l=Math.min(l,a.height),o&&(h&&l?l*o>h?l=h/o:h=l*o:h?l=h/o:l&&(h=l*o),d*o>c?d=c/o:c=d*o),r.minWidth=Math.min(h,c),r.minHeight=Math.min(l,d),r.maxWidth=c,r.maxHeight=d}e&&(s?(r.minLeft=Math.max(0,n.left),r.minTop=Math.max(0,n.top),r.maxLeft=Math.min(a.width,n.left+n.width)-r.width,r.maxTop=Math.min(a.height,n.top+n.height)-r.height):(r.minLeft=0,r.minTop=0,r.maxLeft=a.width-r.width,r.maxTop=a.height-r.height))},renderCropBox:function(){var t=this.options,e=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,t.movable&&t.cropBoxMovable&&ua(this.face,yi,i.width>=e.width&&i.height>=e.height?ni:ii),ra(this.cropBox,ea({width:i.width,height:i.height},ka({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),wa(this.element,Ti,this.getData())}},La={initPreview:function(){var t=this.element,e=this.crossOrigin,i=this.options.preview,a=e?this.crossOriginUrl:this.url,n=t.alt||"The image to preview",r=document.createElement("img");if(e&&(r.crossOrigin=e),r.src=a,r.alt=n,this.viewBox.appendChild(r),this.viewBoxImage=r,i){var s=i;"string"==typeof i?s=t.ownerDocument.querySelectorAll(i):i.querySelector&&(s=[i]),this.previews=s,ta(s,function(t){var i=document.createElement("img");ua(t,Ci,{width:t.offsetWidth,height:t.offsetHeight,html:t.innerHTML}),e&&(i.crossOrigin=e),i.src=a,i.alt=n,i.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',t.innerHTML="",t.appendChild(i)})}},resetPreview:function(){ta(this.previews,function(t){var e=da(t,Ci);ra(t,{width:e.width,height:e.height}),t.innerHTML=e.html,function(t,e){if(Gi(t[e]))try{delete t[e]}catch(i){t[e]=void 0}else if(t.dataset)try{delete t.dataset[e]}catch(i){t.dataset[e]=void 0}else t.removeAttribute("data-".concat(ca(e)))}(t,Ci)})},preview:function(){var t=this.imageData,e=this.canvasData,i=this.cropBoxData,a=i.width,n=i.height,r=t.width,s=t.height,o=i.left-e.left-t.left,h=i.top-e.top-t.top;this.cropped&&!this.disabled&&(ra(this.viewBoxImage,ea({width:r,height:s},ka(ea({translateX:-o,translateY:-h},t)))),ta(this.previews,function(e){var i=da(e,Ci),l=i.width,c=i.height,d=l,u=c,m=1;a&&(u=n*(m=l/a)),n&&u>c&&(d=a*(m=c/n),u=c),ra(e,{width:d,height:u}),ra(e.getElementsByTagName("img")[0],ea({width:r*m,height:s*m},ka(ea({translateX:-o*m,translateY:-h*m},t))))}))}},Ea={bind:function(){var t=this.element,e=this.options,i=this.cropper;Ki(e.cropstart)&&ga(t,Di,e.cropstart),Ki(e.cropmove)&&ga(t,Si,e.cropmove),Ki(e.cropend)&&ga(t,Ni,e.cropend),Ki(e.crop)&&ga(t,Ti,e.crop),Ki(e.zoom)&&ga(t,Ai,e.zoom),ga(i,Ei,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&ga(i,Wi,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&ga(i,Li,this.onDblclick=this.dblclick.bind(this)),ga(t.ownerDocument,zi,this.onCropMove=this.cropMove.bind(this)),ga(t.ownerDocument,Bi,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&ga(window,Ri,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,i=this.cropper;Ki(e.cropstart)&&fa(t,Di,e.cropstart),Ki(e.cropmove)&&fa(t,Si,e.cropmove),Ki(e.cropend)&&fa(t,Ni,e.cropend),Ki(e.crop)&&fa(t,Ti,e.crop),Ki(e.zoom)&&fa(t,Ai,e.zoom),fa(i,Ei,this.onCropStart),e.zoomable&&e.zoomOnWheel&&fa(i,Wi,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&fa(i,Li,this.onDblclick),fa(t.ownerDocument,zi,this.onCropMove),fa(t.ownerDocument,Bi,this.onCropEnd),e.responsive&&fa(window,Ri,this.onResize)}},za={resize:function(){if(!this.disabled){var t,e,i=this.options,a=this.container,n=this.containerData,r=a.offsetWidth/n.width,s=a.offsetHeight/n.height,o=Math.abs(r-1)>Math.abs(s-1)?r:s;if(1!==o)i.restore&&(t=this.getCanvasData(),e=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(ta(t,function(e,i){t[i]=e*o})),this.setCropBoxData(ta(e,function(t,i){e[i]=t*o})))}},dblclick:function(){var t,e;this.disabled||this.options.dragMode===Mi||this.setDragMode((t=this.dragBox,e=pi,(t.classList?t.classList.contains(e):t.className.indexOf(e)>-1)?ji:ki))},wheel:function(t){var e=this,i=Number(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?a=t.deltaY>0?1:-1:t.wheelDelta?a=-t.wheelDelta/120:t.detail&&(a=t.detail>0?1:-1),this.zoom(-a*i,t)))},cropStart:function(t){var e=t.buttons,i=t.button;if(!(this.disabled||("mousedown"===t.type||"pointerdown"===t.type&&"mouse"===t.pointerType)&&(Xi(e)&&1!==e||Xi(i)&&0!==i||t.ctrlKey))){var a,n=this.options,r=this.pointers;t.changedTouches?ta(t.changedTouches,function(t){r[t.identifier]=ja(t)}):r[t.pointerId||0]=ja(t),a=Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?ri:da(t.target,yi),Pi.test(a)&&!1!==wa(this.element,Di,{originalEvent:t,action:a})&&(t.preventDefault(),this.action=a,this.cropping=!1,a===ai&&(this.cropping=!0,sa(this.dragBox,xi)))}},cropMove:function(t){var e=this.action;if(!this.disabled&&e){var i=this.pointers;t.preventDefault(),!1!==wa(this.element,Si,{originalEvent:t,action:e})&&(t.changedTouches?ta(t.changedTouches,function(t){ea(i[t.identifier]||{},ja(t,!0))}):ea(i[t.pointerId||0]||{},ja(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,i=this.pointers;t.changedTouches?ta(t.changedTouches,function(t){delete i[t.identifier]}):delete i[t.pointerId||0],e&&(t.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,ha(this.dragBox,xi,this.cropped&&this.options.modal)),wa(this.element,Ni,{originalEvent:t,action:e}))}}},Ba={change:function(t){var e,i=this.options,a=this.canvasData,n=this.containerData,r=this.cropBoxData,s=this.pointers,o=this.action,h=i.aspectRatio,l=r.left,c=r.top,d=r.width,u=r.height,m=l+d,p=c+u,f=0,g=0,w=n.width,v=n.height,x=!0;!h&&t.shiftKey&&(h=d&&u?d/u:1),this.limited&&(f=r.minLeft,g=r.minTop,w=f+Math.min(n.width,a.width,a.left+a.width),v=g+Math.min(n.height,a.height,a.top+a.height));var b=s[Object.keys(s)[0]],y={x:b.endX-b.startX,y:b.endY-b.startY},C=function(t){switch(t){case si:m+y.x>w&&(y.x=w-m);break;case oi:l+y.x<f&&(y.x=f-l);break;case li:c+y.y<g&&(y.y=g-c);break;case hi:p+y.y>v&&(y.y=v-p)}};switch(o){case ii:l+=y.x,c+=y.y;break;case si:if(y.x>=0&&(m>=w||h&&(c<=g||p>=v))){x=!1;break}C(si),(d+=y.x)<0&&(o=oi,l-=d=-d),h&&(u=d/h,c+=(r.height-u)/2);break;case li:if(y.y<=0&&(c<=g||h&&(l<=f||m>=w))){x=!1;break}C(li),u-=y.y,c+=y.y,u<0&&(o=hi,c-=u=-u),h&&(d=u*h,l+=(r.width-d)/2);break;case oi:if(y.x<=0&&(l<=f||h&&(c<=g||p>=v))){x=!1;break}C(oi),d-=y.x,l+=y.x,d<0&&(o=si,l-=d=-d),h&&(u=d/h,c+=(r.height-u)/2);break;case hi:if(y.y>=0&&(p>=v||h&&(l<=f||m>=w))){x=!1;break}C(hi),(u+=y.y)<0&&(o=li,c-=u=-u),h&&(d=u*h,l+=(r.width-d)/2);break;case ci:if(h){if(y.y<=0&&(c<=g||m>=w)){x=!1;break}C(li),u-=y.y,c+=y.y,d=u*h}else C(li),C(si),y.x>=0?m<w?d+=y.x:y.y<=0&&c<=g&&(x=!1):d+=y.x,y.y<=0?c>g&&(u-=y.y,c+=y.y):(u-=y.y,c+=y.y);d<0&&u<0?(o=mi,c-=u=-u,l-=d=-d):d<0?(o=di,l-=d=-d):u<0&&(o=ui,c-=u=-u);break;case di:if(h){if(y.y<=0&&(c<=g||l<=f)){x=!1;break}C(li),u-=y.y,c+=y.y,d=u*h,l+=r.width-d}else C(li),C(oi),y.x<=0?l>f?(d-=y.x,l+=y.x):y.y<=0&&c<=g&&(x=!1):(d-=y.x,l+=y.x),y.y<=0?c>g&&(u-=y.y,c+=y.y):(u-=y.y,c+=y.y);d<0&&u<0?(o=ui,c-=u=-u,l-=d=-d):d<0?(o=ci,l-=d=-d):u<0&&(o=mi,c-=u=-u);break;case mi:if(h){if(y.x<=0&&(l<=f||p>=v)){x=!1;break}C(oi),d-=y.x,l+=y.x,u=d/h}else C(hi),C(oi),y.x<=0?l>f?(d-=y.x,l+=y.x):y.y>=0&&p>=v&&(x=!1):(d-=y.x,l+=y.x),y.y>=0?p<v&&(u+=y.y):u+=y.y;d<0&&u<0?(o=ci,c-=u=-u,l-=d=-d):d<0?(o=ui,l-=d=-d):u<0&&(o=di,c-=u=-u);break;case ui:if(h){if(y.x>=0&&(m>=w||p>=v)){x=!1;break}C(si),u=(d+=y.x)/h}else C(hi),C(si),y.x>=0?m<w?d+=y.x:y.y>=0&&p>=v&&(x=!1):d+=y.x,y.y>=0?p<v&&(u+=y.y):u+=y.y;d<0&&u<0?(o=di,c-=u=-u,l-=d=-d):d<0?(o=mi,l-=d=-d):u<0&&(o=ci,c-=u=-u);break;case ni:this.move(y.x,y.y),x=!1;break;case ri:this.zoom(function(t){var e=Ve({},t),i=0;return ta(t,function(t,a){delete e[a],ta(e,function(e){var a=Math.abs(t.startX-e.startX),n=Math.abs(t.startY-e.startY),r=Math.abs(t.endX-e.endX),s=Math.abs(t.endY-e.endY),o=Math.sqrt(a*a+n*n),h=(Math.sqrt(r*r+s*s)-o)/o;Math.abs(h)>Math.abs(i)&&(i=h)})}),i}(s),t),x=!1;break;case ai:if(!y.x||!y.y){x=!1;break}e=va(this.cropper),l=b.startX-e.left,c=b.startY-e.top,d=r.minWidth,u=r.minHeight,y.x>0?o=y.y>0?ui:ci:y.x<0&&(l-=d,o=y.y>0?mi:di),y.y<0&&(c-=u),this.cropped||(oa(this.cropBox,gi),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}x&&(r.width=d,r.height=u,r.left=l,r.top=c,this.action=o,this.renderCropBox()),ta(s,function(t){t.startX=t.endX,t.startY=t.endY})}},Oa={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&sa(this.dragBox,xi),oa(this.cropBox,gi),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=ea({},this.initialImageData),this.canvasData=ea({},this.initialCanvasData),this.cropBoxData=ea({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(ea(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),oa(this.dragBox,xi),sa(this.cropBox,gi)),this},replace:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,ta(this.previews,function(e){e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,oa(this.cropper,fi)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,sa(this.cropper,fi)),this},destroy:function(){var t=this.element;return t[ei]?(t[ei]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.canvasData,a=i.left,n=i.top;return this.moveTo(qi(t)?t:a+Number(t),qi(e)?e:n+Number(e))},moveTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.canvasData,a=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(Xi(t)&&(i.left=t,a=!0),Xi(e)&&(i.top=e,a=!0),a&&this.renderCanvas(!0)),this},zoom:function(t,e){var i=this.canvasData;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo:function(t,e,i){var a=this.options,n=this.canvasData,r=n.width,s=n.height,o=n.naturalWidth,h=n.naturalHeight;if((t=Number(t))>=0&&this.ready&&!this.disabled&&a.zoomable){var l=o*t,c=h*t;if(!1===wa(this.element,Ai,{ratio:t,oldRatio:r/o,originalEvent:i}))return this;if(i){var d=this.pointers,u=va(this.cropper),m=d&&Object.keys(d).length?function(t){var e=0,i=0,a=0;return ta(t,function(t){var n=t.startX,r=t.startY;e+=n,i+=r,a+=1}),{pageX:e/=a,pageY:i/=a}}(d):{pageX:i.pageX,pageY:i.pageY};n.left-=(l-r)*((m.pageX-u.left-n.left)/r),n.top-=(c-s)*((m.pageY-u.top-n.top)/s)}else Qi(e)&&Xi(e.x)&&Xi(e.y)?(n.left-=(l-r)*((e.x-n.left)/r),n.top-=(c-s)*((e.y-n.top)/s)):(n.left-=(l-r)/2,n.top-=(c-s)/2);n.width=l,n.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return Xi(t=Number(t))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,Xi(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(Xi(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.imageData,a=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(Xi(t)&&(i.scaleX=t,a=!0),Xi(e)&&(i.scaleY=e,a=!0),a&&this.renderCanvas(!0,!0)),this},getData:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.options,a=this.imageData,n=this.canvasData,r=this.cropBoxData;if(this.ready&&this.cropped){t={x:r.left-n.left,y:r.top-n.top,width:r.width,height:r.height};var s=a.width/a.naturalWidth;if(ta(t,function(e,i){t[i]=e/s}),e){var o=Math.round(t.y+t.height),h=Math.round(t.x+t.width);t.x=Math.round(t.x),t.y=Math.round(t.y),t.width=h-t.x,t.height=o-t.y}}else t={x:0,y:0,width:0,height:0};return i.rotatable&&(t.rotate=a.rotate||0),i.scalable&&(t.scaleX=a.scaleX||1,t.scaleY=a.scaleY||1),t},setData:function(t){var e=this.options,i=this.imageData,a=this.canvasData,n={};if(this.ready&&!this.disabled&&Qi(t)){var r=!1;e.rotatable&&Xi(t.rotate)&&t.rotate!==i.rotate&&(i.rotate=t.rotate,r=!0),e.scalable&&(Xi(t.scaleX)&&t.scaleX!==i.scaleX&&(i.scaleX=t.scaleX,r=!0),Xi(t.scaleY)&&t.scaleY!==i.scaleY&&(i.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);var s=i.width/i.naturalWidth;Xi(t.x)&&(n.left=t.x*s+a.left),Xi(t.y)&&(n.top=t.y*s+a.top),Xi(t.width)&&(n.width=t.width*s),Xi(t.height)&&(n.height=t.height*s),this.setCropBoxData(n)}return this},getContainerData:function(){return this.ready?ea({},this.containerData):{}},getImageData:function(){return this.sized?ea({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&ta(["left","top","width","height","naturalWidth","naturalHeight"],function(i){e[i]=t[i]}),e},setCanvasData:function(t){var e=this.canvasData,i=e.aspectRatio;return this.ready&&!this.disabled&&Qi(t)&&(Xi(t.left)&&(e.left=t.left),Xi(t.top)&&(e.top=t.top),Xi(t.width)?(e.width=t.width,e.height=t.width/i):Xi(t.height)&&(e.height=t.height,e.width=t.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var t,e=this.cropBoxData;return this.ready&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(t){var e,i,a=this.cropBoxData,n=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&Qi(t)&&(Xi(t.left)&&(a.left=t.left),Xi(t.top)&&(a.top=t.top),Xi(t.width)&&t.width!==a.width&&(e=!0,a.width=t.width),Xi(t.height)&&t.height!==a.height&&(i=!0,a.height=t.height),n&&(e?a.height=a.width/n:i&&(a.width=a.height*n)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,i=function(t,e,i,a){var n=e.aspectRatio,r=e.naturalWidth,s=e.naturalHeight,o=e.rotate,h=void 0===o?0:o,l=e.scaleX,c=void 0===l?1:l,d=e.scaleY,u=void 0===d?1:d,m=i.aspectRatio,p=i.naturalWidth,f=i.naturalHeight,g=a.fillColor,w=void 0===g?"transparent":g,v=a.imageSmoothingEnabled,x=void 0===v||v,b=a.imageSmoothingQuality,y=void 0===b?"low":b,C=a.maxWidth,k=void 0===C?1/0:C,j=a.maxHeight,M=void 0===j?1/0:j,T=a.minWidth,N=void 0===T?0:T,S=a.minHeight,D=void 0===S?0:S,L=document.createElement("canvas"),E=L.getContext("2d"),z=Ma({aspectRatio:m,width:k,height:M}),B=Ma({aspectRatio:m,width:N,height:D},"cover"),O=Math.min(z.width,Math.max(B.width,p)),R=Math.min(z.height,Math.max(B.height,f)),W=Ma({aspectRatio:n,width:k,height:M}),A=Ma({aspectRatio:n,width:N,height:D},"cover"),I=Math.min(W.width,Math.max(A.width,r)),P=Math.min(W.height,Math.max(A.height,s)),F=[-I/2,-P/2,I,P];return L.width=aa(O),L.height=aa(R),E.fillStyle=w,E.fillRect(0,0,O,R),E.save(),E.translate(O/2,R/2),E.rotate(h*Math.PI/180),E.scale(c,u),E.imageSmoothingEnabled=x,E.imageSmoothingQuality=y,E.drawImage.apply(E,[t].concat(Je(F.map(function(t){return Math.floor(aa(t))})))),E.restore(),L}(this.image,this.imageData,e,t);if(!this.cropped)return i;var a=this.getData(t.rounded),n=a.x,r=a.y,s=a.width,o=a.height,h=i.width/Math.floor(e.naturalWidth);1!==h&&(n*=h,r*=h,s*=h,o*=h);var l=s/o,c=Ma({aspectRatio:l,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),d=Ma({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),u=Ma({aspectRatio:l,width:t.width||(1!==h?i.width:s),height:t.height||(1!==h?i.height:o)}),m=u.width,p=u.height;m=Math.min(c.width,Math.max(d.width,m)),p=Math.min(c.height,Math.max(d.height,p));var f=document.createElement("canvas"),g=f.getContext("2d");f.width=aa(m),f.height=aa(p),g.fillStyle=t.fillColor||"transparent",g.fillRect(0,0,m,p);var w=t.imageSmoothingEnabled,v=void 0===w||w,x=t.imageSmoothingQuality;g.imageSmoothingEnabled=v,x&&(g.imageSmoothingQuality=x);var b,y,C,k,j,M,T=i.width,N=i.height,S=n,D=r;S<=-s||S>T?(S=0,b=0,C=0,j=0):S<=0?(C=-S,S=0,j=b=Math.min(T,s+S)):S<=T&&(C=0,j=b=Math.min(s,T-S)),b<=0||D<=-o||D>N?(D=0,y=0,k=0,M=0):D<=0?(k=-D,D=0,M=y=Math.min(N,o+D)):D<=N&&(k=0,M=y=Math.min(o,N-D));var L=[S,D,b,y];if(j>0&&M>0){var E=m/s;L.push(C*E,k*E,j*E,M*E)}return g.drawImage.apply(g,[i].concat(Je(L.map(function(t){return Math.floor(aa(t))})))),f},setAspectRatio:function(t){var e=this.options;return this.disabled||qi(t)||(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,i=this.dragBox,a=this.face;if(this.ready&&!this.disabled){var n=t===ki,r=e.movable&&t===ji;t=n||r?t:Mi,e.dragMode=t,ua(i,yi,t),ha(i,pi,n),ha(i,bi,r),e.cropBoxMovable||(ua(a,yi,t),ha(a,pi,n),ha(a,bi,r))}return this}},Ra=Ze.Cropper,Wa=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e||!Ui.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=ea({},Yi,Qi(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return e=t,i=[{key:"init",value:function(){var t,e=this.element,i=e.tagName.toLowerCase();if(!e[ei]){if(e[ei]=this,"img"===i){if(this.isImg=!0,t=e.getAttribute("src")||"",this.originalUrl=t,!t)return;t=e.src}else"canvas"===i&&window.HTMLCanvasElement&&(t=e.toDataURL());this.load(t)}}},{key:"load",value:function(t){var e=this;if(t){this.url=t,this.imageData={};var i=this.element,a=this.options;if(a.rotatable||a.scalable||(a.checkOrientation=!1),a.checkOrientation&&window.ArrayBuffer)if(Fi.test(t))Hi.test(t)?this.read((n=t.replace(Na,""),r=atob(n),s=new ArrayBuffer(r.length),ta(o=new Uint8Array(s),function(t,e){o[e]=r.charCodeAt(e)}),s)):this.clone();else{var n,r,s,o,h=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=h,h.onabort=l,h.onerror=l,h.ontimeout=l,h.onprogress=function(){h.getResponseHeader("content-type")!==Ii&&h.abort()},h.onload=function(){e.read(h.response)},h.onloadend=function(){e.reloading=!1,e.xhr=null},a.checkCrossOrigin&&ya(t)&&i.crossOrigin&&(t=Ca(t)),h.open("GET",t,!0),h.responseType="arraybuffer",h.withCredentials="use-credentials"===i.crossOrigin,h.send()}else this.clone()}}},{key:"read",value:function(t){var e=this.options,i=this.imageData,a=Sa(t),n=0,r=1,s=1;if(a>1){this.url=function(t,e){for(var i=[],a=new Uint8Array(t);a.length>0;)i.push(Ta.apply(null,_i(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(i.join("")))}(t,Ii);var o=function(t){var e=0,i=1,a=1;switch(t){case 2:i=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}return{rotate:e,scaleX:i,scaleY:a}}(a);n=o.rotate,r=o.scaleX,s=o.scaleY}e.rotatable&&(i.rotate=n),e.scalable&&(i.scaleX=r,i.scaleY=s),this.clone()}},{key:"clone",value:function(){var t=this.element,e=this.url,i=t.crossOrigin,a=e;this.options.checkCrossOrigin&&ya(e)&&(i||(i="anonymous"),a=Ca(e)),this.crossOrigin=i,this.crossOriginUrl=a;var n=document.createElement("img");i&&(n.crossOrigin=i),n.src=a||e,n.alt=t.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),sa(n,wi),t.parentNode.insertBefore(n,t.nextSibling)}},{key:"start",value:function(){var t=this,e=this.image;e.onload=null,e.onerror=null,this.sizing=!0;var i=Ze.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Ze.navigator.userAgent),a=function(e,i){ea(t.imageData,{naturalWidth:e,naturalHeight:i,aspectRatio:e/i}),t.initialImageData=ea({},t.imageData),t.sizing=!1,t.sized=!0,t.build()};if(!e.naturalWidth||i){var n=document.createElement("img"),r=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){a(n.width,n.height),i||r.removeChild(n)},n.src=e.src,i||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",r.appendChild(n))}else a(e.naturalWidth,e.naturalHeight)}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var t=this.element,e=this.options,i=this.image,a=t.parentNode,n=document.createElement("div");n.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var r=n.querySelector(".".concat(ei,"-container")),s=r.querySelector(".".concat(ei,"-canvas")),o=r.querySelector(".".concat(ei,"-drag-box")),h=r.querySelector(".".concat(ei,"-crop-box")),l=h.querySelector(".".concat(ei,"-face"));this.container=a,this.cropper=r,this.canvas=s,this.dragBox=o,this.cropBox=h,this.viewBox=r.querySelector(".".concat(ei,"-view-box")),this.face=l,s.appendChild(i),sa(t,gi),a.insertBefore(r,t.nextSibling),oa(i,wi),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,sa(h,gi),e.guides||sa(h.getElementsByClassName("".concat(ei,"-dashed")),gi),e.center||sa(h.getElementsByClassName("".concat(ei,"-center")),gi),e.background&&sa(r,"".concat(ei,"-bg")),e.highlight||sa(l,vi),e.cropBoxMovable&&(sa(l,bi),ua(l,yi,ii)),e.cropBoxResizable||(sa(h.getElementsByClassName("".concat(ei,"-line")),gi),sa(h.getElementsByClassName("".concat(ei,"-point")),gi)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),Ki(e.ready)&&ga(t,Oi,e.ready,{once:!0}),wa(t,Oi)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var t=this.cropper.parentNode;t&&t.removeChild(this.cropper),oa(this.element,gi)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],a=[{key:"noConflict",value:function(){return window.Cropper=Ra,t}},{key:"setDefaults",value:function(t){ea(Yi,Qi(t)&&t)}}],i&&qe(e.prototype,i),a&&qe(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,a}();ea(Wa.prototype,Da,La,Ea,za,Ba,Oa);var Aa=function(){return Aa=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},Aa.apply(this,arguments)};function Ia(t,e){var i={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(i[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(t);n<a.length;n++)e.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(i[a[n]]=t[a[n]])}return i}var Pa=["aspectRatio","autoCrop","autoCropArea","background","center","checkCrossOrigin","checkOrientation","cropBoxMovable","cropBoxResizable","data","dragMode","guides","highlight","initialAspectRatio","minCanvasHeight","minCanvasWidth","minContainerHeight","minContainerWidth","minCropBoxHeight","minCropBoxWidth","modal","movable","preview","responsive","restore","rotatable","scalable","toggleDragModeOnDblclick","viewMode","wheelZoomRatio","zoomOnTouch","zoomOnWheel","zoomable","cropstart","cropmove","cropend","crop","zoom","ready"],Fa={opacity:0,maxWidth:"100%"},Ha=i.forwardRef(function(e,a){var n=Ia(e,[]),r=n.dragMode,s=void 0===r?"crop":r,o=n.src,h=n.style,l=n.className,c=n.crossOrigin,d=n.scaleX,u=n.scaleY,m=n.enable,p=n.zoomTo,f=n.rotateTo,g=n.alt,w=void 0===g?"picture":g,v=n.ready,x=n.onInitialized,b=Ia(n,["dragMode","src","style","className","crossOrigin","scaleX","scaleY","enable","zoomTo","rotateTo","alt","ready","onInitialized"]),y={scaleY:u,scaleX:d,enable:m,zoomTo:p,rotateTo:f},C=function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];var n=t.useRef(null);return i.useEffect(function(){e.forEach(function(t){t&&("function"==typeof t?t(n.current):t.current=n.current)})},[e]),n}(a,t.useRef(null));t.useEffect(function(){var t;(null===(t=C.current)||void 0===t?void 0:t.cropper)&&"number"==typeof p&&C.current.cropper.zoomTo(p)},[n.zoomTo]),t.useEffect(function(){var t;(null===(t=C.current)||void 0===t?void 0:t.cropper)&&void 0!==o&&C.current.cropper.reset().clear().replace(o)},[o]),t.useEffect(function(){if(null!==C.current){var t=new Wa(C.current,Aa(Aa({dragMode:s},b),{ready:function(t){null!==t.currentTarget&&function(t,e){void 0===e&&(e={});var i=e.enable,a=void 0===i||i,n=e.scaleX,r=void 0===n?1:n,s=e.scaleY,o=void 0===s?1:s,h=e.zoomTo,l=void 0===h?0:h,c=e.rotateTo;a?t.enable():t.disable(),t.scaleX(r),t.scaleY(o),void 0!==c&&t.rotateTo(c),l>0&&t.zoomTo(l)}(t.currentTarget.cropper,y),v&&v(t)}}));x&&x(t)}return function(){var t,e;null===(e=null===(t=C.current)||void 0===t?void 0:t.cropper)||void 0===e||e.destroy()}},[C]);var k=function(t){return Pa.reduce(function(t,e){var i=t,a=e;return i[a],Ia(i,["symbol"==typeof a?a:a+""])},t)}(Aa(Aa({},b),{crossOrigin:c,src:o,alt:w}));return i.createElement("div",{style:h,className:l},i.createElement("img",Aa({},k,{style:Fa,ref:C})))});const Ua=({defaultSrc:i,onCropComplete:a,onClose:n})=>{const[r,s]=t.useState(i),[o,h]=t.useState("#"),l=t.createRef();return e.jsxs("div",{children:[e.jsxs("div",{style:{width:"100%"},children:[e.jsx("input",{type:"file",onChange:t=>{let e;t.preventDefault(),t.dataTransfer?e=t.dataTransfer.files:t.target&&(e=t.target.files);const i=new FileReader;i.onload=()=>{s(i.result)},i.readAsDataURL(e[0])}}),e.jsx("button",{onClick:()=>s(i),children:"Use current frame"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(Ha,{ref:l,style:{height:400,width:"100%"},zoomTo:.5,initialAspectRatio:1,preview:".img-preview",src:r,viewMode:1,minCropBoxHeight:10,minCropBoxWidth:10,background:!1,responsive:!0,autoCropArea:1,checkOrientation:!1,guides:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"box",style:{width:"50%",float:"right"},children:[e.jsx("h1",{children:"Preview"}),e.jsx("div",{className:"img-preview",style:{width:"100%",float:"left",height:"300px"}})]}),e.jsxs("div",{className:"box",style:{width:"50%",float:"right",height:"300px"},children:[e.jsxs("h1",{children:[e.jsx("span",{children:"Crop"}),e.jsx("button",{style:{float:"right"},onClick:()=>{if(void 0!==l.current?.cropper){const t=l.current?.cropper.getCroppedCanvas().toDataURL();h(t),a&&a({croppedDataUrl:t,w:l.current?.cropper.getCroppedCanvas().width,h:l.current?.cropper.getCroppedCanvas().height})}},children:"Apply Crop"})]}),e.jsx("img",{style:{width:"100%"},src:o,alt:"cropped"})]})]}),e.jsx("br",{style:{clear:"both"}}),n&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:n,children:"Done"})})]})},Ya=()=>{const[i,a]=t.useState(!1),[n,s]=t.useState(!1),[o,h]=t.useState(!1),[l,c]=t.useState(!0),[d,u]=t.useState(!1),[m,p]=t.useState(!1),[f,g]=t.useState(!1),[w,v]=t.useState(64),[x,b]=t.useState(64),[y,C]=t.useState(!1),[k,j]=t.useState("#000000"),[M,T]=t.useState(8),[N,S]=t.useState([]),[D,L]=t.useState([]),[E,z]=t.useState(0),[B,O]=t.useState(!1),[R,W]=t.useState(!0),[A,I]=t.useState(!1),[P,F]=t.useState(5),[H,U]=t.useState(!0),[Y,V]=t.useState(!0),[X,$]=t.useState(!0),q=t.useRef(null),G=t.useRef(null);t.useEffect(()=>{const t=setTimeout(()=>{r(),setTimeout(()=>{if(window.drawingCanvas){const t=window.drawingCanvas.toDataURL(),e=_();e&&e.length>0?S(e):S([t])}},50)},100);return()=>clearTimeout(t)},[]),t.useEffect(()=>{window.selectedColor=k,window.brushSize=M,window.isEraser=B},[k,M,B]),t.useEffect(()=>{if(N.length>0&&E>=0&&E<N.length){const e=N[E];if(e&&""!==e)K(e);else if(window.drawingCanvas){const t=window.drawingCanvas,e=t.getContext("2d");e&&(0!==E&&X?e.clearRect(0,0,t.width,t.height):(e.fillStyle="white",e.fillRect(0,0,t.width,t.height)))}if(E>0&&X){var t=new Image;const e=document.getElementById("canvas2");if(e){const i=e.getContext("2d"),a=window.drawingCanvas;i.clearRect(0,0,a.width,a.height),i.fillStyle="white",i.fillRect(0,0,a.width,a.height);let n=N[E-1];t.onload=()=>{i.drawImage(t,0,0)},t.src=n}}}},[E,N]),t.useEffect(()=>{R&&N.length>0&&Z(N)},[N,R]),t.useEffect(()=>()=>{G.current&&clearInterval(G.current)},[]);const J=t=>{if(window.drawingCanvas){const e=window.drawingCanvas,i=e.getContext("2d");if(!i)return;switch(0!==E&&X?i.clearRect(0,0,e.width,e.height):(i.fillStyle="white",i.fillRect(0,0,e.width,e.height)),i.fillStyle=k,i.strokeStyle=k,i.lineWidth=M,t){case"circle":i.beginPath(),i.arc(e.width/2,e.height/2,50,0,2*Math.PI),i.fill();break;case"square":i.fillRect(e.width/2-50,e.height/2-50,100,100);break;case"smiley":i.beginPath(),i.arc(e.width/2,e.height/2,60,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(e.width/2-20,e.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e.width/2+20,e.height/2-20,8,0,2*Math.PI),i.fill(),i.beginPath(),i.arc(e.width/2,e.height/2,30,0,Math.PI,!1),i.stroke()}}},Q=()=>window.getDrawingCanvasData?window.getDrawingCanvasData():"",K=t=>{window.setDrawingCanvasData&&t&&window.setDrawingCanvasData(t)},Z=t=>{if(R)try{localStorage.setItem("animationFrames",JSON.stringify(t))}catch(e){}},_=()=>{try{const t=localStorage.getItem("animationFrames");return t?JSON.parse(t):null}catch(t){return null}},tt=t=>{if(t<0||t>=N.length)return;const e=[...N];e[E]=Q(),S(e),z(t),R&&Z(e)},et=t=>{const e=t.target.files?.[0];if(!e)return;const i=new FileReader;i.onload=t=>{const e=new Image;e.onload=()=>{if(!window.confirm(`Are you sure you want to load frames from this image? This will replace all current frames (${N.length} frames will be deleted).`))return void g(!1);const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)return alert("Could not create canvas context"),void g(!1);let a,n,r=w,s=x;if(Y?(a=Math.floor(e.width/w),n=Math.floor(e.height/x),a>0&&n>0?(r=Math.floor(e.width/a),s=Math.floor(e.height/n)):(a=Math.floor(e.width/r),n=Math.floor(e.height/s))):(a=Math.floor(e.width/r),n=Math.floor(e.height/s)),a<=0||n<=0)return alert("Cell size is too large for the image or invalid dimensions"),void g(!1);const o=[];for(let h=0;h<n;h++)for(let n=0;n<a;n++){t.width=r,t.height=s,i.drawImage(e,n*r,h*s,r,s,0,0,r,s);const a=t.toDataURL("image/png");o.push(a)}S(o),z(0),g(!1),R&&Z(o)},e.src=t.target?.result},i.readAsDataURL(e)};return e.jsxs("div",{className:"fixed inset-0 bg-gray-900 overflow-hidden",children:[e.jsx("canvas",{id:"canvas2",className:"absolute left-0 top-0 z-1 contrast-20"}),e.jsx("canvas",{id:"canvas",className:"absolute left-0 top-0 z-2"}),i&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[e.jsx("div",{className:"grid grid-cols-6 gap-2 mb-3",children:["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A"].map(t=>e.jsx("button",{className:`w-8 h-8 rounded-full border-2 ${k===t?"border-white":"border-gray-600"} focus:outline-none`,style:{backgroundColor:t},onClick:()=>j(t),"aria-label":`Select ${t} color`},t))}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("label",{htmlFor:"brushSize",className:"text-white text-sm",children:"Size:"}),e.jsx("input",{id:"brushSize",type:"range",min:"1",max:"20",value:M,onChange:t=>T(parseInt(t.target.value)),className:"w-32 accent-white"}),e.jsxs("span",{className:"text-white text-sm w-8",children:[M,"px"]})]})]}),e.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 -translate-x-16",onClick:()=>{a(!i),n&&s(!1)},"aria-label":i?"Hide color palette":"Show color palette",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),e.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-0",onClick:()=>{c(!l),a(!1)},"aria-label":"Frame manager",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-16",onClick:()=>{s(!n),i&&a(!1)},"aria-label":n?"Hide examples":"Show examples",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),n&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[e.jsx("h3",{className:"text-white mb-2",children:"Examples"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{J("circle"),s(!1)},children:"Circle"}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{J("square"),s(!1)},children:"Square"}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>{J("smiley"),s(!1)},children:"Smiley"})]})]}),l&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-50 w-full max-w-4xl",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Frame Manager"})}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex space-x-2 justify-center",children:[e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded",onClick:()=>{const t=[...N];t[E]=Q(),S(t);const e=[...t];e.splice(E+1,0,""),S(e),z(E+1),R&&Z(e)},"aria-label":"Add frame",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white p-2 rounded",onClick:()=>{if(0===N.length)return;const t=[...N];t[E]=Q(),S(t);const e=t[E],i=[...t];i.splice(E+1,0,e),S(i),z(E+1),R&&Z(i)},"aria-label":"Duplicate frame",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded",onClick:()=>{if(window.confirm("Are you sure you want to clear the current canvas? This action cannot be undone.")&&window.drawingCanvas){const t=window.drawingCanvas,e=t.getContext("2d");if(e){0!==E&&X?e.clearRect(0,0,t.width,t.height):(e.fillStyle="white",e.fillRect(0,0,t.width,t.height));const i=[...N];i[E]=t.toDataURL(),S(i),R&&Z(i)}}},"aria-label":"Clear canvas",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("button",{className:"bg-teal-500 hover:bg-teal-600 text-white p-2 rounded",onClick:()=>{const t=Q();if(!t)return void alert("No frame data to save");const e=document.createElement("a");e.href=t,e.download=`frame_${E+1}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},"aria-label":"Save current frame",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})}),e.jsx("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded",onClick:()=>{const t=document.getElementById("canvas2");A?(X&&t?.classList.add("contrast-20"),G.current&&(clearInterval(G.current),G.current=null),I(!1)):(X&&t?.classList.remove("contrast-20"),E===N.length-1&&tt(0),(()=>{if(N.length<=1)return;I(!0),G.current&&clearInterval(G.current);const t=Math.max(10,1e3/P);G.current=setInterval(()=>{z(t=>(t+1)%N.length)},t)})())},"aria-label":A?"Pause animation":"Play animation",children:A?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 p-2 rounded",children:[e.jsx("label",{htmlFor:"fps-control",className:"text-white text-sm",children:"FPS:"}),e.jsxs("select",{id:"fps-control",value:P,onChange:t=>F(parseInt(t.target.value)),className:"bg-gray-600 text-white text-sm rounded px-1",disabled:A,children:[e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"5",children:"5"}),P>1&&P<10&&5!==P&&e.jsx("option",{value:P,children:P}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"24",children:"24"}),e.jsx("option",{value:"30",children:"30"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 justify-center max-h-24 overflow-y-auto",children:N.map((t,i)=>e.jsx("button",{className:"w-10 h-10 rounded "+(i===E?"ring-2 ring-blue-400":""),onClick:()=>tt(i),"aria-label":`Go to frame ${i+1}`,children:e.jsx("div",{className:"w-full h-full bg-gray-200 border border-gray-400 rounded flex items-center justify-center text-xs",children:i+1})},i))}),e.jsxs("div",{className:"flex items-center justify-between text-white text-sm text-center",children:[e.jsxs("div",{children:["Frame: ",E+1,"/",N.length]}),e.jsx("button",{className:"bg-gray-600 hover:bg-gray-500 text-white p-2 rounded",onClick:()=>{if(N.length<=1)return;if(!window.confirm("Are you sure you want to delete this frame? This action cannot be undone."))return;const t=[...N];t[E]=Q();const e=t.filter((t,e)=>e!==E);S(e);const i=Math.min(E,e.length-1);z(i),R&&Z(e)},"aria-label":"Delete frame",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]}),o&&e.jsxs("div",{className:"fixed bottom-20 left-1/3 transform -translate-x-1/3 bg-gray-800 p-4 rounded-lg shadow-lg z-60",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-white font-bold",children:"Settings"}),e.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>h(!1),"aria-label":"Close settings",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white",children:"Autosave to localStorage"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:R,onChange:t=>W(t.target.checked)}),e.jsx("div",{className:`w-11 h-6 rounded-full peer ${R?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white",children:"LOAD FRAMES"}),e.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded",onClick:()=>{h(!1),u(!0)},"aria-label":"Load frames",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white",children:"Save as MP4"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded",onClick:async()=>{0!==N.length?window.confirm("Are you sure you want to export this animation as an MP4 with white background? This may take a moment.")&&L(N):alert("No frames to export")},"aria-label":"Export as MP4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:""+(N.length>1?"text-gray-500":"text-white"),children:["Onion Skin ",N.length>1?"(disabled)":""]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{disabled:N.length>1,type:"checkbox",className:"sr-only peer "+(N.length>1?" disabled":""),checked:X,onChange:t=>{$(t.target.checked)}}),e.jsx("div",{className:`w-11 h-6 rounded-full peer ${X?"bg-blue-600":"bg-gray-700"} peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:"New Project"}),e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded",onClick:()=>{if(window.confirm("Are you sure you want to start a new project? This will delete all frames and cannot be undone.")&&window.drawingCanvas){const t=window.drawingCanvas,e=t.getContext("2d");if(e){0!==E&&X||(e.fillStyle="white",e.fillRect(0,0,t.width,t.height));const i=t.toDataURL();S([i]),z(0),R&&Z([i])}}},"aria-label":"Start new project",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-white",children:"Custom FPS"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white p-2 rounded",onClick:()=>p(!0),"aria-label":"Set custom FPS",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-white",children:"Load Grid (in dev)"}),e.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded",onClick:()=>g(!0),"aria-label":"Load frames from grid",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}),e.jsxs("div",{className:"hidden flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-white",children:"Crop Image (in dev)"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded",onClick:()=>C(!0),"aria-label":"Crop image",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]})]}),m&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-white font-bold",children:"Set Custom FPS"}),e.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>p(!1),"aria-label":"Close custom FPS",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[1,2,3,4,5,6,7,8,9].map(t=>e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white p-3 rounded text-lg font-bold",onClick:()=>{F(t),p(!1),h(!1)},"aria-label":`Set FPS to ${t}`,children:t},t))})]}),f&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70 w-96",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-white font-bold",children:"Load Frames from Grid"}),e.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>g(!1),"aria-label":"Close load grid",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-1",children:"Cell Width (px):"}),e.jsx("input",{type:"number",min:"1",value:w,onChange:t=>v(parseInt(t.target.value)||1),className:"w-full bg-gray-700 text-white p-2 rounded"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-1",children:"Cell Height (px):"}),e.jsx("input",{type:"number",min:"1",value:x,onChange:t=>b(parseInt(t.target.value)||1),className:"w-full bg-gray-700 text-white p-2 rounded"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-1",children:"Select Grid Image:"}),e.jsx("input",{ref:q,type:"file",accept:"image/*",onChange:et,className:"w-full text-white"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-white mb-2",children:"Example Grids:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.jsx("button",{type:"button",className:"bg-purple-600 hover:bg-purple-700 text-white p-2 rounded text-sm",onClick:()=>((t,e,i)=>{t=`/clipanima${t}`,v(e),b(i);const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{if(!window.confirm(`Are you sure you want to load frames from this example image? This will replace all current frames (${N.length} frames will be deleted).`))return void g(!1);const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return alert("Could not create canvas context"),void g(!1);let r,s,o=e,h=i;if(Y?(r=Math.floor(a.width/e),s=Math.floor(a.height/i),r>0&&s>0?(o=Math.floor(a.width/r),h=Math.floor(a.height/s)):(r=Math.floor(a.width/o),s=Math.floor(a.height/h))):(r=Math.floor(a.width/o),s=Math.floor(a.height/h)),r<=0||s<=0)return alert("Cell size is too large for the image or invalid dimensions"),void g(!1);const l=[];for(let e=0;e<s;e++)for(let i=0;i<r;i++){t.width=o,t.height=h,n.drawImage(a,i*o,e*h,o,h,0,0,o,h);const r=t.toDataURL("image/png");l.push(r)}S(l),z(0),g(!1),R&&Z(l)},a.src=t})("/assets/grid_man.jpg",130,160),"aria-label":"Load man grid example",children:"Man Grid"})})]}),e.jsxs("div",{className:"hidden mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"preserveAspectRatio",checked:H,onChange:t=>U(t.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"preserveAspectRatio",className:"text-gray-300",children:"Preserve aspect ratio"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoAdjustGrid",checked:Y,onChange:t=>V(t.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"autoAdjustGrid",className:"text-gray-300",children:"Auto-adjust grid size"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded",onClick:()=>{if(q.current&&q.current.files&&q.current.files.length>0){const t={target:q.current};et(t)}else alert("Please select an image file first.")},children:"OK"})]})]}),y&&e.jsxs("div",{className:"fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 p-4 rounded-lg shadow-lg z-70 w-full max-w-4xl h-3/4 max-h-[80vh] overflow-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-white font-bold",children:"Crop Image"}),e.jsx("button",{className:"text-white hover:text-gray-300",onClick:()=>C(!1),"aria-label":"Close crop",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"h-[70vh]",children:e.jsx(Ua,{defaultSrc:N[E]||"",onCropComplete:t=>{v(t.w),b(t.h)},onClose:()=>C(!1)})})]}),e.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 -translate-x-32",onClick:()=>{h(!o)},"aria-label":o?"Hide settings":"Show settings",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("button",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-full shadow-lg z-60 translate-x-32 "+(B?"ring-2 ring-yellow-400":""),onClick:()=>O(!B),"aria-label":B?"Switch to drawing mode":"Switch to eraser mode",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!!D.length&&e.jsx(Fe,{frames:D,fps:P,width:512,height:512,clearFrames:()=>L([]),onionSkinEnabled:X}),e.jsx(Ue,{isOpen:d,onClose:()=>u(!1),onLoadFrames:t=>{if(N.length>0){const t=[...N];t[E]=Q(),S(t)}S(t),z(0),t.length>0&&K(t[0]),R&&Z(t)},currentFrameCount:N.length})]})};export{Ya as default};
